<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Y&amp;F</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="The last theme you&#39;ll ever need. Maybe.">
    <meta name="generator" content="Hugo 0.141.0">
    
    
    
      <meta name="robots" content="index, follow">
    
    
      <meta name="author" content = "钱甫新">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.d05fb5f317fcf33b3a52936399bdf6f47dc776516e1692e412ec7d76f4a5faa2.css" >



    

    
      

    

    
    
      <link href="/tags/index.xml" rel="alternate" type="application/rss+xml" title="Y&amp;F" />
      <link href="/tags/index.xml" rel="feed" type="application/rss+xml" title="Y&amp;F" />
      
    

    
      <link rel="canonical" href="https://qianfuxin.gitHub.io/tags/">
    

    <meta property="og:url" content="https://qianfuxin.gitHub.io/tags/">
  <meta property="og:site_name" content="Y&F">
  <meta property="og:title" content="Tags">
  <meta property="og:description" content="The last theme you&#39;ll ever need. Maybe.">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Tags">
  <meta itemprop="description" content="The last theme you&#39;ll ever need. Maybe.">
  <meta itemprop="datePublished" content="2025-08-15T10:58:08+00:00">
  <meta itemprop="dateModified" content="2025-08-15T10:58:08+00:00">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Tags">
  <meta name="twitter:description" content="The last theme you&#39;ll ever need. Maybe.">

      
    
	
  </head><body class="ma0 avenir bg-near-white production">

    

  <header>
    <div class="pb3-m pb6-l bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Y&amp;F
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/contact/" title="关于我 页">
              关于我
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/post/" title="文章 页">
              文章
            </a>
          </li>
          
        </ul>
      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

      <div class="tc-l pv3 ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">
          Tags
        </h1>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
    
  <article class="cf pa3 pa4-m pa4-l">
    <div class="measure-wide-l center f4 lh-copy nested-copy-line-height nested-links mid-gray">
      
    </div>
  </article>
  <div class="mw8 center">
    <section class="ph4">
      
        <h2 class="f1">
          <a href="/tags/huey/" class="link blue hover-black">
            Tag: Huey
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        八月 15, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/huey%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="link black dim">
        huey基本使用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <ul>
<li>
<p>异步任务队列</p>
</li>
<li>
<p>定时任务（类似 cron）</p>
</li>
<li>
<p>结果存储（可选）</p>
</li>
<li>
<p>重试、任务优先级</p>
</li>
</ul>
<p><a href="https://gist.github.com/QianFuXin/924d8de689c57911b8d609ab16516709">源码</a></p>
<p>开启消费者：<code>huey_consumer task.huey -w 2</code></p>
    </div>
  <a href="/post/huey%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/mcp/" class="link blue hover-black">
            Tag: Mcp
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        八月 15, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/pinot%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" class="link black dim">
        pinot本地部署与简单使用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="部署">部署</h1>
<p><a href="https://gist.github.com/QianFuXin/c6c5c1f9c67dc2866be863f8be06a8f6">链接</a></p>
<h1 id="验证">验证</h1>
<p>打开 <code>http://localhost:9000/#/</code></p>
<p>测试broker是否连接上 <code>curl http://localhost:9000/v2/brokers</code>
如果返回为空，有可能是因为开启容器的先后顺序导致。则 <code>docker restart pinot-broker</code></p>
<h1 id="创建表">创建表</h1>
<p><code>curl -X POST -H &quot;Content-Type: application/json&quot;   -d @schema.json   http://localhost:9000/schemas</code></p>
<pre tabindex="0"><code>{
  &#34;schemaName&#34;: &#34;my_table&#34;,
  &#34;dimensionFieldSpecs&#34;: [
    {&#34;name&#34;: &#34;id&#34;, &#34;dataType&#34;: &#34;STRING&#34;},
    {&#34;name&#34;: &#34;name&#34;, &#34;dataType&#34;: &#34;STRING&#34;}
  ],
  &#34;metricFieldSpecs&#34;: [
    {&#34;name&#34;: &#34;age&#34;, &#34;dataType&#34;: &#34;INT&#34;}
  ],
  &#34;dateTimeFieldSpecs&#34;: [
    {
      &#34;name&#34;: &#34;ts&#34;,
      &#34;dataType&#34;: &#34;LONG&#34;,
      &#34;format&#34;: &#34;1:MILLISECONDS:EPOCH&#34;,
      &#34;granularity&#34;: &#34;1:MILLISECONDS&#34;
    }
  ]
}
</code></pre><p><code>curl -X POST -H &quot;Content-Type: application/json&quot;  -d @table.json http://localhost:9000/tables</code></p>
<pre tabindex="0"><code>{
&#34;tableName&#34;: &#34;my_table&#34;,
&#34;tableType&#34;: &#34;OFFLINE&#34;,
&#34;segmentsConfig&#34;: {
&#34;timeColumnName&#34;: &#34;ts&#34;,
&#34;schemaName&#34;: &#34;my_table&#34;,
&#34;replication&#34;: &#34;1&#34;
},
&#34;tableIndexConfig&#34;: {
&#34;loadMode&#34;: &#34;MMAP&#34;
},
&#34;tenants&#34;: {},
&#34;metadata&#34;: {}
}
</code></pre><h1 id="测试">测试</h1>
<p><a href="https://github.com/QianFuXin/mcps/blob/main/mcp_pinot.py">源码</a></p>
    </div>
  <a href="/post/pinot%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/pinot/" class="link blue hover-black">
            Tag: Pinot
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        八月 15, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/pinot%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" class="link black dim">
        pinot本地部署与简单使用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="部署">部署</h1>
<p><a href="https://gist.github.com/QianFuXin/c6c5c1f9c67dc2866be863f8be06a8f6">链接</a></p>
<h1 id="验证">验证</h1>
<p>打开 <code>http://localhost:9000/#/</code></p>
<p>测试broker是否连接上 <code>curl http://localhost:9000/v2/brokers</code>
如果返回为空，有可能是因为开启容器的先后顺序导致。则 <code>docker restart pinot-broker</code></p>
<h1 id="创建表">创建表</h1>
<p><code>curl -X POST -H &quot;Content-Type: application/json&quot;   -d @schema.json   http://localhost:9000/schemas</code></p>
<pre tabindex="0"><code>{
  &#34;schemaName&#34;: &#34;my_table&#34;,
  &#34;dimensionFieldSpecs&#34;: [
    {&#34;name&#34;: &#34;id&#34;, &#34;dataType&#34;: &#34;STRING&#34;},
    {&#34;name&#34;: &#34;name&#34;, &#34;dataType&#34;: &#34;STRING&#34;}
  ],
  &#34;metricFieldSpecs&#34;: [
    {&#34;name&#34;: &#34;age&#34;, &#34;dataType&#34;: &#34;INT&#34;}
  ],
  &#34;dateTimeFieldSpecs&#34;: [
    {
      &#34;name&#34;: &#34;ts&#34;,
      &#34;dataType&#34;: &#34;LONG&#34;,
      &#34;format&#34;: &#34;1:MILLISECONDS:EPOCH&#34;,
      &#34;granularity&#34;: &#34;1:MILLISECONDS&#34;
    }
  ]
}
</code></pre><p><code>curl -X POST -H &quot;Content-Type: application/json&quot;  -d @table.json http://localhost:9000/tables</code></p>
<pre tabindex="0"><code>{
&#34;tableName&#34;: &#34;my_table&#34;,
&#34;tableType&#34;: &#34;OFFLINE&#34;,
&#34;segmentsConfig&#34;: {
&#34;timeColumnName&#34;: &#34;ts&#34;,
&#34;schemaName&#34;: &#34;my_table&#34;,
&#34;replication&#34;: &#34;1&#34;
},
&#34;tableIndexConfig&#34;: {
&#34;loadMode&#34;: &#34;MMAP&#34;
},
&#34;tenants&#34;: {},
&#34;metadata&#34;: {}
}
</code></pre><h1 id="测试">测试</h1>
<p><a href="https://github.com/QianFuXin/mcps/blob/main/mcp_pinot.py">源码</a></p>
    </div>
  <a href="/post/pinot%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E5%BC%82%E6%AD%A5/" class="link blue hover-black">
            Tag: 异步
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        八月 15, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/huey%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="link black dim">
        huey基本使用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <ul>
<li>
<p>异步任务队列</p>
</li>
<li>
<p>定时任务（类似 cron）</p>
</li>
<li>
<p>结果存储（可选）</p>
</li>
<li>
<p>重试、任务优先级</p>
</li>
</ul>
<p><a href="https://gist.github.com/QianFuXin/924d8de689c57911b8d609ab16516709">源码</a></p>
<p>开启消费者：<code>huey_consumer task.huey -w 2</code></p>
    </div>
  <a href="/post/huey%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/airflow/" class="link blue hover-black">
            Tag: Airflow
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        七月 5, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/linux%E9%85%8D%E7%BD%AE%E5%8D%95%E6%9C%BAairflow/" class="link black dim">
        linux配置单机airflow
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装airflow">安装airflow</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>AIRFLOW_VERSION<span style="color:#f92672">=</span>3.0.2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Extract the version of Python you have installed. If you&#39;re currently using a Python version that is not supported by Airflow, you may want to set this manually.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># See above for supported versions.</span>
</span></span><span style="display:flex;"><span>PYTHON_VERSION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>python -c <span style="color:#e6db74">&#39;import sys; print(f&#34;{sys.version_info.major}.{sys.version_info.minor}&#34;)&#39;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CONSTRAINT_URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://raw.githubusercontent.com/apache/airflow/constraints-</span><span style="color:#e6db74">${</span>AIRFLOW_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">/constraints-</span><span style="color:#e6db74">${</span>PYTHON_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">.txt&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># For example this would install 3.0.0 with python 3.9: https://raw.githubusercontent.com/apache/airflow/constraints-3.0.2/constraints-3.9.txt</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>uv pip install <span style="color:#e6db74">&#34;apache-airflow==</span><span style="color:#e6db74">${</span>AIRFLOW_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> --constraint <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CONSTRAINT_URL<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><blockquote>
<p>如果报错libcst==1.8.0没安装成功，且需要rust环境，则执行以下内容</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 国内环境</span>
</span></span><span style="display:flex;"><span>export RUSTUP_DIST_SERVER<span style="color:#f92672">=</span>https://mirrors.tuna.tsinghua.edu.cn/rustup
</span></span><span style="display:flex;"><span>export RUSTUP_UPDATE_ROOT<span style="color:#f92672">=</span>https://mirrors.tuna.tsinghua.edu.cn/rustup/rustup
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装</span>
</span></span><span style="display:flex;"><span>curl --proto <span style="color:#e6db74">&#39;=https&#39;</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 刷新</span>
</span></span><span style="display:flex;"><span>source $HOME/.cargo/env
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 验证</span>
</span></span><span style="display:flex;"><span>rustc --version
</span></span><span style="display:flex;"><span>cargo --version
</span></span></code></pre></div><blockquote>
<p>如果出现 could not compile pyo3` (lib)</p>
    </div>
  <a href="/post/linux%E9%85%8D%E7%BD%AE%E5%8D%95%E6%9C%BAairflow/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 3, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BD%BF%E7%94%A8airflow%E5%AE%9A%E4%B9%89%E4%BB%BB%E5%8A%A1/" class="link black dim">
        使用airflow定义任务
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装">安装</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 默认值</span>
</span></span><span style="display:flex;"><span>export AIRFLOW_HOME<span style="color:#f92672">=</span>~/airflow
</span></span><span style="display:flex;"><span>AIRFLOW_VERSION<span style="color:#f92672">=</span>2.9.3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Extract the version of Python you have installed. If you&#39;re currently using a Python version that is not supported by Airflow, you may want to set this manually.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># See above for supported versions.</span>
</span></span><span style="display:flex;"><span>PYTHON_VERSION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>python -c <span style="color:#e6db74">&#39;import sys; print(f&#34;{sys.version_info.major}.{sys.version_info.minor}&#34;)&#39;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CONSTRAINT_URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://raw.githubusercontent.com/apache/airflow/constraints-</span><span style="color:#e6db74">${</span>AIRFLOW_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">/constraints-</span><span style="color:#e6db74">${</span>PYTHON_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">.txt&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># For example this would install 2.9.3 with python 3.8: https://raw.githubusercontent.com/apache/airflow/constraints-2.9.3/constraints-3.8.txt</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pip install <span style="color:#e6db74">&#34;apache-airflow==</span><span style="color:#e6db74">${</span>AIRFLOW_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> --constraint <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CONSTRAINT_URL<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 开启</span>
</span></span><span style="display:flex;"><span>airflow standalone
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 初始账户为admin 密码为standalone_admin_password.txt</span>
</span></span></code></pre></div><h1 id="创建任务">创建任务</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir dags
</span></span><span style="display:flex;"><span>cd dags
</span></span><span style="display:flex;"><span>vim my_task.py
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> textwrap
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The DAG object; we&#39;ll need this to instantiate a DAG</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> airflow.models.dag <span style="color:#f92672">import</span> DAG
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Operators; we need this to operate!</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> airflow.operators.bash <span style="color:#f92672">import</span> BashOperator
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> DAG(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;tutorial&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># These args will get passed on to each operator</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># You can override them on a per-task basis during operator initialization</span>
</span></span><span style="display:flex;"><span>    default_args<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;depends_on_past&#34;</span>: <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;email&#34;</span>: [<span style="color:#e6db74">&#34;airflow@example.com&#34;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;email_on_failure&#34;</span>: <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;email_on_retry&#34;</span>: <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;retries&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;retry_delay&#34;</span>: timedelta(minutes<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;queue&#39;: &#39;bash_queue&#39;,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;pool&#39;: &#39;backfill&#39;,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;priority_weight&#39;: 10,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;end_date&#39;: datetime(2016, 1, 1),</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;wait_for_downstream&#39;: False,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;sla&#39;: timedelta(hours=2),</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;execution_timeout&#39;: timedelta(seconds=300),</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;on_failure_callback&#39;: some_function, # or list of functions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;on_success_callback&#39;: some_other_function, # or list of functions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;on_retry_callback&#39;: another_function, # or list of functions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;sla_miss_callback&#39;: yet_another_function, # or list of functions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;on_skipped_callback&#39;: another_function, #or list of functions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;trigger_rule&#39;: &#39;all_success&#39;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;A simple tutorial DAG&#34;</span>,
</span></span><span style="display:flex;"><span>    schedule<span style="color:#f92672">=</span>timedelta(days<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    start_date<span style="color:#f92672">=</span>datetime(<span style="color:#ae81ff">2021</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    catchup<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    tags<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;example&#34;</span>],
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">as</span> dag:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># t1, t2 and t3 are examples of tasks created by instantiating operators</span>
</span></span><span style="display:flex;"><span>    t1 <span style="color:#f92672">=</span> BashOperator(
</span></span><span style="display:flex;"><span>        task_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;print_date&#34;</span>,
</span></span><span style="display:flex;"><span>        bash_command<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;date&#34;</span>,
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    t2 <span style="color:#f92672">=</span> BashOperator(
</span></span><span style="display:flex;"><span>        task_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sleep&#34;</span>,
</span></span><span style="display:flex;"><span>        depends_on_past<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        bash_command<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sleep 5&#34;</span>,
</span></span><span style="display:flex;"><span>        retries<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    t1<span style="color:#f92672">.</span>doc_md <span style="color:#f92672">=</span> textwrap<span style="color:#f92672">.</span>dedent(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">    #### Task Documentation
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    You can document your task using the attributes `doc_md` (markdown),
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    `doc` (plain text), `doc_rst`, `doc_json`, `doc_yaml` which gets
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    rendered in the UI&#39;s Task Instance Details page.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ![img](https://imgs.xkcd.com/comics/fixing_problems.png)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    **Image Credit:** Randall Munroe, [XKCD](https://xkcd.com/license.html)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dag<span style="color:#f92672">.</span>doc_md <span style="color:#f92672">=</span> __doc__  <span style="color:#75715e"># providing that you have a docstring at the beginning of the DAG; OR</span>
</span></span><span style="display:flex;"><span>    dag<span style="color:#f92672">.</span>doc_md <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    This is a documentation placed anywhere
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>  <span style="color:#75715e"># otherwise, type it like this</span>
</span></span><span style="display:flex;"><span>    templated_command <span style="color:#f92672">=</span> textwrap<span style="color:#f92672">.</span>dedent(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {</span><span style="color:#e6db74">% f</span><span style="color:#e6db74">or i in range(5) %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo &#34;{{ ds }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo &#34;{{ macros.ds_add(ds, 7)}}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {</span><span style="color:#e6db74">% e</span><span style="color:#e6db74">ndfor %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    t3 <span style="color:#f92672">=</span> BashOperator(
</span></span><span style="display:flex;"><span>        task_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;templated&#34;</span>,
</span></span><span style="display:flex;"><span>        depends_on_past<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        bash_command<span style="color:#f92672">=</span>templated_command,
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    t1 <span style="color:#f92672">&gt;&gt;</span> [t2, t3]
</span></span></code></pre></div>
    </div>
  <a href="/post/%E4%BD%BF%E7%94%A8airflow%E5%AE%9A%E4%B9%89%E4%BB%BB%E5%8A%A1/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/linux/" class="link blue hover-black">
            Tag: Linux
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        七月 5, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/linux%E9%85%8D%E7%BD%AE%E5%8D%95%E6%9C%BAairflow/" class="link black dim">
        linux配置单机airflow
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装airflow">安装airflow</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>AIRFLOW_VERSION<span style="color:#f92672">=</span>3.0.2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Extract the version of Python you have installed. If you&#39;re currently using a Python version that is not supported by Airflow, you may want to set this manually.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># See above for supported versions.</span>
</span></span><span style="display:flex;"><span>PYTHON_VERSION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>python -c <span style="color:#e6db74">&#39;import sys; print(f&#34;{sys.version_info.major}.{sys.version_info.minor}&#34;)&#39;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CONSTRAINT_URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://raw.githubusercontent.com/apache/airflow/constraints-</span><span style="color:#e6db74">${</span>AIRFLOW_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">/constraints-</span><span style="color:#e6db74">${</span>PYTHON_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">.txt&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># For example this would install 3.0.0 with python 3.9: https://raw.githubusercontent.com/apache/airflow/constraints-3.0.2/constraints-3.9.txt</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>uv pip install <span style="color:#e6db74">&#34;apache-airflow==</span><span style="color:#e6db74">${</span>AIRFLOW_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> --constraint <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CONSTRAINT_URL<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><blockquote>
<p>如果报错libcst==1.8.0没安装成功，且需要rust环境，则执行以下内容</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 国内环境</span>
</span></span><span style="display:flex;"><span>export RUSTUP_DIST_SERVER<span style="color:#f92672">=</span>https://mirrors.tuna.tsinghua.edu.cn/rustup
</span></span><span style="display:flex;"><span>export RUSTUP_UPDATE_ROOT<span style="color:#f92672">=</span>https://mirrors.tuna.tsinghua.edu.cn/rustup/rustup
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装</span>
</span></span><span style="display:flex;"><span>curl --proto <span style="color:#e6db74">&#39;=https&#39;</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 刷新</span>
</span></span><span style="display:flex;"><span>source $HOME/.cargo/env
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 验证</span>
</span></span><span style="display:flex;"><span>rustc --version
</span></span><span style="display:flex;"><span>cargo --version
</span></span></code></pre></div><blockquote>
<p>如果出现 could not compile pyo3` (lib)</p>
    </div>
  <a href="/post/linux%E9%85%8D%E7%BD%AE%E5%8D%95%E6%9C%BAairflow/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        三月 8, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/linux%E4%BD%BF%E7%94%A8clash/" class="link black dim">
        linux使用clash
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="大概流程">大概流程</h1>
<p>首先配置web页面，便于后续通过web去切换线路和节点。</p>
<p>然后配置clash本体，获取配置文件并修改，最后启动程序。</p>
<h1 id="配置clash">配置clash</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir /etc/clash/  <span style="color:#f92672">&amp;&amp;</span> cd /etc/clash/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://w2.v2free.top/ssr-download/clash-dashboard.tar.gz</span>
</span></span><span style="display:flex;"><span>tar zxvf clash-dashboard.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir  ~/.config/
</span></span><span style="display:flex;"><span>mkdir  ~/.config/mihomo/
</span></span><span style="display:flex;"><span>cd     ~/.config/mihomo/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://w2.v2free.top/ssr-download/clash-linux.tar.gz</span>
</span></span><span style="display:flex;"><span>tar xvf clash-linux.tar.gz
</span></span><span style="display:flex;"><span>chmod +x clash-linux
</span></span><span style="display:flex;"><span>wget -U <span style="color:#e6db74">&#34;Mozilla/6.0&#34;</span> -O ~/.config/mihomo/config.yaml <span style="color:#e6db74">&#34;https://v1.v2ai.top/link/IVEMbb14xsh6zW87?clash=2&#34;</span>
</span></span><span style="display:flex;"><span>vim config.yaml 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 在配置文件中修改或增加以下内容；</span>
</span></span><span style="display:flex;"><span>external-controller: 127.0.0.1:9090 <span style="color:#75715e"># 如果你不是从本机访问，需要从其它机器访问这个Clash Dashboard ,则改为：0.0.0.0:9090</span>
</span></span><span style="display:flex;"><span>external-ui: /etc/clash/clash-dashboard <span style="color:#75715e"># clash-dashboard的路径；</span>
</span></span><span style="display:flex;"><span>secret: <span style="color:#e6db74">&#39;PaaRwW3B1Kj9&#39;</span> <span style="color:#75715e"># PaaRwW3B1Kj9 是登录web管理界面的密码，请自行设置你自己的,不要照抄教程中的密码；</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启动代理</span>
</span></span><span style="display:flex;"><span>nohup /clash-linux &gt; clash.log 2&gt;&amp;<span style="color:#ae81ff">1</span> &amp;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 访问对应的端口号选择代理:127.0.0.1:9090/ui</span>
</span></span></code></pre></div>
    </div>
  <a href="/post/linux%E4%BD%BF%E7%94%A8clash/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/ollama/" class="link blue hover-black">
            Tag: Ollama
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        五月 24, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/ollama%E4%BD%BF%E7%94%A8%E5%B0%8F%E5%8F%82%E6%95%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%BB%E5%8A%A1/" class="link black dim">
        ollama使用小参数大模型实现简单的任务
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="实际意义">实际意义</h1>
<p>很多场景下都是简单的任务，如果都用大参数大模型去处理，并发、资源、耗时都是问题。</p>
<p>所以对于某些简单的任务，可以让小参数大模型去做，不要精确率多高，只要有效，哪怕百分之十，配上程序的逻辑判断，都可以为生产做贡献。</p>
<h1 id="构建">构建</h1>
<h2 id="modelfile">modelfile</h2>
<pre tabindex="0"><code>FROM qwen3:0.6b
# 设置温度，较低的温度使输出更具确定性和一致性，适合分类任务
# 对于小模型，较低的温度有助于减少不相关或错误的输出
PARAMETER temperature 0.1

# 系统提示：明确告知模型其角色和任务，以及预期的输出类别
# 对于小模型，指令需要非常直接和清晰
SYSTEM 你是一个文本情绪分析助手。请将用户输入的文本分类为“积极”、“消极”或“中性”。

# 少样本提示：提供清晰的输入输出样例，帮助模型理解任务
# 样例要简单直接，符合小模型的理解能力
MESSAGE user 今天阳光明媚，我心情很好！
MESSAGE assistant 积极
MESSAGE user 我的项目失败了，感觉很难过。
MESSAGE assistant 消极
MESSAGE user 会议将在下午三点开始。
MESSAGE assistant 中性
MESSAGE user 这家餐厅的食物味道一般。
MESSAGE assistant 中性
</code></pre><h2 id="构建-1">构建</h2>
<p><code>ollama create emotion_cls -f ./Modelfile</code></p>
<h2 id="使用">使用</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl http://localhost:11434/api/generate -d <span style="color:#e6db74">&#39;{ &#34;model&#34;: &#34;emotion_cls&#34;,&#34;prompt&#34;:&#34;哈哈哈哈&#34;, &#34;stream&#34;: false}&#39;</span> | jq .
</span></span></code></pre></div><p>不使用思考模式</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl http://localhost:11434/api/generate -d <span style="color:#e6db74">&#39;{ &#34;model&#34;: &#34;emotion_cls&#34;,&#34;prompt&#34;:&#34;哈哈哈哈/no_think&#34;, &#34;stream&#34;: false}&#39;</span> | jq .
</span></span></code></pre></div>
    </div>
  <a href="/post/ollama%E4%BD%BF%E7%94%A8%E5%B0%8F%E5%8F%82%E6%95%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%BB%E5%8A%A1/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        三月 8, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E5%AE%9E%E7%8E%B0rag%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="link black dim">
        实现rag的几种方式
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="ollama提供embeddingsllm">ollama提供embeddings、llm</h1>
<ul>
<li>llm可以是ollama，或者接口为openai格式即可</li>
<li>embeddings服务由ollama提供</li>
<li>向量数据库容器提供（cpu）</li>
</ul>
<p><a href="https://gist.github.com/QianFuXin/39ba41e29a58e7b9b1636db06d774237">源码</a></p>
<h1 id="ollama提供llm容器提供embeddings">ollama提供llm，容器提供embeddings</h1>
<ul>
<li>llm可以是ollama，或者接口为openai格式即可</li>
<li>embeddings服务由HuggingFaceEmbeddings提供</li>
<li>向量数据库容器提供（cpu）</li>
</ul>
<p><a href="https://gist.github.com/QianFuXin/0e94c3875574f0315af9fe58a7b9b04e">源码</a></p>
<h1 id="llmembeddings向量数据库均由第三方提供">llm、embeddings、向量数据库均由第三方提供</h1>
<p><a href="https://gist.github.com/QianFuXin/78945087cab1e8321138025f307d570d">源码</a></p>
<h1 id="llmembeddings向量数据库关键字搜索es重排序均由第三方提供">llm、embeddings、向量数据库、关键字搜索（es）、重排序、均由第三方提供</h1>
<p><a href="https://gist.github.com/QianFuXin/31549fb7cdef55c956de0aeff817c19c">源码</a></p>
    </div>
  <a href="/post/%E5%AE%9E%E7%8E%B0rag%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 24, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/pythongui%E5%AE%9E%E7%8E%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%B5%81%E5%BC%8F%E5%AF%B9%E8%AF%9D_whisper_ollama/" class="link black dim">
        pythonGUI实现大模型流式对话_whisper_ollama
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="服务部署">服务部署</h1>
<h2 id="部署whisper-api服务">部署whisper api服务</h2>
<pre><code>version: '3.8'

services:
  whisper-asr:
    image: onerahmet/openai-whisper-asr-webservice:latest
    container_name: whisper-asr-service
    ports:
      - &quot;9099:9000&quot;
    volumes:
      - /Users/qianfuxin/dc/whisper:/root/.cache/whisper
    environment:
      - ASR_MODEL=base
      - ASR_ENGINE=openai_whisper
    restart: unless-stopped
</code></pre>
<h2 id="部署ollama">部署ollama</h2>
<p>见官网</p>
<h1 id="代码">代码</h1>
<pre><code>import mimetypes
import os
import sys
from datetime import datetime
import socksio
import requests
from PyQt5.QtWidgets import QApplication, QWidget, QVBoxLayout, QPushButton, QLabel, QTextEdit
import pyaudio
import wave
import threading
from langchain_core.messages import HumanMessage, SystemMessage
from langchain_core.output_parsers import StrOutputParser
from langchain_openai import ChatOpenAI


def transcribe_audio(file_path):
    &quot;&quot;&quot;
    Function to transcribe audio using the ASR service.

    :param file_path: The full path to the audio file to be transcribed.
    :return: The response text from the ASR service.
    &quot;&quot;&quot;
    # Ensure the file exists
    if not os.path.isfile(file_path):
        raise FileNotFoundError(f&quot;Audio file not found at: {file_path}&quot;)

    # Determine MIME type
    mime_type, _ = mimetypes.guess_type(file_path)
    if mime_type is None:
        raise ValueError(f&quot;Unable to determine MIME type for file: {file_path}&quot;)

    # Extract file name
    file_name = os.path.basename(file_path)

    url = &quot;http://localhost:9099/asr&quot;
    params = {
        &quot;encode&quot;: &quot;true&quot;,
        &quot;task&quot;: &quot;transcribe&quot;,
        &quot;language&quot;: &quot;zh&quot;,
        &quot;initial_prompt&quot;: &quot;这是一段简体中文&quot;,
        &quot;word_timestamps&quot;: &quot;false&quot;,
        &quot;output&quot;: &quot;txt&quot;
    }
    headers = {
        &quot;accept&quot;: &quot;application/json&quot;,
    }

    # Open the audio file
    with open(file_path, &quot;rb&quot;) as audio_file:
        files = {
            &quot;audio_file&quot;: (file_name, audio_file, mime_type)
        }

        # Send the POST request
        response = requests.post(url, headers=headers, params=params, files=files)
    return response.text


def get_model(base_url=&quot;http://127.0.0.1:11434/v1&quot;):
    &quot;&quot;&quot;Get the AI model instance.&quot;&quot;&quot;
    model = ChatOpenAI(
        api_key=&quot;ollama&quot;,
        model=&quot;qwen2&quot;,
        base_url=base_url
    )
    return model


class AudioRecorder:
    def __init__(self):
        self.p = pyaudio.PyAudio()
        self.stream = None
        self.frames = []
        self.device_index = None
        self.is_recording = False
        self.recording_thread = None

    def list_input_devices(self):
        &quot;&quot;&quot;List available input devices.&quot;&quot;&quot;
        device_list = []
        for i in range(self.p.get_device_count()):
            device_info = self.p.get_device_info_by_index(i)
            if device_info[&quot;maxInputChannels&quot;] &gt; 0:
                device_list.append((i, device_info[&quot;name&quot;]))
        return device_list

    def start_recording(self, device_index):
        &quot;&quot;&quot;Start recording with the specified device.&quot;&quot;&quot;
        self.device_index = device_index
        self.frames = []
        self.is_recording = True

        self.stream = self.p.open(format=pyaudio.paInt16,
                                  channels=1,
                                  rate=44100,
                                  input=True,
                                  input_device_index=device_index,
                                  frames_per_buffer=1024)

        self.recording_thread = threading.Thread(target=self.record)
        self.recording_thread.start()

    def record(self):
        &quot;&quot;&quot;Record audio in a separate thread.&quot;&quot;&quot;
        try:
            while self.is_recording:
                data = self.stream.read(1024, exception_on_overflow=False)
                self.frames.append(data)
        except IOError as e:
            print(f&quot;Buffer overflow occurred: {e}&quot;)

    def stop_recording(self, filename):
        &quot;&quot;&quot;Stop recording and save the file.&quot;&quot;&quot;
        if self.is_recording:
            self.is_recording = False
            if self.recording_thread and self.recording_thread.is_alive():
                self.recording_thread.join()

            if self.stream:
                self.stream.stop_stream()
                self.stream.close()
                self.stream = None

            with wave.open(filename, 'wb') as wf:
                wf.setnchannels(1)
                wf.setsampwidth(self.p.get_sample_size(pyaudio.paInt16))
                wf.setframerate(44100)
                wf.writeframes(b''.join(self.frames))

    def close(self):
        &quot;&quot;&quot;Close the PyAudio instance.&quot;&quot;&quot;
        self.p.terminate()


class RecorderApp(QWidget):
    def __init__(self):
        super().__init__()

        self.recorder = AudioRecorder()
        self.filename = None
        self.model = get_model()
        self.init_ui()

    def init_ui(self):
        self.setWindowTitle(&quot;实时语音识别与问答&quot;)
        self.setGeometry(100, 100, 500, 400)

        layout = QVBoxLayout()

        # 开启录音按钮
        self.start_button = QPushButton(&quot;开启录音&quot;)
        self.start_button.clicked.connect(self.start_recording)
        layout.addWidget(self.start_button)

        # 结束录音按钮
        self.stop_button = QPushButton(&quot;结束录音&quot;)
        self.stop_button.clicked.connect(self.stop_recording)
        self.stop_button.setEnabled(False)
        layout.addWidget(self.stop_button)

        # 状态显示标签
        self.status_label = QLabel(&quot;用户问题: &quot;, self)
        layout.addWidget(self.status_label)

        # 输出结果框
        self.output_box = QTextEdit(self)
        self.output_box.setReadOnly(True)
        layout.addWidget(self.output_box)

        self.setLayout(layout)

    def start_recording(self):
        device_index = 0  # For simplicity, we assume default device.
        start_time = datetime.now().strftime(&quot;%Y%m%d_%H%M%S&quot;)
        self.filename = f&quot;{start_time}.wav&quot;

        self.recorder.start_recording(device_index)
        self.start_button.setEnabled(False)
        self.stop_button.setEnabled(True)

    def stop_recording(self):
        self.recorder.stop_recording(self.filename)
        self.start_button.setEnabled(True)
        self.stop_button.setEnabled(False)

        # 转录音频并生成回答
        transcription = transcribe_audio(self.filename)
        self.status_label.setText(f&quot;用户问题: {transcription}&quot;)
        self.generate_answer(transcription)

    def generate_answer(self, transcription):
        &quot;&quot;&quot;
        Send the transcription to the large model and display the streamed response.
        &quot;&quot;&quot;
        QApplication.processEvents()

        messages = [
            SystemMessage(&quot;你是一个智能助手。&quot;),
            HumanMessage(content=transcription)
        ]
        parser = StrOutputParser()
        chain = self.model | parser

        response = &quot;&quot;
        for token in chain.stream(messages):
            response += token
            self.output_box.setText(response)
            QApplication.processEvents()


if __name__ == &quot;__main__&quot;:
    app = QApplication(sys.argv)
    window = RecorderApp()
    window.show()
    sys.exit(app.exec_())
</code></pre>
<h3 id="仅仅实现asr">仅仅实现ASR</h3>
<pre><code>import mimetypes
import os
import sys
from datetime import datetime

import requests
from PyQt5.QtGui import QIcon
from PyQt5.QtWidgets import QApplication, QWidget, QVBoxLayout, QPushButton, QLabel, QLineEdit, QComboBox, QMessageBox, \
    QSystemTrayIcon, QMenu, QAction
import pyaudio
import wave
import threading


def transcribe_audio(file_path):
    &quot;&quot;&quot;
    Function to transcribe audio using the ASR service.

    :param file_path: The full path to the audio file to be transcribed.
    :return: The response text from the ASR service.
    &quot;&quot;&quot;
    # Ensure the file exists
    if not os.path.isfile(file_path):
        raise FileNotFoundError(f&quot;Audio file not found at: {file_path}&quot;)

    # Determine MIME type
    mime_type, _ = mimetypes.guess_type(file_path)
    if mime_type is None:
        raise ValueError(f&quot;Unable to determine MIME type for file: {file_path}&quot;)

    # Extract file name
    file_name = os.path.basename(file_path)

    url = &quot;http://localhost:9099/asr&quot;
    params = {
        &quot;encode&quot;: &quot;true&quot;,
        &quot;task&quot;: &quot;transcribe&quot;,
        &quot;language&quot;: &quot;zh&quot;,
        &quot;initial_prompt&quot;: &quot;这是一段简体中文&quot;,
        &quot;word_timestamps&quot;: &quot;false&quot;,
        &quot;output&quot;: &quot;txt&quot;
    }
    headers = {
        &quot;accept&quot;: &quot;application/json&quot;,
    }

    # Open the audio file
    with open(file_path, &quot;rb&quot;) as audio_file:
        files = {
            &quot;audio_file&quot;: (file_name, audio_file, mime_type)
        }

        # Send the POST request
        response = requests.post(url, headers=headers, params=params, files=files)

    return response.text


class AudioRecorder:
    def __init__(self):
        self.p = pyaudio.PyAudio()
        self.stream = None
        self.frames = []
        self.device_index = None
        self.is_recording = False
        self.recording_thread = None

    def list_input_devices(self):
        &quot;&quot;&quot;列出所有可用的录音设备&quot;&quot;&quot;
        device_list = []
        for i in range(self.p.get_device_count()):
            device_info = self.p.get_device_info_by_index(i)
            # 筛选出录音设备
            if device_info[&quot;maxInputChannels&quot;] &gt; 0:
                device_list.append((i, device_info[&quot;name&quot;]))
        return device_list

    def start_recording(self, device_index):
        &quot;&quot;&quot;使用指定设备开始录音&quot;&quot;&quot;
        self.device_index = device_index
        self.frames = []
        self.is_recording = True

        self.stream = self.p.open(format=pyaudio.paInt16,
                                  channels=1,
                                  rate=44100,
                                  input=True,
                                  input_device_index=device_index,
                                  frames_per_buffer=1024)

        # 启动录音线程
        self.recording_thread = threading.Thread(target=self.record)
        self.recording_thread.start()

    def record(self):
        &quot;&quot;&quot;录音线程函数，用于捕获音频数据&quot;&quot;&quot;
        try:
            while self.is_recording:
                data = self.stream.read(1024, exception_on_overflow=False)
                self.frames.append(data)
        except IOError as e:
            print(f&quot;Buffer overflow occurred: {e}&quot;)

    def stop_recording(self, filename):
        &quot;&quot;&quot;停止录音并保存文件&quot;&quot;&quot;
        if self.is_recording:
            self.is_recording = False
            if self.recording_thread and self.recording_thread.is_alive():
                self.recording_thread.join()

            if self.stream:
                self.stream.stop_stream()
                self.stream.close()
                self.stream = None

            with wave.open(filename, 'wb') as wf:
                wf.setnchannels(1)
                wf.setsampwidth(self.p.get_sample_size(pyaudio.paInt16))
                wf.setframerate(44100)
                wf.writeframes(b''.join(self.frames))

    def close(self):
        &quot;&quot;&quot;关闭 PyAudio 实例&quot;&quot;&quot;
        self.p.terminate()


def resource_path(relative_path):
    &quot;&quot;&quot;获取资源文件的绝对路径&quot;&quot;&quot;
    if hasattr(sys, '_MEIPASS'):
        return os.path.join(sys._MEIPASS, relative_path)
    return os.path.join(os.path.abspath(&quot;.&quot;), relative_path)


class RecorderApp(QWidget):
    def __init__(self):
        super().__init__()

        self.recorder = AudioRecorder()
        self.filename = None

        self.init_ui()

    def init_ui(self):
        self.setWindowTitle(&quot;录音器&quot;)
        self.setGeometry(100, 100, 400, 300)

        # 创建系统托盘图标
        self.tray_icon = QSystemTrayIcon(self)
        self.tray_icon.setIcon(QIcon(resource_path(&quot;icon.png&quot;)))

        # 创建托盘菜单
        tray_menu = QMenu()

        # 添加显示窗口的选项
        show_action = QAction(&quot;显示窗口&quot;, self)
        show_action.triggered.connect(self.show)
        tray_menu.addAction(show_action)

        # 添加退出的选项
        exit_action = QAction(&quot;退出&quot;, self)
        exit_action.triggered.connect(QApplication.instance().quit)
        tray_menu.addAction(exit_action)

        # 将菜单添加到托盘图标
        self.tray_icon.setContextMenu(tray_menu)

        # 设置点击双击托盘图标的动作
        self.tray_icon.activated.connect(self.on_tray_icon_activated)

        # 显示托盘图标
        self.tray_icon.show()

        layout = QVBoxLayout()

        # 开启录音按钮
        self.start_button = QPushButton(&quot;开启录音&quot;)
        self.start_button.clicked.connect(self.start_recording)
        layout.addWidget(self.start_button)

        # 结束录音按钮
        self.stop_button = QPushButton(&quot;结束录音&quot;)
        self.stop_button.clicked.connect(self.stop_recording)
        self.stop_button.setEnabled(False)
        layout.addWidget(self.stop_button)

        # 设备选择下拉菜单
        self.device_selector = QComboBox(self)
        devices = self.recorder.list_input_devices()
        if devices:
            for index, name in devices:
                self.device_selector.addItem(name, index)
        else:
            QMessageBox.warning(self, &quot;错误&quot;, &quot;未检测到录音设备&quot;)
            self.start_button.setEnabled(False)
        layout.addWidget(self.device_selector)

        # 状态显示标签
        self.status_label = QLabel(&quot;状态: 未录音&quot;, self)
        layout.addWidget(self.status_label)

        self.setLayout(layout)

    def closeEvent(self, event):
        &quot;&quot;&quot;窗口关闭事件&quot;&quot;&quot;
        if self.isVisible():  # 如果窗口可见，则最小化到托盘
            event.ignore()
            self.hide()
            self.tray_icon.showMessage(
                &quot;应用最小化&quot;, &quot;程序已最小化到托盘&quot;,
                QSystemTrayIcon.Information, 2000
            )
        else:  # 关闭应用时清理资源
            self.recorder.close()
            event.accept()

    def on_tray_icon_activated(self, reason):
        &quot;&quot;&quot;托盘图标激活事件&quot;&quot;&quot;
        if reason == QSystemTrayIcon.DoubleClick:
            self.show()

    def start_recording(self):
        device_index = self.device_selector.currentData()
        start_time = datetime.now().strftime(&quot;%Y%m%d_%H%M%S&quot;)
        self.filename = f&quot;{start_time}.wav&quot;

        self.recorder.start_recording(device_index)
        self.status_label.setText(&quot;状态: 录音中...&quot;)
        self.start_button.setEnabled(False)
        self.stop_button.setEnabled(True)

    def stop_recording(self):
        end_time = datetime.now().strftime(&quot;%Y%m%d_%H%M%S&quot;)
        self.filename = f&quot;{self.filename[:-4]}-{end_time}.wav&quot;  # 更新文件名
        self.recorder.stop_recording(self.filename)
        self.status_label.setText(f&quot;状态: 录音已保存为 {self.filename}&quot;)
        self.start_button.setEnabled(True)
        self.stop_button.setEnabled(False)
        self.status_label.setText(f&quot;状态: 录音已保存为 {self.filename}\n录音内容：{transcribe_audio(self.filename)}&quot;)


# 主程序入口
if __name__ == &quot;__main__&quot;:
    app = QApplication(sys.argv)
    window = RecorderApp()
    window.show()
    sys.exit(app.exec_())
    &quot;&quot;&quot;
    pyinstaller --onefile --windowed --noconfirm --add-data &quot;icon.png;.&quot; app.py
    &quot;&quot;&quot;
</code></pre>
    </div>
  <a href="/post/pythongui%E5%AE%9E%E7%8E%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%B5%81%E5%BC%8F%E5%AF%B9%E8%AF%9D_whisper_ollama/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/qwen3/" class="link blue hover-black">
            Tag: Qwen3
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        五月 24, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BD%BF%E7%94%A8vllm%E9%83%A8%E7%BD%B2qwen3/" class="link black dim">
        使用vllm部署qwen3
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="获取镜像">获取镜像</h1>
<p><code>vllm/vllm-openai:latest</code></p>
<h1 id="下载模型文件">下载模型文件</h1>
<p><code>modelscope download --model 'Qwen/Qwen3-14b' --local_dir 'path/to/dir'</code></p>
<h1 id="启动容器">启动容器</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 如果资源够，可以去掉--max-model-len 8192</span>
</span></span><span style="display:flex;"><span>docker run -d --gpus<span style="color:#f92672">=</span>all -v /data/hjh/Qwen3-14B-Int8-W8A16:/model/14b --network host --name qwen3 vllm/vllm-openai --model /model/14b --host 0.0.0.0 --port <span style="color:#ae81ff">11001</span> --max-model-len <span style="color:#ae81ff">8192</span>
</span></span></code></pre></div><p>默认使用第一块卡，如果想使用其他卡：<code>-e CUDA_VISIBLE_DEVICES=&quot;3&quot;</code></p>
    </div>
  <a href="/post/%E4%BD%BF%E7%94%A8vllm%E9%83%A8%E7%BD%B2qwen3/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/vllm/" class="link blue hover-black">
            Tag: Vllm
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        五月 24, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BD%BF%E7%94%A8vllm%E9%83%A8%E7%BD%B2qwen3/" class="link black dim">
        使用vllm部署qwen3
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="获取镜像">获取镜像</h1>
<p><code>vllm/vllm-openai:latest</code></p>
<h1 id="下载模型文件">下载模型文件</h1>
<p><code>modelscope download --model 'Qwen/Qwen3-14b' --local_dir 'path/to/dir'</code></p>
<h1 id="启动容器">启动容器</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 如果资源够，可以去掉--max-model-len 8192</span>
</span></span><span style="display:flex;"><span>docker run -d --gpus<span style="color:#f92672">=</span>all -v /data/hjh/Qwen3-14B-Int8-W8A16:/model/14b --network host --name qwen3 vllm/vllm-openai --model /model/14b --host 0.0.0.0 --port <span style="color:#ae81ff">11001</span> --max-model-len <span style="color:#ae81ff">8192</span>
</span></span></code></pre></div><p>默认使用第一块卡，如果想使用其他卡：<code>-e CUDA_VISIBLE_DEVICES=&quot;3&quot;</code></p>
    </div>
  <a href="/post/%E4%BD%BF%E7%94%A8vllm%E9%83%A8%E7%BD%B2qwen3/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B/" class="link blue hover-black">
            Tag: 大模型
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        五月 24, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/ollama%E4%BD%BF%E7%94%A8%E5%B0%8F%E5%8F%82%E6%95%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%BB%E5%8A%A1/" class="link black dim">
        ollama使用小参数大模型实现简单的任务
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="实际意义">实际意义</h1>
<p>很多场景下都是简单的任务，如果都用大参数大模型去处理，并发、资源、耗时都是问题。</p>
<p>所以对于某些简单的任务，可以让小参数大模型去做，不要精确率多高，只要有效，哪怕百分之十，配上程序的逻辑判断，都可以为生产做贡献。</p>
<h1 id="构建">构建</h1>
<h2 id="modelfile">modelfile</h2>
<pre tabindex="0"><code>FROM qwen3:0.6b
# 设置温度，较低的温度使输出更具确定性和一致性，适合分类任务
# 对于小模型，较低的温度有助于减少不相关或错误的输出
PARAMETER temperature 0.1

# 系统提示：明确告知模型其角色和任务，以及预期的输出类别
# 对于小模型，指令需要非常直接和清晰
SYSTEM 你是一个文本情绪分析助手。请将用户输入的文本分类为“积极”、“消极”或“中性”。

# 少样本提示：提供清晰的输入输出样例，帮助模型理解任务
# 样例要简单直接，符合小模型的理解能力
MESSAGE user 今天阳光明媚，我心情很好！
MESSAGE assistant 积极
MESSAGE user 我的项目失败了，感觉很难过。
MESSAGE assistant 消极
MESSAGE user 会议将在下午三点开始。
MESSAGE assistant 中性
MESSAGE user 这家餐厅的食物味道一般。
MESSAGE assistant 中性
</code></pre><h2 id="构建-1">构建</h2>
<p><code>ollama create emotion_cls -f ./Modelfile</code></p>
<h2 id="使用">使用</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl http://localhost:11434/api/generate -d <span style="color:#e6db74">&#39;{ &#34;model&#34;: &#34;emotion_cls&#34;,&#34;prompt&#34;:&#34;哈哈哈哈&#34;, &#34;stream&#34;: false}&#39;</span> | jq .
</span></span></code></pre></div><p>不使用思考模式</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl http://localhost:11434/api/generate -d <span style="color:#e6db74">&#39;{ &#34;model&#34;: &#34;emotion_cls&#34;,&#34;prompt&#34;:&#34;哈哈哈哈/no_think&#34;, &#34;stream&#34;: false}&#39;</span> | jq .
</span></span></code></pre></div>
    </div>
  <a href="/post/ollama%E4%BD%BF%E7%94%A8%E5%B0%8F%E5%8F%82%E6%95%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%BB%E5%8A%A1/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        五月 24, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BD%BF%E7%94%A8vllm%E9%83%A8%E7%BD%B2qwen3/" class="link black dim">
        使用vllm部署qwen3
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="获取镜像">获取镜像</h1>
<p><code>vllm/vllm-openai:latest</code></p>
<h1 id="下载模型文件">下载模型文件</h1>
<p><code>modelscope download --model 'Qwen/Qwen3-14b' --local_dir 'path/to/dir'</code></p>
<h1 id="启动容器">启动容器</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 如果资源够，可以去掉--max-model-len 8192</span>
</span></span><span style="display:flex;"><span>docker run -d --gpus<span style="color:#f92672">=</span>all -v /data/hjh/Qwen3-14B-Int8-W8A16:/model/14b --network host --name qwen3 vllm/vllm-openai --model /model/14b --host 0.0.0.0 --port <span style="color:#ae81ff">11001</span> --max-model-len <span style="color:#ae81ff">8192</span>
</span></span></code></pre></div><p>默认使用第一块卡，如果想使用其他卡：<code>-e CUDA_VISIBLE_DEVICES=&quot;3&quot;</code></p>
    </div>
  <a href="/post/%E4%BD%BF%E7%94%A8vllm%E9%83%A8%E7%BD%B2qwen3/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        一月 21, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E9%80%9A%E8%BF%87%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E6%96%87%E4%BB%B6/" class="link black dim">
        通过大模型自动生成代码文件
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><strong>本质上定义一个写入本地文件的工具，然后大模型调用这个工具来生成本地代码文件</strong></p>
<h1 id="代码">代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> langchain_cohere <span style="color:#f92672">import</span> ChatCohere
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> langchain_core.messages <span style="color:#f92672">import</span> HumanMessage
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> langchain_core.tools <span style="color:#f92672">import</span> tool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@tool</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">write_python_script</span>(file_path: str, content: str) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    将给定的 Python 脚本内容写入到指定文件中。
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        file_path (str): 要写入的文件路径。
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        content (str): Python 脚本内容。
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 只保留文件名</span>
</span></span><span style="display:flex;"><span>    file_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>basename(file_path)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 放到指定目录下</span>
</span></span><span style="display:flex;"><span>    script_dir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;script_dir&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 确保目录存在</span>
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>makedirs(script_dir, exist_ok<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 写入文件</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(script_dir, file_path), <span style="color:#e6db74">&#39;w&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        f<span style="color:#f92672">.</span>write(content)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;===Python 脚本已写入到 </span><span style="color:#e6db74">{</span>script_dir<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>file_path<span style="color:#e6db74">}</span><span style="color:#e6db74">===&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tools <span style="color:#f92672">=</span> [write_python_script]
</span></span><span style="display:flex;"><span>llm <span style="color:#f92672">=</span> ChatCohere(cohere_api_key<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;xxx&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将工具绑定到模型</span>
</span></span><span style="display:flex;"><span>llm_with_tools <span style="color:#f92672">=</span> llm<span style="color:#f92672">.</span>bind_tools(tools)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">帮我编写一个python文件，文件名你来设置，实现以下功能：
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1.使用flask编写接口
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">格式：路由名称、接收的方法、入参类型、获取入参的name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - index、post、json、[name,age]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - home、get、param、[id]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2. 如果main则启动flask，host为0.0.0.0,端口为9999
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 构造初始消息</span>
</span></span><span style="display:flex;"><span>messages <span style="color:#f92672">=</span> [HumanMessage(query)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用模型处理问题，选择工具</span>
</span></span><span style="display:flex;"><span>ai_msg <span style="color:#f92672">=</span> llm_with_tools<span style="color:#f92672">.</span>invoke(messages)
</span></span><span style="display:flex;"><span>messages<span style="color:#f92672">.</span>append(ai_msg)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 根据模型选择的工具和参数调用工具</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> tool_call <span style="color:#f92672">in</span> ai_msg<span style="color:#f92672">.</span>tool_calls:
</span></span><span style="display:flex;"><span>    selected_tool <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;write_python_script&#34;</span>: write_python_script}[tool_call[<span style="color:#e6db74">&#34;name&#34;</span>]<span style="color:#f92672">.</span>lower()]
</span></span><span style="display:flex;"><span>    tool_msg <span style="color:#f92672">=</span> selected_tool<span style="color:#f92672">.</span>invoke(tool_call)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 将工具调用结果加入对话记录</span>
</span></span><span style="display:flex;"><span>    messages<span style="color:#f92672">.</span>append(tool_msg)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将所有上下文重新发送给模型，生成最终回答</span>
</span></span><span style="display:flex;"><span>final_response <span style="color:#f92672">=</span> llm_with_tools<span style="color:#f92672">.</span>invoke(messages)<span style="color:#f92672">.</span>content
</span></span><span style="display:flex;"><span>print(final_response)
</span></span></code></pre></div>
    </div>
  <a href="/post/%E9%80%9A%E8%BF%87%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E6%96%87%E4%BB%B6/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 9, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E6%9C%AC%E5%9C%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E4%B8%AD%E6%96%87llama3_2%E5%B9%B6%E6%8F%90%E4%BE%9B%E7%AE%80%E5%8D%95%E5%AF%B9%E8%AF%9D%E9%A1%B5%E9%9D%A2/" class="link black dim">
        本地自定义构建中文llama3_2并提供简单对话页面
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="构建中文llama32">构建中文llama3.2</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>FROM llama3.2
</span></span><span style="display:flex;"><span>TEMPLATE <span style="color:#e6db74">&#34;&#34;&#34;{{ if .System }}&lt;|start_header_id|&gt;system&lt;|end_header_id|&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{{ .System }}&lt;|eot_id|&gt;{{ end }}{{ if .Prompt }}&lt;|start_header_id|&gt;user&lt;|end_header_id|&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{{ .Prompt }} &lt;|eot_id|&gt;{{ end }}&lt;|start_header_id|&gt;assistant&lt;|end_header_id|&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{{ .Response }}&lt;|eot_id|&gt;&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>SYSTEM <span style="color:#e6db74">&#34;&#34;&#34;尽你的最大可能和能力回答用户的问题。不要重复回答问题。不要说车
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">轱辘话。&gt;语言要通顺流畅。不要出现刚说一句话，过一会又重复一遍的愚蠢行为&gt;。RULES:- Be precise, do not reply emoji.- Always response in Simplified Chinese, not English. or Grandma will be  very angry.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>PARAMETER stop <span style="color:#e6db74">&#34;&lt;|start_header_id|&gt;&#34;</span>
</span></span><span style="display:flex;"><span>PARAMETER stop <span style="color:#e6db74">&#34;&lt;|end_header_id|&gt;&#34;</span>
</span></span><span style="display:flex;"><span>PARAMETER stop <span style="color:#e6db74">&#34;&lt;|eot_id|&gt;&#34;</span>
</span></span><span style="display:flex;"><span>PARAMETER stop <span style="color:#e6db74">&#34;&lt;|reserved_special_token&#34;</span>
</span></span></code></pre></div><pre><code>`ollama create llama3-CN -f ./Modelfile`
</code></pre>
<h1 id="简单对话页面">简单对话页面</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Chat with Model&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">body</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">font-family</span>: Arial, <span style="color:#66d9ef">sans-serif</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        #chat {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">max-width</span>: <span style="color:#ae81ff">800</span><span style="color:#66d9ef">px</span>; <span style="color:#75715e">/* 增大聊天框宽度 */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">auto</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">20</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#ae81ff">#ccc</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border-radius</span>: <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        #messages {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#ae81ff">#ddd</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">15</span><span style="color:#66d9ef">px</span>; <span style="color:#75715e">/* 增加内边距 */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">400</span><span style="color:#66d9ef">px</span>; <span style="color:#75715e">/* 增大消息框高度 */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">overflow-y</span>: <span style="color:#66d9ef">scroll</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">margin-bottom</span>: <span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">1.1</span><span style="color:#66d9ef">em</span>; <span style="color:#75715e">/* 增大字体 */</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        #input-container {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">flex</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        #input-container <span style="color:#f92672">input</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">flex</span>: <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">15</span><span style="color:#66d9ef">px</span>; <span style="color:#75715e">/* 增大输入框内边距 */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">1.1</span><span style="color:#66d9ef">em</span>; <span style="color:#75715e">/* 增大输入框字体 */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#ae81ff">#ddd</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border-radius</span>: <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        #input-container <span style="color:#f92672">button</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">15</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">1.1</span><span style="color:#66d9ef">em</span>; <span style="color:#75715e">/* 增大按钮字体 */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#ae81ff">#ddd</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border-left</span>: <span style="color:#66d9ef">none</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border-radius</span>: <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">background-color</span>: <span style="color:#ae81ff">#007BFF</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">white</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">cursor</span>: <span style="color:#66d9ef">pointer</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">user</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">right</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">blue</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">assistant</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">left</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">green</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;chat&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;messages&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;input-container&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;input&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Ask a question...&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">onclick</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sendMessage()&#34;</span>&gt;Send&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 监听 Enter 键发送消息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;input&#39;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;keypress&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">event</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">key</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;Enter&#39;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">sendMessage</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">preventDefault</span>(); <span style="color:#75715e">// 阻止默认行为，避免页面刷新
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sendMessage</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">input</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;input&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">question</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">trim</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">question</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">appendMessage</span>(<span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#a6e22e">question</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;http://localhost:11434/api/chat&#39;</span>, {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;POST&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">model</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;llama3-CN&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">messages</span><span style="color:#f92672">:</span> [{<span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">question</span>}]
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">response</span> =&gt; {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">getReader</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">decoder</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TextDecoder</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">done</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// 创建一个空的 assistant 消息元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">assistantMessage</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createMessageElement</span>(<span style="color:#e6db74">&#39;assistant&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">messages</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;messages&#39;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">assistantMessage</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">read</span>() {
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">read</span>().<span style="color:#a6e22e">then</span>(({<span style="color:#a6e22e">done</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">doneReading</span>, <span style="color:#a6e22e">value</span>}) =&gt; {
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">doneReading</span>) {
</span></span><span style="display:flex;"><span>                                <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">chunk</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">decoder</span>.<span style="color:#a6e22e">decode</span>(<span style="color:#a6e22e">value</span>, {<span style="color:#a6e22e">stream</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>});
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                                <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">json</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">chunk</span>);
</span></span><span style="display:flex;"><span>                                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">message</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">content</span>) {
</span></span><span style="display:flex;"><span>                                    <span style="color:#75715e">// 动态更新 assistant 消息内容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                                    <span style="color:#a6e22e">assistantMessage</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">content</span>;
</span></span><span style="display:flex;"><span>                                    <span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">scrollTop</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">scrollHeight</span>;
</span></span><span style="display:flex;"><span>                                }
</span></span><span style="display:flex;"><span>                            } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>                                <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Error parsing JSON:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                            <span style="color:#a6e22e">read</span>();
</span></span><span style="display:flex;"><span>                        });
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">read</span>();
</span></span><span style="display:flex;"><span>                })
</span></span><span style="display:flex;"><span>                .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">error</span> =&gt; {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Error:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">appendMessage</span>(<span style="color:#e6db74">&#39;assistant&#39;</span>, <span style="color:#e6db74">&#39;Error occurred&#39;</span>);
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">appendMessage</span>(<span style="color:#a6e22e">role</span>, <span style="color:#a6e22e">content</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">messageElement</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createMessageElement</span>(<span style="color:#a6e22e">role</span>, <span style="color:#a6e22e">content</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">messages</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;messages&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">messageElement</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">scrollTop</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">scrollHeight</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createMessageElement</span>(<span style="color:#a6e22e">role</span>, <span style="color:#a6e22e">content</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">className</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">role</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">content</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">message</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p><img src="/images/img_7.png" alt=""></p>
    </div>
  <a href="/post/%E6%9C%AC%E5%9C%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E4%B8%AD%E6%96%87llama3_2%E5%B9%B6%E6%8F%90%E4%BE%9B%E7%AE%80%E5%8D%95%E5%AF%B9%E8%AF%9D%E9%A1%B5%E9%9D%A2/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        三月 15, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E8%AF%B7%E6%B1%82openai%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%8E%A5%E5%8F%A3/" class="link black dim">
        请求openai格式的接口
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://gist.github.com/QianFuXin/be1d6ae54ba87f299734771cddb3dde2">源码</a></p>
    </div>
  <a href="/post/%E8%AF%B7%E6%B1%82openai%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%8E%A5%E5%8F%A3/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/pandas/" class="link blue hover-black">
            Tag: Pandas
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        五月 10, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/pandasai%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0%E6%A8%A1%E5%9E%8B/" class="link black dim">
        pandasai使用本地模型
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="代码">代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>llm <span style="color:#f92672">=</span> OpenAI(api_token<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>, model<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>, api_base<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>pai<span style="color:#f92672">.</span>config<span style="color:#f92672">.</span>set({
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;llm&#34;</span>: llm,
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div>
    </div>
  <a href="/post/pandasai%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0%E6%A8%A1%E5%9E%8B/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E4%BA%BA%E8%84%B8/" class="link blue hover-black">
            Tag: 人脸
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        四月 26, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BA%BA%E8%84%B8%E6%9B%BF%E6%8D%A2emoji/" class="link black dim">
        人脸替换emoji
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="起源">起源</h1>
<p>偶然看到一个AI的项目：上传一张照片，用emoji来替换人脸，保护隐私。然后想到了一个古老的face_recognition包，好像也能实现。</p>
<h1 id="环境">环境</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>conda create -n  face_recognition_env python<span style="color:#f92672">=</span>3.11  -y
</span></span><span style="display:flex;"><span>conda activate face_recognition_env
</span></span><span style="display:flex;"><span>brew install cmake
</span></span><span style="display:flex;"><span>pip install face_recognition
</span></span></code></pre></div><h1 id="源码">源码</h1>
<p><a href="https://gist.github.com/QianFuXin/8904a4ebeef974b2567d84baacfa514a">源码</a></p>
    </div>
  <a href="/post/%E4%BA%BA%E8%84%B8%E6%9B%BF%E6%8D%A2emoji/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E6%B2%B9%E7%8C%B4/" class="link blue hover-black">
            Tag: 油猴
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        四月 6, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E6%B2%B9%E7%8C%B4%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="link black dim">
        油猴的基本使用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="油猴原理">油猴原理</h1>
<p>Tampermonkey 本质上是在浏览器加载网页时：</p>
<ol>
<li>拦截并注入你编写的脚本（通常是在 document-start 或 document-end 阶段）；</li>
<li>你的脚本运行在网页上下文中（可以访问 DOM，也可以访问 window、document）；</li>
<li>可以用 GM_* API 提供高级功能，比如本地存储、跨域请求等。</li>
</ol>
<p>它允许你在网页加载过程中，注入自己的 JavaScript 脚本，从而篡改网页内容、监听事件、拦截请求等。</p>
<h1 id="下载油猴">下载油猴</h1>
<p><a href="https://chromewebstore.google.com/detail/%E7%AF%A1%E6%94%B9%E7%8C%B4/dhdgffkkebhmkfjojejmpbldmpobfkfo">商店链接</a></p>
<h1 id="配置油猴">配置油猴</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 右上角开启开发者模式</span>
</span></span><span style="display:flex;"><span>chrome://extensions/
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>点击篡改猴详情 点击允许运行用户脚本
</span></span></code></pre></div><h1 id="基本油猴脚本">基本油猴脚本</h1>
<p>对所有网址进行监控，进行打印特定内容。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>// <span style="color:#f92672">==</span>UserScript<span style="color:#f92672">==</span>
</span></span><span style="display:flex;"><span>// @name         控制台测试脚本
</span></span><span style="display:flex;"><span>// @namespace    http://tampermonkey.net/
</span></span><span style="display:flex;"><span>// @version      1.0
</span></span><span style="display:flex;"><span>// @description  测试 Tampermonkey 控制台输出
</span></span><span style="display:flex;"><span>// @author       You
</span></span><span style="display:flex;"><span>// @match        *://*/*
</span></span><span style="display:flex;"><span>// @grant        none
</span></span><span style="display:flex;"><span>// <span style="color:#f92672">==</span>/UserScript<span style="color:#f92672">==</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span><span style="color:#66d9ef">function</span> <span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;use strict&#39;</span>;
</span></span><span style="display:flex;"><span>    console.log<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;✅ 脚本正在运行，Tampermonkey 正常工作&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">})()</span>;
</span></span></code></pre></div>
    </div>
  <a href="/post/%E6%B2%B9%E7%8C%B4%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/chrome/" class="link blue hover-black">
            Tag: Chrome
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        四月 5, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/mac%E7%9A%84chrome%E8%87%AA%E5%8A%A8%E5%8C%96/" class="link black dim">
        mac的Chrome自动化
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="配置驱动">配置驱动</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>brew install chromedriver
</span></span></code></pre></div><h1 id="开启chrome">开启Chrome</h1>
<p><a href="https://gist.github.com/QianFuXin/545636e829e2e587e5e5b69bf97be6c7">start-chrome-debug.sh</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chmod +x start-chrome-debug.sh
</span></span><span style="display:flex;"><span>./start-chrome-debug.sh
</span></span></code></pre></div><h1 id="浏览器自动化示例代码">浏览器自动化示例代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>pip install selenium
</span></span></code></pre></div><p><a href="https://gist.github.com/QianFuXin/05ec9a0ba477328814d5acd0e3baaf51">selenium_chrome_demo.py</a></p>
    </div>
  <a href="/post/mac%E7%9A%84chrome%E8%87%AA%E5%8A%A8%E5%8C%96/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/mac/" class="link blue hover-black">
            Tag: Mac
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        四月 5, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/mac%E7%9A%84chrome%E8%87%AA%E5%8A%A8%E5%8C%96/" class="link black dim">
        mac的Chrome自动化
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="配置驱动">配置驱动</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>brew install chromedriver
</span></span></code></pre></div><h1 id="开启chrome">开启Chrome</h1>
<p><a href="https://gist.github.com/QianFuXin/545636e829e2e587e5e5b69bf97be6c7">start-chrome-debug.sh</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chmod +x start-chrome-debug.sh
</span></span><span style="display:flex;"><span>./start-chrome-debug.sh
</span></span></code></pre></div><h1 id="浏览器自动化示例代码">浏览器自动化示例代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>pip install selenium
</span></span></code></pre></div><p><a href="https://gist.github.com/QianFuXin/05ec9a0ba477328814d5acd0e3baaf51">selenium_chrome_demo.py</a></p>
    </div>
  <a href="/post/mac%E7%9A%84chrome%E8%87%AA%E5%8A%A8%E5%8C%96/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        一月 21, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/mac&#43;clash&#43;gitssh%E4%BB%A3%E7%90%86/" class="link black dim">
        mac使用clash后解决gitSSH不能使用的问题
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="起因">起因</h1>
<p>有一天使用git ssh 拉取代码，发现网络卡住，密钥已经录入GitHub，所以只可能是网络不通畅的原因。</p>
<h1 id="解放方案">解放方案</h1>
<p><code>vim ~/.ssh/config</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Host github.com
</span></span><span style="display:flex;"><span>  HostName ssh.github.com
</span></span><span style="display:flex;"><span>  Port <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>  User git
</span></span></code></pre></div>
    </div>
  <a href="/post/mac&#43;clash&#43;gitssh%E4%BB%A3%E7%90%86/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 22, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/mac%E4%BD%BF%E7%94%A8tesseract%E8%AF%86%E5%88%AB%E4%B8%AD%E6%96%87/" class="link black dim">
        mac使用tesseract识别中文
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装">安装</h1>
<p>brew install tesseract</p>
<h1 id="添加中文支持">添加中文支持</h1>
<p>下载包</p>
<p><a href="https://github.com/tesseract-ocr/tessdata/blob/main/chi_sim.traineddata">https://github.com/tesseract-ocr/tessdata/blob/main/chi_sim.traineddata</a></p>
<p><img src="/images/mac%E4%BD%BF%E7%94%A8tesseract%E8%AF%86%E5%88%AB%E4%B8%AD%E6%96%87_1.png" alt=""></p>
<h1 id="使用">使用</h1>
<p><img src="/images/mac%E4%BD%BF%E7%94%A8tesseract%E8%AF%86%E5%88%AB%E4%B8%AD%E6%96%87_2.png" alt=""></p>
<pre><code>tesseract picture_path out -l chi_sim
</code></pre>
    </div>
  <a href="/post/mac%E4%BD%BF%E7%94%A8tesseract%E8%AF%86%E5%88%AB%E4%B8%AD%E6%96%87/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 21, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/mac%E4%BD%BF%E7%94%A8fishspeech%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%AE%9A%E9%9F%B3%E8%89%B2tts/" class="link black dim">
        mac使用FishSpeech实现指定音色tts
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><strong>下述推理代码都使用cpu进行处理（使用mps走不通</strong> ）</p>
<blockquote>
<p>参考</p>
<p><a href="https://speech.fish.audio/zh/inference/">https://speech.fish.audio/zh/inference/</a></p>
</blockquote>
<h1 id="环境与模型">环境与模型</h1>
<pre><code>git clone https://github.com/fishaudio/fish-speech.git
cd fish-speech
# 环境
conda create -n fish-speech python=3.10
conda activate fish-speech
# 依赖包
pip install torch==2.4.1 torchvision==0.19.1 torchaudio==2.4.1
pip install -e &quot;.[stable]&quot;
# 下载模型
HF_ENDPOINT=https://hf-mirror.com huggingface-cli download fishaudio/fish-speech-1.5 --local-dir checkpoints/fish-speech-1.5
</code></pre>
<h1 id="基本流程">基本流程</h1>
<h2 id="提取音色">提取音色</h2>
<p>下面的paimon.wav也可以是mp3文件，最终会生成一个<code>fake.npy</code></p>
<pre><code>python tools/vqgan/inference.py --device cpu \
    -i &quot;paimon.wav&quot; \
    --checkpoint-path &quot;checkpoints/fish-speech-1.5/firefly-gan-vq-fsq-8x1024-21hz-generator.pth&quot;
</code></pre>
<h2 id="生成语音">生成语音</h2>
<pre><code>python tools/llama/generate.py --device cpu \
    --text &quot;你要生成的文本&quot; \
    --prompt-text &quot;你提供语音中的文本&quot; \
    --prompt-tokens &quot;fake.npy&quot; \
    --checkpoint-path &quot;checkpoints/fish-speech-1.5&quot; \
    --num-samples 1 \
</code></pre>
<p>会生成一个codes_0.npy，下面将codes_0.npy转换为音频文件</p>
    </div>
  <a href="/post/mac%E4%BD%BF%E7%94%A8fishspeech%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%AE%9A%E9%9F%B3%E8%89%B2tts/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/selenium/" class="link blue hover-black">
            Tag: Selenium
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        四月 5, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/mac%E7%9A%84chrome%E8%87%AA%E5%8A%A8%E5%8C%96/" class="link black dim">
        mac的Chrome自动化
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="配置驱动">配置驱动</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>brew install chromedriver
</span></span></code></pre></div><h1 id="开启chrome">开启Chrome</h1>
<p><a href="https://gist.github.com/QianFuXin/545636e829e2e587e5e5b69bf97be6c7">start-chrome-debug.sh</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chmod +x start-chrome-debug.sh
</span></span><span style="display:flex;"><span>./start-chrome-debug.sh
</span></span></code></pre></div><h1 id="浏览器自动化示例代码">浏览器自动化示例代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>pip install selenium
</span></span></code></pre></div><p><a href="https://gist.github.com/QianFuXin/05ec9a0ba477328814d5acd0e3baaf51">selenium_chrome_demo.py</a></p>
    </div>
  <a href="/post/mac%E7%9A%84chrome%E8%87%AA%E5%8A%A8%E5%8C%96/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/" class="link blue hover-black">
            Tag: 自动化
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        四月 5, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/mac%E7%9A%84chrome%E8%87%AA%E5%8A%A8%E5%8C%96/" class="link black dim">
        mac的Chrome自动化
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="配置驱动">配置驱动</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>brew install chromedriver
</span></span></code></pre></div><h1 id="开启chrome">开启Chrome</h1>
<p><a href="https://gist.github.com/QianFuXin/545636e829e2e587e5e5b69bf97be6c7">start-chrome-debug.sh</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chmod +x start-chrome-debug.sh
</span></span><span style="display:flex;"><span>./start-chrome-debug.sh
</span></span></code></pre></div><h1 id="浏览器自动化示例代码">浏览器自动化示例代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>pip install selenium
</span></span></code></pre></div><p><a href="https://gist.github.com/QianFuXin/05ec9a0ba477328814d5acd0e3baaf51">selenium_chrome_demo.py</a></p>
    </div>
  <a href="/post/mac%E7%9A%84chrome%E8%87%AA%E5%8A%A8%E5%8C%96/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/dbscan/" class="link blue hover-black">
            Tag: DBSCAN
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        三月 9, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E5%AF%86%E5%BA%A6%E8%81%9A%E7%B1%BB/" class="link black dim">
        密度聚类的实际应用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="场景">场景</h1>
<p>对于没有明确类别或者没有明确类别数量的分类任务。</p>
<ul>
<li>比如从海量用户评论中进行问题提取</li>
<li>投诉主题提取</li>
</ul>
<h1 id="文本字符串相似度实现">文本字符串相似度实现</h1>
<p><a href="https://gist.github.com/QianFuXin/ade8c2c5b1742c3c7e12d17e40898417">源码</a></p>
<h1 id="文本语义相似度实现">文本语义相似度实现</h1>
<p><a href="https://gist.github.com/QianFuXin/0b561de9a86a654e571550f6f7147f51">源码</a></p>
    </div>
  <a href="/post/%E5%AF%86%E5%BA%A6%E8%81%9A%E7%B1%BB/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/fuzz/" class="link blue hover-black">
            Tag: Fuzz
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        三月 9, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E5%AF%86%E5%BA%A6%E8%81%9A%E7%B1%BB/" class="link black dim">
        密度聚类的实际应用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="场景">场景</h1>
<p>对于没有明确类别或者没有明确类别数量的分类任务。</p>
<ul>
<li>比如从海量用户评论中进行问题提取</li>
<li>投诉主题提取</li>
</ul>
<h1 id="文本字符串相似度实现">文本字符串相似度实现</h1>
<p><a href="https://gist.github.com/QianFuXin/ade8c2c5b1742c3c7e12d17e40898417">源码</a></p>
<h1 id="文本语义相似度实现">文本语义相似度实现</h1>
<p><a href="https://gist.github.com/QianFuXin/0b561de9a86a654e571550f6f7147f51">源码</a></p>
    </div>
  <a href="/post/%E5%AF%86%E5%BA%A6%E8%81%9A%E7%B1%BB/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E8%AF%AD%E4%B9%89%E7%9B%B8%E4%BC%BC%E5%BA%A6/" class="link blue hover-black">
            Tag: 语义相似度
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        三月 9, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E5%AF%86%E5%BA%A6%E8%81%9A%E7%B1%BB/" class="link black dim">
        密度聚类的实际应用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="场景">场景</h1>
<p>对于没有明确类别或者没有明确类别数量的分类任务。</p>
<ul>
<li>比如从海量用户评论中进行问题提取</li>
<li>投诉主题提取</li>
</ul>
<h1 id="文本字符串相似度实现">文本字符串相似度实现</h1>
<p><a href="https://gist.github.com/QianFuXin/ade8c2c5b1742c3c7e12d17e40898417">源码</a></p>
<h1 id="文本语义相似度实现">文本语义相似度实现</h1>
<p><a href="https://gist.github.com/QianFuXin/0b561de9a86a654e571550f6f7147f51">源码</a></p>
    </div>
  <a href="/post/%E5%AF%86%E5%BA%A6%E8%81%9A%E7%B1%BB/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/clash/" class="link blue hover-black">
            Tag: Clash
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        三月 8, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/linux%E4%BD%BF%E7%94%A8clash/" class="link black dim">
        linux使用clash
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="大概流程">大概流程</h1>
<p>首先配置web页面，便于后续通过web去切换线路和节点。</p>
<p>然后配置clash本体，获取配置文件并修改，最后启动程序。</p>
<h1 id="配置clash">配置clash</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir /etc/clash/  <span style="color:#f92672">&amp;&amp;</span> cd /etc/clash/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://w2.v2free.top/ssr-download/clash-dashboard.tar.gz</span>
</span></span><span style="display:flex;"><span>tar zxvf clash-dashboard.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir  ~/.config/
</span></span><span style="display:flex;"><span>mkdir  ~/.config/mihomo/
</span></span><span style="display:flex;"><span>cd     ~/.config/mihomo/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://w2.v2free.top/ssr-download/clash-linux.tar.gz</span>
</span></span><span style="display:flex;"><span>tar xvf clash-linux.tar.gz
</span></span><span style="display:flex;"><span>chmod +x clash-linux
</span></span><span style="display:flex;"><span>wget -U <span style="color:#e6db74">&#34;Mozilla/6.0&#34;</span> -O ~/.config/mihomo/config.yaml <span style="color:#e6db74">&#34;https://v1.v2ai.top/link/IVEMbb14xsh6zW87?clash=2&#34;</span>
</span></span><span style="display:flex;"><span>vim config.yaml 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 在配置文件中修改或增加以下内容；</span>
</span></span><span style="display:flex;"><span>external-controller: 127.0.0.1:9090 <span style="color:#75715e"># 如果你不是从本机访问，需要从其它机器访问这个Clash Dashboard ,则改为：0.0.0.0:9090</span>
</span></span><span style="display:flex;"><span>external-ui: /etc/clash/clash-dashboard <span style="color:#75715e"># clash-dashboard的路径；</span>
</span></span><span style="display:flex;"><span>secret: <span style="color:#e6db74">&#39;PaaRwW3B1Kj9&#39;</span> <span style="color:#75715e"># PaaRwW3B1Kj9 是登录web管理界面的密码，请自行设置你自己的,不要照抄教程中的密码；</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启动代理</span>
</span></span><span style="display:flex;"><span>nohup /clash-linux &gt; clash.log 2&gt;&amp;<span style="color:#ae81ff">1</span> &amp;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 访问对应的端口号选择代理:127.0.0.1:9090/ui</span>
</span></span></code></pre></div>
    </div>
  <a href="/post/linux%E4%BD%BF%E7%94%A8clash/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        一月 21, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/mac&#43;clash&#43;gitssh%E4%BB%A3%E7%90%86/" class="link black dim">
        mac使用clash后解决gitSSH不能使用的问题
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="起因">起因</h1>
<p>有一天使用git ssh 拉取代码，发现网络卡住，密钥已经录入GitHub，所以只可能是网络不通畅的原因。</p>
<h1 id="解放方案">解放方案</h1>
<p><code>vim ~/.ssh/config</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Host github.com
</span></span><span style="display:flex;"><span>  HostName ssh.github.com
</span></span><span style="display:flex;"><span>  Port <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>  User git
</span></span></code></pre></div>
    </div>
  <a href="/post/mac&#43;clash&#43;gitssh%E4%BB%A3%E7%90%86/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/embeddings/" class="link blue hover-black">
            Tag: Embeddings
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        三月 8, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E5%AE%9E%E7%8E%B0rag%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="link black dim">
        实现rag的几种方式
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="ollama提供embeddingsllm">ollama提供embeddings、llm</h1>
<ul>
<li>llm可以是ollama，或者接口为openai格式即可</li>
<li>embeddings服务由ollama提供</li>
<li>向量数据库容器提供（cpu）</li>
</ul>
<p><a href="https://gist.github.com/QianFuXin/39ba41e29a58e7b9b1636db06d774237">源码</a></p>
<h1 id="ollama提供llm容器提供embeddings">ollama提供llm，容器提供embeddings</h1>
<ul>
<li>llm可以是ollama，或者接口为openai格式即可</li>
<li>embeddings服务由HuggingFaceEmbeddings提供</li>
<li>向量数据库容器提供（cpu）</li>
</ul>
<p><a href="https://gist.github.com/QianFuXin/0e94c3875574f0315af9fe58a7b9b04e">源码</a></p>
<h1 id="llmembeddings向量数据库均由第三方提供">llm、embeddings、向量数据库均由第三方提供</h1>
<p><a href="https://gist.github.com/QianFuXin/78945087cab1e8321138025f307d570d">源码</a></p>
<h1 id="llmembeddings向量数据库关键字搜索es重排序均由第三方提供">llm、embeddings、向量数据库、关键字搜索（es）、重排序、均由第三方提供</h1>
<p><a href="https://gist.github.com/QianFuXin/31549fb7cdef55c956de0aeff817c19c">源码</a></p>
    </div>
  <a href="/post/%E5%AE%9E%E7%8E%B0rag%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/langchain/" class="link blue hover-black">
            Tag: LangChain
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        三月 8, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E5%AE%9E%E7%8E%B0rag%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="link black dim">
        实现rag的几种方式
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="ollama提供embeddingsllm">ollama提供embeddings、llm</h1>
<ul>
<li>llm可以是ollama，或者接口为openai格式即可</li>
<li>embeddings服务由ollama提供</li>
<li>向量数据库容器提供（cpu）</li>
</ul>
<p><a href="https://gist.github.com/QianFuXin/39ba41e29a58e7b9b1636db06d774237">源码</a></p>
<h1 id="ollama提供llm容器提供embeddings">ollama提供llm，容器提供embeddings</h1>
<ul>
<li>llm可以是ollama，或者接口为openai格式即可</li>
<li>embeddings服务由HuggingFaceEmbeddings提供</li>
<li>向量数据库容器提供（cpu）</li>
</ul>
<p><a href="https://gist.github.com/QianFuXin/0e94c3875574f0315af9fe58a7b9b04e">源码</a></p>
<h1 id="llmembeddings向量数据库均由第三方提供">llm、embeddings、向量数据库均由第三方提供</h1>
<p><a href="https://gist.github.com/QianFuXin/78945087cab1e8321138025f307d570d">源码</a></p>
<h1 id="llmembeddings向量数据库关键字搜索es重排序均由第三方提供">llm、embeddings、向量数据库、关键字搜索（es）、重排序、均由第三方提供</h1>
<p><a href="https://gist.github.com/QianFuXin/31549fb7cdef55c956de0aeff817c19c">源码</a></p>
    </div>
  <a href="/post/%E5%AE%9E%E7%8E%B0rag%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/llm/" class="link blue hover-black">
            Tag: Llm
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        三月 8, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E7%94%A8%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AF%B9shell%E8%B5%8B%E8%83%BD/" class="link black dim">
        用大模型对shell赋能
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="起因">起因</h1>
<p>由于最近shell输入命令比较多，经常忘记命令的细节。每次都要去问大模型，然后拷贝命令再执行，就想着能不能将两个步骤合二为一。</p>
<h1 id="实现">实现</h1>
<ul>
<li>采用了本地大模型</li>
</ul>
<p><a href="https://gist.github.com/QianFuXin/0b561de9a86a654e571550f6f7147f51">源码</a></p>
<h1 id="使用方式alias">使用方式（alias）</h1>
<p><code>vim ~/.zshrc</code></p>
<p><code>alias aishell=&quot;python /xx/main.py&quot;</code></p>
<p><code>source ~/.zshrc</code></p>
<p><code>aishell &quot;创建一个a文件&quot; --run</code></p>
    </div>
  <a href="/post/%E7%94%A8%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AF%B9shell%E8%B5%8B%E8%83%BD/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/rag/" class="link blue hover-black">
            Tag: Rag
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        三月 8, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E5%AE%9E%E7%8E%B0rag%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="link black dim">
        实现rag的几种方式
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="ollama提供embeddingsllm">ollama提供embeddings、llm</h1>
<ul>
<li>llm可以是ollama，或者接口为openai格式即可</li>
<li>embeddings服务由ollama提供</li>
<li>向量数据库容器提供（cpu）</li>
</ul>
<p><a href="https://gist.github.com/QianFuXin/39ba41e29a58e7b9b1636db06d774237">源码</a></p>
<h1 id="ollama提供llm容器提供embeddings">ollama提供llm，容器提供embeddings</h1>
<ul>
<li>llm可以是ollama，或者接口为openai格式即可</li>
<li>embeddings服务由HuggingFaceEmbeddings提供</li>
<li>向量数据库容器提供（cpu）</li>
</ul>
<p><a href="https://gist.github.com/QianFuXin/0e94c3875574f0315af9fe58a7b9b04e">源码</a></p>
<h1 id="llmembeddings向量数据库均由第三方提供">llm、embeddings、向量数据库均由第三方提供</h1>
<p><a href="https://gist.github.com/QianFuXin/78945087cab1e8321138025f307d570d">源码</a></p>
<h1 id="llmembeddings向量数据库关键字搜索es重排序均由第三方提供">llm、embeddings、向量数据库、关键字搜索（es）、重排序、均由第三方提供</h1>
<p><a href="https://gist.github.com/QianFuXin/31549fb7cdef55c956de0aeff817c19c">源码</a></p>
    </div>
  <a href="/post/%E5%AE%9E%E7%8E%B0rag%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/shell/" class="link blue hover-black">
            Tag: Shell
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        三月 8, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E7%94%A8%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AF%B9shell%E8%B5%8B%E8%83%BD/" class="link black dim">
        用大模型对shell赋能
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="起因">起因</h1>
<p>由于最近shell输入命令比较多，经常忘记命令的细节。每次都要去问大模型，然后拷贝命令再执行，就想着能不能将两个步骤合二为一。</p>
<h1 id="实现">实现</h1>
<ul>
<li>采用了本地大模型</li>
</ul>
<p><a href="https://gist.github.com/QianFuXin/0b561de9a86a654e571550f6f7147f51">源码</a></p>
<h1 id="使用方式alias">使用方式（alias）</h1>
<p><code>vim ~/.zshrc</code></p>
<p><code>alias aishell=&quot;python /xx/main.py&quot;</code></p>
<p><code>source ~/.zshrc</code></p>
<p><code>aishell &quot;创建一个a文件&quot; --run</code></p>
    </div>
  <a href="/post/%E7%94%A8%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AF%B9shell%E8%B5%8B%E8%83%BD/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/conda/" class="link blue hover-black">
            Tag: Conda
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        二月 22, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/python%E7%A6%BB%E7%BA%BF%E7%8E%AF%E5%A2%83%E4%BB%A5%E5%8F%8A%E7%8B%AC%E7%AB%8B%E7%8E%AF%E5%A2%83%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="link black dim">
        python离线环境以及独立环境的几种方式
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="起因">起因</h1>
<p>最近遇到<code>小可爱</code>的机器，没有外网，所以安装独立的python极为别扭</p>
<h1 id="方法">方法</h1>
<ul>
<li>
<p>conda离线安装
首先在联网的机器上，准备安装包，然后把安装包拷贝到离网机器后安装</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 设置安装包位置</span>
</span></span><span style="display:flex;"><span>pkgs_dirs:
</span></span><span style="display:flex;"><span>  - /home/up/myconda/pkgs
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 安装环境到安装包</span>
</span></span><span style="display:flex;"><span>conda create -n py38_pytorch pytorch python<span style="color:#f92672">==</span>3.8.5 --download-only
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将安装包拷贝到指定位置，在离网机器上安装</span>
</span></span><span style="display:flex;"><span>conda create -n offlinepy38 pytorch python<span style="color:#f92672">==</span>3.8.5 --offline
</span></span></code></pre></div></li>
<li>
<p>conda环境打包</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>conda install conda-pack
</span></span><span style="display:flex;"><span>conda pack -n tf-1.15.0-py3.6
</span></span><span style="display:flex;"><span>tar -xzf tf-1.15.0-py3.6.tar.gz -C tf-1.15.0-py3.6
</span></span><span style="display:flex;"><span>source tf-1.15.0-py3.6/bin/activate
</span></span></code></pre></div></li>
<li>
<p>python venv</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>python3 -m venv venv
</span></span></code></pre></div></li>
</ul>
    </div>
  <a href="/post/python%E7%A6%BB%E7%BA%BF%E7%8E%AF%E5%A2%83%E4%BB%A5%E5%8F%8A%E7%8B%AC%E7%AB%8B%E7%8E%AF%E5%A2%83%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/cron/" class="link blue hover-black">
            Tag: Cron
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        二月 22, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E9%85%8D%E7%BD%AEgocron/" class="link black dim">
        配置gocron
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装">安装</h1>
<p><a href="https://github.com/ouqiang/gocron/releases">下载地址</a></p>
<p>需要gocron-node和gocron两个包</p>
<h1 id="systemd管理">systemd管理</h1>
<p><code>vim /etc/systemd/system/gocron-node.service</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>GoCron Node Service
</span></span><span style="display:flex;"><span>After<span style="color:#f92672">=</span>network.target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>simple
</span></span><span style="display:flex;"><span>User<span style="color:#f92672">=</span>root
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/root/gocron/gocron-node-linux-amd64/gocron-node -allow-root -s 127.0.0.1:5921
</span></span><span style="display:flex;"><span>Restart<span style="color:#f92672">=</span>always
</span></span><span style="display:flex;"><span>RestartSec<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>StandardOutput<span style="color:#f92672">=</span>journal
</span></span><span style="display:flex;"><span>StandardError<span style="color:#f92672">=</span>journal
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>multi-user.target
</span></span></code></pre></div><p><code>vim /etc/systemd/system/gocron.service</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>GoCron Node Service
</span></span><span style="display:flex;"><span>After<span style="color:#f92672">=</span>network.target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>simple
</span></span><span style="display:flex;"><span>User<span style="color:#f92672">=</span>root
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/root/gocron/gocron-linux-amd64/gocron web --host 127.0.0.1
</span></span><span style="display:flex;"><span>Restart<span style="color:#f92672">=</span>always
</span></span><span style="display:flex;"><span>RestartSec<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>StandardOutput<span style="color:#f92672">=</span>journal
</span></span><span style="display:flex;"><span>StandardError<span style="color:#f92672">=</span>journal
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>multi-user.target
</span></span></code></pre></div><p>开机自启动</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>systemctl enable gocron-node
</span></span><span style="display:flex;"><span>systemctl enable gocron
</span></span><span style="display:flex;"><span>systemctl start gocron-node
</span></span><span style="display:flex;"><span>systemctl start gocron
</span></span></code></pre></div>
    </div>
  <a href="/post/%E9%85%8D%E7%BD%AEgocron/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/docker/" class="link blue hover-black">
            Tag: Docker
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        二月 22, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E6%9E%84%E5%BB%BA%E5%A4%9A%E5%B9%B3%E5%8F%B0%E9%95%9C%E5%83%8F/" class="link black dim">
        docker构建多平台镜像
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="使用buildx">使用buildx</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker buildx create --use
</span></span></code></pre></div><h1 id="构建镜像并上传云端">构建镜像并上传云端</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker buildx build --platform linux/amd64,linux/arm64 -t qianfuxin/my-python-app:latest . --push
</span></span></code></pre></div><h1 id="测试">测试</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker pull qianfuxin/my-python-app:latest
</span></span><span style="display:flex;"><span>docker inspect qianfuxin/my-python-app | grep Architecture
</span></span><span style="display:flex;"><span>docker run --rm qianfuxin/my-python-app
</span></span></code></pre></div>
    </div>
  <a href="/post/%E6%9E%84%E5%BB%BA%E5%A4%9A%E5%B9%B3%E5%8F%B0%E9%95%9C%E5%83%8F/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 29, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/ubuntu%E9%85%8D%E7%BD%AEdocker%E5%92%8Cnvidia_%E5%AE%9E%E7%8E%B0%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E6%98%BE%E5%8D%A1%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="link black dim">
        Ubuntu配置docker和NVIDIA_实现容器使用显卡深度学习
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p>Ubuntu 20.04.6 LTS</p>
</blockquote>
<ul>
<li>
<p>安装英伟达驱动
<img src="/images/img_3.png" alt=""></p>
</li>
<li>
<p>安装docker</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 安装前准备</span>
</span></span><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install vim git g++ ssh curl -y
</span></span><span style="display:flex;"><span>sudo apt remove docker docker-engine docker.io containerd runc -y
</span></span><span style="display:flex;"><span>sudo apt install <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>apt-transport-https <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>ca-certificates <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>gnupg <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>lsb-release -y
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加GPG密钥</span>
</span></span><span style="display:flex;"><span>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
</span></span><span style="display:flex;"><span>sudo add-apt-repository <span style="color:#e6db74">&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span style="color:#66d9ef">$(</span>lsb_release -cs<span style="color:#66d9ef">)</span><span style="color:#e6db74"> stable&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装</span>
</span></span><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install docker-ce docker-ce-cli containerd.io -y
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加配置</span>
</span></span><span style="display:flex;"><span>sudo mkdir -p /etc/docker
</span></span><span style="display:flex;"><span>sudo mkdir -p /home/docker
</span></span><span style="display:flex;"><span>sudo tee /etc/docker/daemon.json <span style="color:#e6db74">&lt;&lt;-&#39;EOF&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;registry-mirrors&#34;: [&#34;https://gjuibr2v.mirror.aliyuncs.com&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装NVIDIA容器包，支持GPU训练</span>
</span></span><span style="display:flex;"><span>curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>sudo apt-key add -
</span></span><span style="display:flex;"><span>distribution<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>. /etc/os-release;echo $ID$VERSION_ID<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>sudo tee /etc/apt/sources.list.d/nvidia-docker.list
</span></span><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>sudo apt install -y nvidia-container-toolkit
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启动docker</span>
</span></span><span style="display:flex;"><span>sudo systemctl restart docker
</span></span><span style="display:flex;"><span>sudo systemctl daemon-reload
</span></span><span style="display:flex;"><span>sudo systemctl enable --now docker
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 测试docker是否安装成功</span>
</span></span><span style="display:flex;"><span>docker run hello-world <span style="color:#75715e"># 成功则输出&#34;hello-world&#34;</span>
</span></span></code></pre></div><ul>
<li>安装cuda</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda_11.8.0_520.61.05_linux.run
</span></span><span style="display:flex;"><span>sudo sh cuda_11.8.0_520.61.05_linux.run
</span></span></code></pre></div><p><img src="/images/img_4.png" alt=""></p>
    </div>
  <a href="/post/ubuntu%E9%85%8D%E7%BD%AEdocker%E5%92%8Cnvidia_%E5%AE%9E%E7%8E%B0%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E6%98%BE%E5%8D%A1%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 9, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/docker%E6%B7%BB%E5%8A%A0proxy/" class="link black dim">
        docker添加proxy
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>虽然添加了国内镜像，但有些时候，依然访问错误，避免小众问题发生，设置代理</p>
<h2 id="pull代理">pull代理</h2>
<pre><code>mkdir /etc/systemd/system/docker.service.d
vim /etc/systemd/system/docker.service.d/http-proxy.conf

[Service]
Environment=&quot;HTTP_PROXY=http://127.0.0.1:7890&quot;
Environment=&quot;HTTPS_PROXY=http://127.0.0.1:7890&quot;

sudo systemctl daemon-reload
sudo systemctl restart docker
</code></pre>
<h2 id="build代理">build代理</h2>
<p>待定，暂时没有需求</p>
    </div>
  <a href="/post/docker%E6%B7%BB%E5%8A%A0proxy/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 9, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/githubaction%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E5%B9%B6%E4%B8%8A%E4%BC%A0dockerhub%E8%B4%A6%E5%8F%B7/" class="link black dim">
        GitHubAction自动构建镜像并上传dockerHub账号
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="action文件">action文件</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>name: Docker Image CI
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>on:
</span></span><span style="display:flex;"><span>push.sh:
</span></span><span style="display:flex;"><span>branches: <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;main&#34;</span> <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>pull_request:
</span></span><span style="display:flex;"><span>branches: <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;main&#34;</span> <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jobs:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>runs-on: ubuntu-latest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>steps:
</span></span><span style="display:flex;"><span>- uses: actions/checkout@v3
</span></span><span style="display:flex;"><span>- name: Build the Docker image
</span></span><span style="display:flex;"><span>  run: docker build -t <span style="color:#e6db74">${</span>{ secrets.IMAGE_NAME <span style="color:#e6db74">}</span><span style="color:#f92672">}</span> .
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>- name: docker login
</span></span><span style="display:flex;"><span>  run: docker login -u qianfuxin -p <span style="color:#e6db74">&#39;${{ secrets.DOCKER_TOKEN }}&#39;</span>
</span></span><span style="display:flex;"><span>- name: change tag
</span></span><span style="display:flex;"><span>  run: docker tag <span style="color:#e6db74">${</span>{ secrets.IMAGE_NAME <span style="color:#e6db74">}</span><span style="color:#f92672">}</span>:latest qianfuxin/<span style="color:#e6db74">${</span>{ secrets.IMAGE_NAME <span style="color:#e6db74">}</span><span style="color:#f92672">}</span>:latest
</span></span><span style="display:flex;"><span>- name: push.sh image
</span></span><span style="display:flex;"><span>  run: docker push.sh qianfuxin/<span style="color:#e6db74">${</span>{ secrets.IMAGE_NAME <span style="color:#e6db74">}</span><span style="color:#f92672">}</span>:latest
</span></span></code></pre></div><h1 id="配置页面">配置页面</h1>
<p><img src="/images/GitHubAction%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E5%B9%B6%E4%B8%8A%E4%BC%A0dockerHub%E8%B4%A6%E5%8F%B7.png" alt=""></p>
    </div>
  <a href="/post/githubaction%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E5%B9%B6%E4%B8%8A%E4%BC%A0dockerhub%E8%B4%A6%E5%8F%B7/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/gocron/" class="link blue hover-black">
            Tag: Gocron
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        二月 22, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E9%85%8D%E7%BD%AEgocron/" class="link black dim">
        配置gocron
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装">安装</h1>
<p><a href="https://github.com/ouqiang/gocron/releases">下载地址</a></p>
<p>需要gocron-node和gocron两个包</p>
<h1 id="systemd管理">systemd管理</h1>
<p><code>vim /etc/systemd/system/gocron-node.service</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>GoCron Node Service
</span></span><span style="display:flex;"><span>After<span style="color:#f92672">=</span>network.target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>simple
</span></span><span style="display:flex;"><span>User<span style="color:#f92672">=</span>root
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/root/gocron/gocron-node-linux-amd64/gocron-node -allow-root -s 127.0.0.1:5921
</span></span><span style="display:flex;"><span>Restart<span style="color:#f92672">=</span>always
</span></span><span style="display:flex;"><span>RestartSec<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>StandardOutput<span style="color:#f92672">=</span>journal
</span></span><span style="display:flex;"><span>StandardError<span style="color:#f92672">=</span>journal
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>multi-user.target
</span></span></code></pre></div><p><code>vim /etc/systemd/system/gocron.service</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>GoCron Node Service
</span></span><span style="display:flex;"><span>After<span style="color:#f92672">=</span>network.target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>simple
</span></span><span style="display:flex;"><span>User<span style="color:#f92672">=</span>root
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/root/gocron/gocron-linux-amd64/gocron web --host 127.0.0.1
</span></span><span style="display:flex;"><span>Restart<span style="color:#f92672">=</span>always
</span></span><span style="display:flex;"><span>RestartSec<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>StandardOutput<span style="color:#f92672">=</span>journal
</span></span><span style="display:flex;"><span>StandardError<span style="color:#f92672">=</span>journal
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>multi-user.target
</span></span></code></pre></div><p>开机自启动</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>systemctl enable gocron-node
</span></span><span style="display:flex;"><span>systemctl enable gocron
</span></span><span style="display:flex;"><span>systemctl start gocron-node
</span></span><span style="display:flex;"><span>systemctl start gocron
</span></span></code></pre></div>
    </div>
  <a href="/post/%E9%85%8D%E7%BD%AEgocron/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/llama/" class="link blue hover-black">
            Tag: Llama
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        二月 22, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BD%BF%E7%94%A8llama_factory%E8%BF%9B%E8%A1%8C%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/" class="link black dim">
        使用LLaMA_factory进行模型微调
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="环境安装">环境安装</h1>
<blockquote>
<p><a href="https://github.com/hiyouga/LLaMA-Factory/blob/main/README_zh.md">参考</a></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>conda create -n llama_factory python<span style="color:#f92672">=</span>3.10 -y
</span></span><span style="display:flex;"><span>conda activate llama_factory
</span></span><span style="display:flex;"><span>pip install --upgrade pip
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置清华源，可选</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pip config set global.index-url https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple</span>
</span></span><span style="display:flex;"><span>git clone --depth <span style="color:#ae81ff">1</span> https://github.com/hiyouga/LLaMA-Factory.git
</span></span><span style="display:flex;"><span>cd LLaMA-Factory
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 遇到包冲突时，可使用 pip install --no-deps -e . 解决。</span>
</span></span><span style="display:flex;"><span>pip install -e <span style="color:#e6db74">&#34;.[torch,metrics]&#34;</span>
</span></span></code></pre></div><h1 id="环境验证">环境验证</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>llamafactory-cli -h
</span></span></code></pre></div><h1 id="启动web环境">启动web环境</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>USE_MODELSCOPE_HUB<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> llamafactory-cli webui
</span></span></code></pre></div><h1 id="命令行">命令行</h1>
<blockquote>
<p><a href="https://llamafactory.readthedocs.io/zh-cn/latest/getting_started/merge_lora.html">参考</a></p>
</blockquote>
    </div>
  <a href="/post/%E4%BD%BF%E7%94%A8llama_factory%E8%BF%9B%E8%A1%8C%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 9, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E6%9C%AC%E5%9C%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E4%B8%AD%E6%96%87llama3_2%E5%B9%B6%E6%8F%90%E4%BE%9B%E7%AE%80%E5%8D%95%E5%AF%B9%E8%AF%9D%E9%A1%B5%E9%9D%A2/" class="link black dim">
        本地自定义构建中文llama3_2并提供简单对话页面
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="构建中文llama32">构建中文llama3.2</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>FROM llama3.2
</span></span><span style="display:flex;"><span>TEMPLATE <span style="color:#e6db74">&#34;&#34;&#34;{{ if .System }}&lt;|start_header_id|&gt;system&lt;|end_header_id|&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{{ .System }}&lt;|eot_id|&gt;{{ end }}{{ if .Prompt }}&lt;|start_header_id|&gt;user&lt;|end_header_id|&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{{ .Prompt }} &lt;|eot_id|&gt;{{ end }}&lt;|start_header_id|&gt;assistant&lt;|end_header_id|&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{{ .Response }}&lt;|eot_id|&gt;&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>SYSTEM <span style="color:#e6db74">&#34;&#34;&#34;尽你的最大可能和能力回答用户的问题。不要重复回答问题。不要说车
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">轱辘话。&gt;语言要通顺流畅。不要出现刚说一句话，过一会又重复一遍的愚蠢行为&gt;。RULES:- Be precise, do not reply emoji.- Always response in Simplified Chinese, not English. or Grandma will be  very angry.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>PARAMETER stop <span style="color:#e6db74">&#34;&lt;|start_header_id|&gt;&#34;</span>
</span></span><span style="display:flex;"><span>PARAMETER stop <span style="color:#e6db74">&#34;&lt;|end_header_id|&gt;&#34;</span>
</span></span><span style="display:flex;"><span>PARAMETER stop <span style="color:#e6db74">&#34;&lt;|eot_id|&gt;&#34;</span>
</span></span><span style="display:flex;"><span>PARAMETER stop <span style="color:#e6db74">&#34;&lt;|reserved_special_token&#34;</span>
</span></span></code></pre></div><pre><code>`ollama create llama3-CN -f ./Modelfile`
</code></pre>
<h1 id="简单对话页面">简单对话页面</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Chat with Model&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">body</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">font-family</span>: Arial, <span style="color:#66d9ef">sans-serif</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        #chat {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">max-width</span>: <span style="color:#ae81ff">800</span><span style="color:#66d9ef">px</span>; <span style="color:#75715e">/* 增大聊天框宽度 */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">auto</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">20</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#ae81ff">#ccc</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border-radius</span>: <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        #messages {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#ae81ff">#ddd</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">15</span><span style="color:#66d9ef">px</span>; <span style="color:#75715e">/* 增加内边距 */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">400</span><span style="color:#66d9ef">px</span>; <span style="color:#75715e">/* 增大消息框高度 */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">overflow-y</span>: <span style="color:#66d9ef">scroll</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">margin-bottom</span>: <span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">1.1</span><span style="color:#66d9ef">em</span>; <span style="color:#75715e">/* 增大字体 */</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        #input-container {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">flex</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        #input-container <span style="color:#f92672">input</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">flex</span>: <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">15</span><span style="color:#66d9ef">px</span>; <span style="color:#75715e">/* 增大输入框内边距 */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">1.1</span><span style="color:#66d9ef">em</span>; <span style="color:#75715e">/* 增大输入框字体 */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#ae81ff">#ddd</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border-radius</span>: <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        #input-container <span style="color:#f92672">button</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">15</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">1.1</span><span style="color:#66d9ef">em</span>; <span style="color:#75715e">/* 增大按钮字体 */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#ae81ff">#ddd</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border-left</span>: <span style="color:#66d9ef">none</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">border-radius</span>: <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">background-color</span>: <span style="color:#ae81ff">#007BFF</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">white</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">cursor</span>: <span style="color:#66d9ef">pointer</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">user</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">right</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">blue</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">assistant</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">left</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">green</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;chat&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;messages&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;input-container&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;input&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Ask a question...&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">onclick</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sendMessage()&#34;</span>&gt;Send&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 监听 Enter 键发送消息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;input&#39;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;keypress&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">event</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">key</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;Enter&#39;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">sendMessage</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">preventDefault</span>(); <span style="color:#75715e">// 阻止默认行为，避免页面刷新
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sendMessage</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">input</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;input&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">question</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">trim</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">question</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">appendMessage</span>(<span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#a6e22e">question</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;http://localhost:11434/api/chat&#39;</span>, {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;POST&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">model</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;llama3-CN&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">messages</span><span style="color:#f92672">:</span> [{<span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">question</span>}]
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">response</span> =&gt; {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">getReader</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">decoder</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TextDecoder</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">done</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// 创建一个空的 assistant 消息元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">assistantMessage</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createMessageElement</span>(<span style="color:#e6db74">&#39;assistant&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">messages</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;messages&#39;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">assistantMessage</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">read</span>() {
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">read</span>().<span style="color:#a6e22e">then</span>(({<span style="color:#a6e22e">done</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">doneReading</span>, <span style="color:#a6e22e">value</span>}) =&gt; {
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">doneReading</span>) {
</span></span><span style="display:flex;"><span>                                <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">chunk</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">decoder</span>.<span style="color:#a6e22e">decode</span>(<span style="color:#a6e22e">value</span>, {<span style="color:#a6e22e">stream</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>});
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                                <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">json</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">chunk</span>);
</span></span><span style="display:flex;"><span>                                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">message</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">content</span>) {
</span></span><span style="display:flex;"><span>                                    <span style="color:#75715e">// 动态更新 assistant 消息内容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                                    <span style="color:#a6e22e">assistantMessage</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">content</span>;
</span></span><span style="display:flex;"><span>                                    <span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">scrollTop</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">scrollHeight</span>;
</span></span><span style="display:flex;"><span>                                }
</span></span><span style="display:flex;"><span>                            } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>                                <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Error parsing JSON:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                            <span style="color:#a6e22e">read</span>();
</span></span><span style="display:flex;"><span>                        });
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">read</span>();
</span></span><span style="display:flex;"><span>                })
</span></span><span style="display:flex;"><span>                .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">error</span> =&gt; {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Error:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">appendMessage</span>(<span style="color:#e6db74">&#39;assistant&#39;</span>, <span style="color:#e6db74">&#39;Error occurred&#39;</span>);
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">appendMessage</span>(<span style="color:#a6e22e">role</span>, <span style="color:#a6e22e">content</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">messageElement</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createMessageElement</span>(<span style="color:#a6e22e">role</span>, <span style="color:#a6e22e">content</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">messages</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;messages&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">messageElement</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">scrollTop</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">scrollHeight</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createMessageElement</span>(<span style="color:#a6e22e">role</span>, <span style="color:#a6e22e">content</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">className</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">role</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">content</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">message</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p><img src="/images/img_7.png" alt=""></p>
    </div>
  <a href="/post/%E6%9C%AC%E5%9C%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E4%B8%AD%E6%96%87llama3_2%E5%B9%B6%E6%8F%90%E4%BE%9B%E7%AE%80%E5%8D%95%E5%AF%B9%E8%AF%9D%E9%A1%B5%E9%9D%A2/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/python/" class="link blue hover-black">
            Tag: Python
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        二月 22, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/python%E7%A6%BB%E7%BA%BF%E7%8E%AF%E5%A2%83%E4%BB%A5%E5%8F%8A%E7%8B%AC%E7%AB%8B%E7%8E%AF%E5%A2%83%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="link black dim">
        python离线环境以及独立环境的几种方式
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="起因">起因</h1>
<p>最近遇到<code>小可爱</code>的机器，没有外网，所以安装独立的python极为别扭</p>
<h1 id="方法">方法</h1>
<ul>
<li>
<p>conda离线安装
首先在联网的机器上，准备安装包，然后把安装包拷贝到离网机器后安装</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 设置安装包位置</span>
</span></span><span style="display:flex;"><span>pkgs_dirs:
</span></span><span style="display:flex;"><span>  - /home/up/myconda/pkgs
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 安装环境到安装包</span>
</span></span><span style="display:flex;"><span>conda create -n py38_pytorch pytorch python<span style="color:#f92672">==</span>3.8.5 --download-only
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 将安装包拷贝到指定位置，在离网机器上安装</span>
</span></span><span style="display:flex;"><span>conda create -n offlinepy38 pytorch python<span style="color:#f92672">==</span>3.8.5 --offline
</span></span></code></pre></div></li>
<li>
<p>conda环境打包</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>conda install conda-pack
</span></span><span style="display:flex;"><span>conda pack -n tf-1.15.0-py3.6
</span></span><span style="display:flex;"><span>tar -xzf tf-1.15.0-py3.6.tar.gz -C tf-1.15.0-py3.6
</span></span><span style="display:flex;"><span>source tf-1.15.0-py3.6/bin/activate
</span></span></code></pre></div></li>
<li>
<p>python venv</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>python3 -m venv venv
</span></span></code></pre></div></li>
</ul>
    </div>
  <a href="/post/python%E7%A6%BB%E7%BA%BF%E7%8E%AF%E5%A2%83%E4%BB%A5%E5%8F%8A%E7%8B%AC%E7%AB%8B%E7%8E%AF%E5%A2%83%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 7, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E5%88%86%E4%BA%AB%E8%87%AA%E5%B7%B1py%E4%BB%A3%E7%A0%81%E5%88%B0pypi/" class="link black dim">
        分享自己py代码到PyPI
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h3 id="准备条件">准备条件</h3>
<p>PyPI的账号</p>
<h3 id="代码格式">代码格式</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>filtered_flask/
</span></span><span style="display:flex;"><span>|-- filtered_flask/
</span></span><span style="display:flex;"><span>|   |-- __init__.py
</span></span><span style="display:flex;"><span>|   |-- app.py
</span></span><span style="display:flex;"><span>|-- tests/
</span></span><span style="display:flex;"><span>|-- setup.py
</span></span><span style="display:flex;"><span>|-- README.md
</span></span><span style="display:flex;"><span>|-- MANIFEST.in
</span></span></code></pre></div><ul>
<li>filtered_flask/app.py</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Flask, Response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> Flask(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 装饰器用于全局信息过滤</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.after_request</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">global_filter</span>(response):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 检查响应内容是否包含 &#34;test&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;test&#39;</span> <span style="color:#f92672">in</span> response<span style="color:#f92672">.</span>data:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 如果包含 &#34;test&#34;，可以采取过滤、修改或其他操作</span>
</span></span><span style="display:flex;"><span>        filtered_content <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;test&#39;</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;filtered&#39;</span>)
</span></span><span style="display:flex;"><span>        response<span style="color:#f92672">.</span>set_data(filtered_content)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 一个简单的路由返回包含 &#34;test&#34; 的内容</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">home</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;This is a test message.&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run(debug<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div><ul>
<li>filtered_flask/<strong>init</strong>.py</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> .app <span style="color:#f92672">import</span> app
</span></span></code></pre></div><ul>
<li>setup.py</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> setuptools <span style="color:#f92672">import</span> setup, find_packages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>setup(
</span></span><span style="display:flex;"><span>name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;filtered_flask&#39;</span>,
</span></span><span style="display:flex;"><span>version<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;0.1.0&#39;</span>,
</span></span><span style="display:flex;"><span>packages<span style="color:#f92672">=</span>find_packages(),
</span></span><span style="display:flex;"><span>install_requires<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;Flask&#39;</span>,
</span></span><span style="display:flex;"><span>],
</span></span><span style="display:flex;"><span>classifiers<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;Programming Language :: Python :: 3&#39;</span>,
</span></span><span style="display:flex;"><span>],
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><ul>
<li>MANIFEST.in</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>include README<span style="color:#f92672">.</span>md
</span></span><span style="display:flex;"><span>recursive<span style="color:#f92672">-</span>include filtered_flask<span style="color:#f92672">/</span>templates <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>recursive<span style="color:#f92672">-</span>include filtered_flask<span style="color:#f92672">/</span>static <span style="color:#f92672">*</span>
</span></span></code></pre></div><ul>
<li>
<p>README.md</p>
    </div>
  <a href="/post/%E5%88%86%E4%BA%AB%E8%87%AA%E5%B7%B1py%E4%BB%A3%E7%A0%81%E5%88%B0pypi/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 26, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/sqlalchemy%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/" class="link black dim">
        sqlalchemy操作数据库
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="代码">代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sqlalchemy <span style="color:#f92672">import</span> create_engine, text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DB_URI <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mysql+pymysql://</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">@</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(
</span></span><span style="display:flex;"><span>    USERNAME, PASSWORD, HOSTNAME, POST, DATABASE
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># SQLAlchemy 2.0.23</span>
</span></span><span style="display:flex;"><span>    db_engine <span style="color:#f92672">=</span> create_engine(DB_URI)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> db_engine<span style="color:#f92672">.</span>connect() <span style="color:#66d9ef">as</span> conn:
</span></span><span style="display:flex;"><span>        sql_query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT * FROM some_table WHERE id=:id&#34;</span>
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> conn<span style="color:#f92672">.</span>execute(text(sql_query), {<span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#ae81ff">1</span>})
</span></span><span style="display:flex;"><span>        print(result<span style="color:#f92672">.</span>all())
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;完成&#34;</span>, result<span style="color:#f92672">.</span>rowcount, <span style="color:#e6db74">&#34;行被更新。&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 如果是更新等语句要提交</span>
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>commit()
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">5</span>)
</span></span></code></pre></div>
    </div>
  <a href="/post/sqlalchemy%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 25, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/rabbitmq%E7%9A%84%E9%85%8D%E7%BD%AE%E5%8F%8Apython%E8%B0%83%E7%94%A8/" class="link black dim">
        rabbitMQ的配置及python调用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="配置rabbitmq">配置rabbitMQ</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>version: <span style="color:#e6db74">&#39;3.8&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>services:
</span></span><span style="display:flex;"><span>  rabbitmq:
</span></span><span style="display:flex;"><span>    image: rabbitmq:3-management
</span></span><span style="display:flex;"><span>    container_name: rabbitmq
</span></span><span style="display:flex;"><span>    ports:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;5672:5672&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;15672:15672&#34;</span>
</span></span><span style="display:flex;"><span>    environment:
</span></span><span style="display:flex;"><span>      RABBITMQ_DEFAULT_USER: user
</span></span><span style="display:flex;"><span>      RABBITMQ_DEFAULT_PASS: password
</span></span><span style="display:flex;"><span>    volumes:
</span></span><span style="display:flex;"><span>      - /dc/rabbitmq:/var/lib/rabbitmq
</span></span></code></pre></div><h1 id="生产者">生产者</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pika
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>connection <span style="color:#f92672">=</span> pika<span style="color:#f92672">.</span>BlockingConnection(
</span></span><span style="display:flex;"><span>    pika<span style="color:#f92672">.</span>ConnectionParameters(<span style="color:#e6db74">&#39;localhost&#39;</span>, <span style="color:#ae81ff">5672</span>, <span style="color:#e6db74">&#39;/&#39;</span>, pika<span style="color:#f92672">.</span>PlainCredentials(<span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#e6db74">&#39;password&#39;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>channel <span style="color:#f92672">=</span> connection<span style="color:#f92672">.</span>channel()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>channel<span style="color:#f92672">.</span>queue_declare(queue<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;log_queue&#39;</span>, durable<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>    message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello World1&#34;</span>
</span></span><span style="display:flex;"><span>    channel<span style="color:#f92672">.</span>basic_publish(
</span></span><span style="display:flex;"><span>        exchange<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>        routing_key<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;log_queue&#39;</span>,
</span></span><span style="display:flex;"><span>        body<span style="color:#f92672">=</span>message,
</span></span><span style="display:flex;"><span>        properties<span style="color:#f92672">=</span>pika<span style="color:#f92672">.</span>BasicProperties(
</span></span><span style="display:flex;"><span>            delivery_mode<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>,  <span style="color:#75715e"># make message persistent</span>
</span></span><span style="display:flex;"><span>        ))
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34; [x] Sent </span><span style="color:#e6db74">%r</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> message)
</span></span><span style="display:flex;"><span>connection<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><h1 id="消费者">消费者</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pika
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>connection <span style="color:#f92672">=</span> pika<span style="color:#f92672">.</span>BlockingConnection(
</span></span><span style="display:flex;"><span>    pika<span style="color:#f92672">.</span>ConnectionParameters(<span style="color:#e6db74">&#39;localhost&#39;</span>, <span style="color:#ae81ff">5672</span>, <span style="color:#e6db74">&#39;/&#39;</span>, pika<span style="color:#f92672">.</span>PlainCredentials(<span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#e6db74">&#39;password&#39;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>channel <span style="color:#f92672">=</span> connection<span style="color:#f92672">.</span>channel()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>channel<span style="color:#f92672">.</span>queue_declare(queue<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;log_queue&#39;</span>, durable<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">callback</span>(ch, method, properties, body):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34; [x] Received </span><span style="color:#e6db74">%r</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> body)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>channel<span style="color:#f92672">.</span>basic_consume(queue<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;log_queue&#39;</span>,
</span></span><span style="display:flex;"><span>                      on_message_callback<span style="color:#f92672">=</span>callback,
</span></span><span style="display:flex;"><span>                      auto_ack<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39; [*] Waiting for messages. To exit press CTRL+C&#39;</span>)
</span></span><span style="display:flex;"><span>channel<span style="color:#f92672">.</span>start_consuming()
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div>
    </div>
  <a href="/post/rabbitmq%E7%9A%84%E9%85%8D%E7%BD%AE%E5%8F%8Apython%E8%B0%83%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 25, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/python%E5%BD%95%E9%9F%B3/" class="link black dim">
        用python进行录音
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="代码">代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> pyaudio
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> wave
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> threading
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AudioRecorder</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>p <span style="color:#f92672">=</span> pyaudio<span style="color:#f92672">.</span>PyAudio()
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>stream <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>device_index <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>is_recording <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>recording_thread <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">list_input_devices</span>(self):
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;&#34;&#34;列出所有可用的录音设备&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            device_list <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(self<span style="color:#f92672">.</span>p<span style="color:#f92672">.</span>get_device_count()):
</span></span><span style="display:flex;"><span>                device_info <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>p<span style="color:#f92672">.</span>get_device_info_by_index(i)
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 筛选出录音设备</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> device_info[<span style="color:#e6db74">&#34;maxInputChannels&#34;</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                    device_list<span style="color:#f92672">.</span>append((i, device_info[<span style="color:#e6db74">&#34;name&#34;</span>]))
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Index: </span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">, Name: </span><span style="color:#e6db74">{</span>device_info[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> device_list
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">start_recording</span>(self, device_index, filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;output.wav&#34;</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;&#34;&#34;使用指定设备开始录音&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>device_index <span style="color:#f92672">=</span> device_index
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>is_recording <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 启动录音流</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>stream <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>p<span style="color:#f92672">.</span>open(format<span style="color:#f92672">=</span>pyaudio<span style="color:#f92672">.</span>paInt16,
</span></span><span style="display:flex;"><span>                                      channels<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                                      rate<span style="color:#f92672">=</span><span style="color:#ae81ff">44100</span>,
</span></span><span style="display:flex;"><span>                                      input<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                                      input_device_index<span style="color:#f92672">=</span>device_index,
</span></span><span style="display:flex;"><span>                                      frames_per_buffer<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;Recording started. Call `stop_recording` to end manually.&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 启动录音线程</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>recording_thread <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>record, args<span style="color:#f92672">=</span>(filename,))
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>recording_thread<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">record</span>(self, filename):
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;&#34;&#34;录音线程函数，用于捕获音频数据&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">while</span> self<span style="color:#f92672">.</span>is_recording:
</span></span><span style="display:flex;"><span>                    data <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>stream<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">1024</span>, exception_on_overflow<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>frames<span style="color:#f92672">.</span>append(data)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error during recording: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">stop_recording</span>(self, filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;output.wav&#34;</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;&#34;&#34;停止录音并保存文件&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>is_recording:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#34;Stopping recording...&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 停止录音循环</span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>is_recording <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 等待录音线程结束</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>recording_thread:
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>recording_thread<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 停止并关闭音频流</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>stream:
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>stream<span style="color:#f92672">.</span>stop_stream()
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>stream<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>stream <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#34;Recording stopped.&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 保存录音文件</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">with</span> wave<span style="color:#f92672">.</span>open(filename, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> wf:
</span></span><span style="display:flex;"><span>                    wf<span style="color:#f92672">.</span>setnchannels(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>                    wf<span style="color:#f92672">.</span>setsampwidth(self<span style="color:#f92672">.</span>p<span style="color:#f92672">.</span>get_sample_size(pyaudio<span style="color:#f92672">.</span>paInt16))
</span></span><span style="display:flex;"><span>                    wf<span style="color:#f92672">.</span>setframerate(<span style="color:#ae81ff">44100</span>)
</span></span><span style="display:flex;"><span>                    wf<span style="color:#f92672">.</span>writeframes(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(self<span style="color:#f92672">.</span>frames))
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Recording saved as </span><span style="color:#e6db74">{</span>filename<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">close</span>(self):
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;&#34;&#34;关闭 PyAudio 实例&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>p<span style="color:#f92672">.</span>terminate()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 使用示例</span>
</span></span><span style="display:flex;"><span>    recorder <span style="color:#f92672">=</span> AudioRecorder()
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    1. 列出所有录音设备
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    输出示例
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Index: 0, Name: “钱甫新的iPhone”的麦克风
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Index: 1, Name: MacBook Air麦克风
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    recorder<span style="color:#f92672">.</span>list_input_devices()
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    2. 选择一个设备进行录音（此处以设备索引0为例，具体要使用哪个录音设备，请参考具体的【列出所有录音设备】输出结果）
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    recorder<span style="color:#f92672">.</span>start_recording(device_index<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;test_recording.wav&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 模拟一些操作或等待录音，用户可以在适当的时候手动停止录音</span>
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    3. 手动接入停止录音
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    recorder<span style="color:#f92672">.</span>stop_recording(filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;test_recording.wav&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 最后关闭 PyAudio 实例</span>
</span></span><span style="display:flex;"><span>    recorder<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><h1 id="环境">环境</h1>
<pre><code>python3.10

PyAudio==0.2.14
</code></pre>
    </div>
  <a href="/post/python%E5%BD%95%E9%9F%B3/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 24, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/pythongui%E5%AE%9E%E7%8E%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%B5%81%E5%BC%8F%E5%AF%B9%E8%AF%9D_whisper_ollama/" class="link black dim">
        pythonGUI实现大模型流式对话_whisper_ollama
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="服务部署">服务部署</h1>
<h2 id="部署whisper-api服务">部署whisper api服务</h2>
<pre><code>version: '3.8'

services:
  whisper-asr:
    image: onerahmet/openai-whisper-asr-webservice:latest
    container_name: whisper-asr-service
    ports:
      - &quot;9099:9000&quot;
    volumes:
      - /Users/qianfuxin/dc/whisper:/root/.cache/whisper
    environment:
      - ASR_MODEL=base
      - ASR_ENGINE=openai_whisper
    restart: unless-stopped
</code></pre>
<h2 id="部署ollama">部署ollama</h2>
<p>见官网</p>
<h1 id="代码">代码</h1>
<pre><code>import mimetypes
import os
import sys
from datetime import datetime
import socksio
import requests
from PyQt5.QtWidgets import QApplication, QWidget, QVBoxLayout, QPushButton, QLabel, QTextEdit
import pyaudio
import wave
import threading
from langchain_core.messages import HumanMessage, SystemMessage
from langchain_core.output_parsers import StrOutputParser
from langchain_openai import ChatOpenAI


def transcribe_audio(file_path):
    &quot;&quot;&quot;
    Function to transcribe audio using the ASR service.

    :param file_path: The full path to the audio file to be transcribed.
    :return: The response text from the ASR service.
    &quot;&quot;&quot;
    # Ensure the file exists
    if not os.path.isfile(file_path):
        raise FileNotFoundError(f&quot;Audio file not found at: {file_path}&quot;)

    # Determine MIME type
    mime_type, _ = mimetypes.guess_type(file_path)
    if mime_type is None:
        raise ValueError(f&quot;Unable to determine MIME type for file: {file_path}&quot;)

    # Extract file name
    file_name = os.path.basename(file_path)

    url = &quot;http://localhost:9099/asr&quot;
    params = {
        &quot;encode&quot;: &quot;true&quot;,
        &quot;task&quot;: &quot;transcribe&quot;,
        &quot;language&quot;: &quot;zh&quot;,
        &quot;initial_prompt&quot;: &quot;这是一段简体中文&quot;,
        &quot;word_timestamps&quot;: &quot;false&quot;,
        &quot;output&quot;: &quot;txt&quot;
    }
    headers = {
        &quot;accept&quot;: &quot;application/json&quot;,
    }

    # Open the audio file
    with open(file_path, &quot;rb&quot;) as audio_file:
        files = {
            &quot;audio_file&quot;: (file_name, audio_file, mime_type)
        }

        # Send the POST request
        response = requests.post(url, headers=headers, params=params, files=files)
    return response.text


def get_model(base_url=&quot;http://127.0.0.1:11434/v1&quot;):
    &quot;&quot;&quot;Get the AI model instance.&quot;&quot;&quot;
    model = ChatOpenAI(
        api_key=&quot;ollama&quot;,
        model=&quot;qwen2&quot;,
        base_url=base_url
    )
    return model


class AudioRecorder:
    def __init__(self):
        self.p = pyaudio.PyAudio()
        self.stream = None
        self.frames = []
        self.device_index = None
        self.is_recording = False
        self.recording_thread = None

    def list_input_devices(self):
        &quot;&quot;&quot;List available input devices.&quot;&quot;&quot;
        device_list = []
        for i in range(self.p.get_device_count()):
            device_info = self.p.get_device_info_by_index(i)
            if device_info[&quot;maxInputChannels&quot;] &gt; 0:
                device_list.append((i, device_info[&quot;name&quot;]))
        return device_list

    def start_recording(self, device_index):
        &quot;&quot;&quot;Start recording with the specified device.&quot;&quot;&quot;
        self.device_index = device_index
        self.frames = []
        self.is_recording = True

        self.stream = self.p.open(format=pyaudio.paInt16,
                                  channels=1,
                                  rate=44100,
                                  input=True,
                                  input_device_index=device_index,
                                  frames_per_buffer=1024)

        self.recording_thread = threading.Thread(target=self.record)
        self.recording_thread.start()

    def record(self):
        &quot;&quot;&quot;Record audio in a separate thread.&quot;&quot;&quot;
        try:
            while self.is_recording:
                data = self.stream.read(1024, exception_on_overflow=False)
                self.frames.append(data)
        except IOError as e:
            print(f&quot;Buffer overflow occurred: {e}&quot;)

    def stop_recording(self, filename):
        &quot;&quot;&quot;Stop recording and save the file.&quot;&quot;&quot;
        if self.is_recording:
            self.is_recording = False
            if self.recording_thread and self.recording_thread.is_alive():
                self.recording_thread.join()

            if self.stream:
                self.stream.stop_stream()
                self.stream.close()
                self.stream = None

            with wave.open(filename, 'wb') as wf:
                wf.setnchannels(1)
                wf.setsampwidth(self.p.get_sample_size(pyaudio.paInt16))
                wf.setframerate(44100)
                wf.writeframes(b''.join(self.frames))

    def close(self):
        &quot;&quot;&quot;Close the PyAudio instance.&quot;&quot;&quot;
        self.p.terminate()


class RecorderApp(QWidget):
    def __init__(self):
        super().__init__()

        self.recorder = AudioRecorder()
        self.filename = None
        self.model = get_model()
        self.init_ui()

    def init_ui(self):
        self.setWindowTitle(&quot;实时语音识别与问答&quot;)
        self.setGeometry(100, 100, 500, 400)

        layout = QVBoxLayout()

        # 开启录音按钮
        self.start_button = QPushButton(&quot;开启录音&quot;)
        self.start_button.clicked.connect(self.start_recording)
        layout.addWidget(self.start_button)

        # 结束录音按钮
        self.stop_button = QPushButton(&quot;结束录音&quot;)
        self.stop_button.clicked.connect(self.stop_recording)
        self.stop_button.setEnabled(False)
        layout.addWidget(self.stop_button)

        # 状态显示标签
        self.status_label = QLabel(&quot;用户问题: &quot;, self)
        layout.addWidget(self.status_label)

        # 输出结果框
        self.output_box = QTextEdit(self)
        self.output_box.setReadOnly(True)
        layout.addWidget(self.output_box)

        self.setLayout(layout)

    def start_recording(self):
        device_index = 0  # For simplicity, we assume default device.
        start_time = datetime.now().strftime(&quot;%Y%m%d_%H%M%S&quot;)
        self.filename = f&quot;{start_time}.wav&quot;

        self.recorder.start_recording(device_index)
        self.start_button.setEnabled(False)
        self.stop_button.setEnabled(True)

    def stop_recording(self):
        self.recorder.stop_recording(self.filename)
        self.start_button.setEnabled(True)
        self.stop_button.setEnabled(False)

        # 转录音频并生成回答
        transcription = transcribe_audio(self.filename)
        self.status_label.setText(f&quot;用户问题: {transcription}&quot;)
        self.generate_answer(transcription)

    def generate_answer(self, transcription):
        &quot;&quot;&quot;
        Send the transcription to the large model and display the streamed response.
        &quot;&quot;&quot;
        QApplication.processEvents()

        messages = [
            SystemMessage(&quot;你是一个智能助手。&quot;),
            HumanMessage(content=transcription)
        ]
        parser = StrOutputParser()
        chain = self.model | parser

        response = &quot;&quot;
        for token in chain.stream(messages):
            response += token
            self.output_box.setText(response)
            QApplication.processEvents()


if __name__ == &quot;__main__&quot;:
    app = QApplication(sys.argv)
    window = RecorderApp()
    window.show()
    sys.exit(app.exec_())
</code></pre>
<h3 id="仅仅实现asr">仅仅实现ASR</h3>
<pre><code>import mimetypes
import os
import sys
from datetime import datetime

import requests
from PyQt5.QtGui import QIcon
from PyQt5.QtWidgets import QApplication, QWidget, QVBoxLayout, QPushButton, QLabel, QLineEdit, QComboBox, QMessageBox, \
    QSystemTrayIcon, QMenu, QAction
import pyaudio
import wave
import threading


def transcribe_audio(file_path):
    &quot;&quot;&quot;
    Function to transcribe audio using the ASR service.

    :param file_path: The full path to the audio file to be transcribed.
    :return: The response text from the ASR service.
    &quot;&quot;&quot;
    # Ensure the file exists
    if not os.path.isfile(file_path):
        raise FileNotFoundError(f&quot;Audio file not found at: {file_path}&quot;)

    # Determine MIME type
    mime_type, _ = mimetypes.guess_type(file_path)
    if mime_type is None:
        raise ValueError(f&quot;Unable to determine MIME type for file: {file_path}&quot;)

    # Extract file name
    file_name = os.path.basename(file_path)

    url = &quot;http://localhost:9099/asr&quot;
    params = {
        &quot;encode&quot;: &quot;true&quot;,
        &quot;task&quot;: &quot;transcribe&quot;,
        &quot;language&quot;: &quot;zh&quot;,
        &quot;initial_prompt&quot;: &quot;这是一段简体中文&quot;,
        &quot;word_timestamps&quot;: &quot;false&quot;,
        &quot;output&quot;: &quot;txt&quot;
    }
    headers = {
        &quot;accept&quot;: &quot;application/json&quot;,
    }

    # Open the audio file
    with open(file_path, &quot;rb&quot;) as audio_file:
        files = {
            &quot;audio_file&quot;: (file_name, audio_file, mime_type)
        }

        # Send the POST request
        response = requests.post(url, headers=headers, params=params, files=files)

    return response.text


class AudioRecorder:
    def __init__(self):
        self.p = pyaudio.PyAudio()
        self.stream = None
        self.frames = []
        self.device_index = None
        self.is_recording = False
        self.recording_thread = None

    def list_input_devices(self):
        &quot;&quot;&quot;列出所有可用的录音设备&quot;&quot;&quot;
        device_list = []
        for i in range(self.p.get_device_count()):
            device_info = self.p.get_device_info_by_index(i)
            # 筛选出录音设备
            if device_info[&quot;maxInputChannels&quot;] &gt; 0:
                device_list.append((i, device_info[&quot;name&quot;]))
        return device_list

    def start_recording(self, device_index):
        &quot;&quot;&quot;使用指定设备开始录音&quot;&quot;&quot;
        self.device_index = device_index
        self.frames = []
        self.is_recording = True

        self.stream = self.p.open(format=pyaudio.paInt16,
                                  channels=1,
                                  rate=44100,
                                  input=True,
                                  input_device_index=device_index,
                                  frames_per_buffer=1024)

        # 启动录音线程
        self.recording_thread = threading.Thread(target=self.record)
        self.recording_thread.start()

    def record(self):
        &quot;&quot;&quot;录音线程函数，用于捕获音频数据&quot;&quot;&quot;
        try:
            while self.is_recording:
                data = self.stream.read(1024, exception_on_overflow=False)
                self.frames.append(data)
        except IOError as e:
            print(f&quot;Buffer overflow occurred: {e}&quot;)

    def stop_recording(self, filename):
        &quot;&quot;&quot;停止录音并保存文件&quot;&quot;&quot;
        if self.is_recording:
            self.is_recording = False
            if self.recording_thread and self.recording_thread.is_alive():
                self.recording_thread.join()

            if self.stream:
                self.stream.stop_stream()
                self.stream.close()
                self.stream = None

            with wave.open(filename, 'wb') as wf:
                wf.setnchannels(1)
                wf.setsampwidth(self.p.get_sample_size(pyaudio.paInt16))
                wf.setframerate(44100)
                wf.writeframes(b''.join(self.frames))

    def close(self):
        &quot;&quot;&quot;关闭 PyAudio 实例&quot;&quot;&quot;
        self.p.terminate()


def resource_path(relative_path):
    &quot;&quot;&quot;获取资源文件的绝对路径&quot;&quot;&quot;
    if hasattr(sys, '_MEIPASS'):
        return os.path.join(sys._MEIPASS, relative_path)
    return os.path.join(os.path.abspath(&quot;.&quot;), relative_path)


class RecorderApp(QWidget):
    def __init__(self):
        super().__init__()

        self.recorder = AudioRecorder()
        self.filename = None

        self.init_ui()

    def init_ui(self):
        self.setWindowTitle(&quot;录音器&quot;)
        self.setGeometry(100, 100, 400, 300)

        # 创建系统托盘图标
        self.tray_icon = QSystemTrayIcon(self)
        self.tray_icon.setIcon(QIcon(resource_path(&quot;icon.png&quot;)))

        # 创建托盘菜单
        tray_menu = QMenu()

        # 添加显示窗口的选项
        show_action = QAction(&quot;显示窗口&quot;, self)
        show_action.triggered.connect(self.show)
        tray_menu.addAction(show_action)

        # 添加退出的选项
        exit_action = QAction(&quot;退出&quot;, self)
        exit_action.triggered.connect(QApplication.instance().quit)
        tray_menu.addAction(exit_action)

        # 将菜单添加到托盘图标
        self.tray_icon.setContextMenu(tray_menu)

        # 设置点击双击托盘图标的动作
        self.tray_icon.activated.connect(self.on_tray_icon_activated)

        # 显示托盘图标
        self.tray_icon.show()

        layout = QVBoxLayout()

        # 开启录音按钮
        self.start_button = QPushButton(&quot;开启录音&quot;)
        self.start_button.clicked.connect(self.start_recording)
        layout.addWidget(self.start_button)

        # 结束录音按钮
        self.stop_button = QPushButton(&quot;结束录音&quot;)
        self.stop_button.clicked.connect(self.stop_recording)
        self.stop_button.setEnabled(False)
        layout.addWidget(self.stop_button)

        # 设备选择下拉菜单
        self.device_selector = QComboBox(self)
        devices = self.recorder.list_input_devices()
        if devices:
            for index, name in devices:
                self.device_selector.addItem(name, index)
        else:
            QMessageBox.warning(self, &quot;错误&quot;, &quot;未检测到录音设备&quot;)
            self.start_button.setEnabled(False)
        layout.addWidget(self.device_selector)

        # 状态显示标签
        self.status_label = QLabel(&quot;状态: 未录音&quot;, self)
        layout.addWidget(self.status_label)

        self.setLayout(layout)

    def closeEvent(self, event):
        &quot;&quot;&quot;窗口关闭事件&quot;&quot;&quot;
        if self.isVisible():  # 如果窗口可见，则最小化到托盘
            event.ignore()
            self.hide()
            self.tray_icon.showMessage(
                &quot;应用最小化&quot;, &quot;程序已最小化到托盘&quot;,
                QSystemTrayIcon.Information, 2000
            )
        else:  # 关闭应用时清理资源
            self.recorder.close()
            event.accept()

    def on_tray_icon_activated(self, reason):
        &quot;&quot;&quot;托盘图标激活事件&quot;&quot;&quot;
        if reason == QSystemTrayIcon.DoubleClick:
            self.show()

    def start_recording(self):
        device_index = self.device_selector.currentData()
        start_time = datetime.now().strftime(&quot;%Y%m%d_%H%M%S&quot;)
        self.filename = f&quot;{start_time}.wav&quot;

        self.recorder.start_recording(device_index)
        self.status_label.setText(&quot;状态: 录音中...&quot;)
        self.start_button.setEnabled(False)
        self.stop_button.setEnabled(True)

    def stop_recording(self):
        end_time = datetime.now().strftime(&quot;%Y%m%d_%H%M%S&quot;)
        self.filename = f&quot;{self.filename[:-4]}-{end_time}.wav&quot;  # 更新文件名
        self.recorder.stop_recording(self.filename)
        self.status_label.setText(f&quot;状态: 录音已保存为 {self.filename}&quot;)
        self.start_button.setEnabled(True)
        self.stop_button.setEnabled(False)
        self.status_label.setText(f&quot;状态: 录音已保存为 {self.filename}\n录音内容：{transcribe_audio(self.filename)}&quot;)


# 主程序入口
if __name__ == &quot;__main__&quot;:
    app = QApplication(sys.argv)
    window = RecorderApp()
    window.show()
    sys.exit(app.exec_())
    &quot;&quot;&quot;
    pyinstaller --onefile --windowed --noconfirm --add-data &quot;icon.png;.&quot; app.py
    &quot;&quot;&quot;
</code></pre>
    </div>
  <a href="/post/pythongui%E5%AE%9E%E7%8E%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%B5%81%E5%BC%8F%E5%AF%B9%E8%AF%9D_whisper_ollama/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 23, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/memcached%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8Epython%E8%B0%83%E7%94%A8/" class="link black dim">
        memcached的部署与python调用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="部署">部署</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>version: <span style="color:#e6db74">&#39;3.8&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>services:  
</span></span><span style="display:flex;"><span>memcached:  
</span></span><span style="display:flex;"><span>image: memcached  
</span></span><span style="display:flex;"><span>container_name: memcached  
</span></span><span style="display:flex;"><span>ports:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#e6db74">&#34;11211:11211&#34;</span>
</span></span></code></pre></div><h1 id="python调用">python调用</h1>
<pre><code>from pymemcache.client import base

# 连接到 Memcached 服务
client = base.Client(('localhost', 11211))

# 设置一个键值对
client.set('my_key', 'Hello, Memcached!')

# 获取存储的值
value = client.get('my_key')
print(f'Value for my_key: {value.decode(&quot;utf-8&quot;)}')

# 删除键值对
client.delete('my_key')

# 关闭连接
client.close()
</code></pre>
<h1 id="总结">总结</h1>
<p>memcached是一个很单纯的缓存服务（减少数据库压力），数据存放在内存，所以没必要本地映射，
而且不支持身份验证，所以需要在容器互联时使用，不应该让外部访问。</p>
    </div>
  <a href="/post/memcached%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8Epython%E8%B0%83%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E9%95%9C%E5%83%8F/" class="link blue hover-black">
            Tag: 镜像
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        二月 22, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E6%9E%84%E5%BB%BA%E5%A4%9A%E5%B9%B3%E5%8F%B0%E9%95%9C%E5%83%8F/" class="link black dim">
        docker构建多平台镜像
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="使用buildx">使用buildx</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker buildx create --use
</span></span></code></pre></div><h1 id="构建镜像并上传云端">构建镜像并上传云端</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker buildx build --platform linux/amd64,linux/arm64 -t qianfuxin/my-python-app:latest . --push
</span></span></code></pre></div><h1 id="测试">测试</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker pull qianfuxin/my-python-app:latest
</span></span><span style="display:flex;"><span>docker inspect qianfuxin/my-python-app | grep Architecture
</span></span><span style="display:flex;"><span>docker run --rm qianfuxin/my-python-app
</span></span></code></pre></div>
    </div>
  <a href="/post/%E6%9E%84%E5%BB%BA%E5%A4%9A%E5%B9%B3%E5%8F%B0%E9%95%9C%E5%83%8F/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E5%BE%AE%E8%B0%83/" class="link blue hover-black">
            Tag: 微调
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        二月 22, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BD%BF%E7%94%A8llama_factory%E8%BF%9B%E8%A1%8C%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/" class="link black dim">
        使用LLaMA_factory进行模型微调
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="环境安装">环境安装</h1>
<blockquote>
<p><a href="https://github.com/hiyouga/LLaMA-Factory/blob/main/README_zh.md">参考</a></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>conda create -n llama_factory python<span style="color:#f92672">=</span>3.10 -y
</span></span><span style="display:flex;"><span>conda activate llama_factory
</span></span><span style="display:flex;"><span>pip install --upgrade pip
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置清华源，可选</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pip config set global.index-url https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple</span>
</span></span><span style="display:flex;"><span>git clone --depth <span style="color:#ae81ff">1</span> https://github.com/hiyouga/LLaMA-Factory.git
</span></span><span style="display:flex;"><span>cd LLaMA-Factory
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 遇到包冲突时，可使用 pip install --no-deps -e . 解决。</span>
</span></span><span style="display:flex;"><span>pip install -e <span style="color:#e6db74">&#34;.[torch,metrics]&#34;</span>
</span></span></code></pre></div><h1 id="环境验证">环境验证</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>llamafactory-cli -h
</span></span></code></pre></div><h1 id="启动web环境">启动web环境</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>USE_MODELSCOPE_HUB<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> llamafactory-cli webui
</span></span></code></pre></div><h1 id="命令行">命令行</h1>
<blockquote>
<p><a href="https://llamafactory.readthedocs.io/zh-cn/latest/getting_started/merge_lora.html">参考</a></p>
</blockquote>
    </div>
  <a href="/post/%E4%BD%BF%E7%94%A8llama_factory%E8%BF%9B%E8%A1%8C%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 28, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/transformer%E5%BE%AE%E8%B0%83%E5%8F%8A%E5%90%8E%E7%BB%AD%E6%8E%A8%E7%90%86/" class="link black dim">
        transformer微调及后续推理
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="微调">微调</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> AutoModelForSequenceClassification
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>device <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>device(<span style="color:#e6db74">&#34;mps&#34;</span>)
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> AutoModelForSequenceClassification<span style="color:#f92672">.</span>from_pretrained(<span style="color:#e6db74">&#34;distilbert/distilbert-base-uncased&#34;</span>)<span style="color:#f92672">.</span>to(device)
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> TrainingArguments
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>training_args <span style="color:#f92672">=</span> TrainingArguments(
</span></span><span style="display:flex;"><span>    output_dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;path/to/save/folder/&#34;</span>,
</span></span><span style="display:flex;"><span>    learning_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">2e-5</span>,
</span></span><span style="display:flex;"><span>    per_device_train_batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>    per_device_eval_batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>    num_train_epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> AutoTokenizer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tokenizer <span style="color:#f92672">=</span> AutoTokenizer<span style="color:#f92672">.</span>from_pretrained(<span style="color:#e6db74">&#34;distilbert/distilbert-base-uncased&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datasets <span style="color:#f92672">import</span> load_dataset
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset <span style="color:#f92672">=</span> load_dataset(<span style="color:#e6db74">&#34;rotten_tomatoes&#34;</span>)  <span style="color:#75715e"># doctest: +IGNORE_RESULT</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tokenize_dataset</span>(dataset):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> tokenizer(dataset[<span style="color:#e6db74">&#34;text&#34;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset <span style="color:#f92672">=</span> dataset<span style="color:#f92672">.</span>map(tokenize_dataset, batched<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> DataCollatorWithPadding
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data_collator <span style="color:#f92672">=</span> DataCollatorWithPadding(tokenizer<span style="color:#f92672">=</span>tokenizer)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> Trainer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>trainer <span style="color:#f92672">=</span> Trainer(
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">=</span>model,
</span></span><span style="display:flex;"><span>    args<span style="color:#f92672">=</span>training_args,
</span></span><span style="display:flex;"><span>    train_dataset<span style="color:#f92672">=</span>dataset[<span style="color:#e6db74">&#34;train&#34;</span>]<span style="color:#f92672">.</span>with_format(<span style="color:#e6db74">&#34;torch&#34;</span>, device<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mps&#34;</span>),
</span></span><span style="display:flex;"><span>    eval_dataset<span style="color:#f92672">=</span>dataset[<span style="color:#e6db74">&#34;test&#34;</span>]<span style="color:#f92672">.</span>with_format(<span style="color:#e6db74">&#34;torch&#34;</span>, device<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mps&#34;</span>),
</span></span><span style="display:flex;"><span>    tokenizer<span style="color:#f92672">=</span>tokenizer,
</span></span><span style="display:flex;"><span>    data_collator<span style="color:#f92672">=</span>data_collator,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>trainer<span style="color:#f92672">.</span>train()
</span></span><span style="display:flex;"><span>trainer<span style="color:#f92672">.</span>save_model(<span style="color:#e6db74">&#34;path/to/save/folder&#34;</span>)
</span></span></code></pre></div><h1 id="使用微调模型推理">使用微调模型推理</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> pipeline
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>device <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>device(<span style="color:#e6db74">&#34;mps&#34;</span>) <span style="color:#66d9ef">if</span> torch<span style="color:#f92672">.</span>backends<span style="color:#f92672">.</span>mps<span style="color:#f92672">.</span>is_available() <span style="color:#66d9ef">else</span> torch<span style="color:#f92672">.</span>device(<span style="color:#e6db74">&#34;cpu&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pipe <span style="color:#f92672">=</span> pipeline(<span style="color:#e6db74">&#34;fill-mask&#34;</span>, model<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;path/to/save/folder&#34;</span>, device<span style="color:#f92672">=</span>device)
</span></span><span style="display:flex;"><span>print(pipe(<span style="color:#e6db74">&#34;The goal of life is [MASK].&#34;</span>))
</span></span></code></pre></div>
    </div>
  <a href="/post/transformer%E5%BE%AE%E8%B0%83%E5%8F%8A%E5%90%8E%E7%BB%AD%E6%8E%A8%E7%90%86/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/centos/" class="link blue hover-black">
            Tag: Centos
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        二月 15, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/centos%E9%85%8D%E7%BD%AEzsh/" class="link black dim">
        centos配置zsh
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装zsh">安装zsh</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>yum -y install zsh git
</span></span></code></pre></div><h1 id="切换为zsh">切换为zsh</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo chsh -s /bin/zsh
</span></span></code></pre></div><h1 id="安装ohmyzsh">安装ohmyzsh</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sh -c <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><h1 id="使用插件">使用插件</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>git clone https://github.com/zsh-users/zsh-autosuggestions <span style="color:#e6db74">${</span>ZSH_CUSTOM<span style="color:#66d9ef">:-</span>$HOME/.oh-my-zsh/custom<span style="color:#e6db74">}</span>/plugins/zsh-autosuggestions
</span></span><span style="display:flex;"><span>git clone https://github.com/zsh-users/zsh-syntax-highlighting <span style="color:#e6db74">${</span>ZSH_CUSTOM<span style="color:#66d9ef">:-</span>~/.oh-my-zsh/custom<span style="color:#e6db74">}</span>/plugins/zsh-syntax-highlighting
</span></span><span style="display:flex;"><span>vim ~/.zshrc
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>plugins<span style="color:#f92672">=(</span>git web-search jsontools z vi-mode zsh-syntax-highlighting zsh-autosuggestions<span style="color:#f92672">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>source ~/.zshrc
</span></span></code></pre></div>
    </div>
  <a href="/post/centos%E9%85%8D%E7%BD%AEzsh/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/pocketbase/" class="link blue hover-black">
            Tag: Pocketbase
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        二月 15, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/pocketbase%E7%9A%84pythonsdk/" class="link black dim">
        pocketbase的pythonSDK
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="权限放行">权限放行</h1>
<p>表对应的api_rules需要设置为<code>@request.auth.id != &quot;&quot;</code>，只有登录认证后的用户才可以操作。</p>
<h1 id="函数封装">函数封装</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Authorization&#34;</span>: token
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">records</span>():
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://test.com/api/collections/posts/records?page=1&amp;perPage=50&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> requests<span style="color:#f92672">.</span>get(url, headers<span style="color:#f92672">=</span>headers)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">record</span>(id):
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://test.com/api/collections/posts/records/</span><span style="color:#e6db74">{</span>id<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> requests<span style="color:#f92672">.</span>get(url, headers<span style="color:#f92672">=</span>headers)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_record</span>(data):
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://test.com/api/collections/posts/records&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> requests<span style="color:#f92672">.</span>post(url, headers<span style="color:#f92672">=</span>headers, json<span style="color:#f92672">=</span>data)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">delete_record</span>(id):
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://test.com/api/collections/posts/records/</span><span style="color:#e6db74">{</span>id<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>delete(url, headers<span style="color:#f92672">=</span>headers)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;id&#34;</span>: id}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update_record</span>(id, data):
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://test.com/api/collections/posts/records/</span><span style="color:#e6db74">{</span>id<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> requests<span style="color:#f92672">.</span>patch(url, headers<span style="color:#f92672">=</span>headers, json<span style="color:#f92672">=</span>data)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(delete_record(<span style="color:#e6db74">&#34;c9w208d7mgh0ziu&#34;</span>))
</span></span><span style="display:flex;"><span>print(create_record({<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;qfx&#34;</span>}))
</span></span><span style="display:flex;"><span>print(records())
</span></span><span style="display:flex;"><span>print(record(<span style="color:#e6db74">&#34;c9w208d7mgh0ziu&#34;</span>))
</span></span><span style="display:flex;"><span>print(update_record(<span style="color:#e6db74">&#34;44z3c02j65203k0&#34;</span>, {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;钱甫新&#34;</span>}))
</span></span></code></pre></div><h1 id="类封装">类封装</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PostAPI</span>:
</span></span><span style="display:flex;"><span>    BASE_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://test.com/api/collections/posts/records&#34;</span>
</span></span><span style="display:flex;"><span>    LOGIN_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://test.com/api/collections/users/auth-with-password&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, identity, password):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>token <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>login(identity, password)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>headers <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;Authorization&#34;</span>: self<span style="color:#f92672">.</span>token}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">login</span>(self, identity, password):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;登录并获取 Token&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(self<span style="color:#f92672">.</span>LOGIN_URL, json<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;identity&#34;</span>: identity, <span style="color:#e6db74">&#34;password&#34;</span>: password})<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;token&#34;</span> <span style="color:#f92672">in</span> response:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> response[<span style="color:#e6db74">&#34;token&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;登录失败: </span><span style="color:#e6db74">{</span>response<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_all</span>(self, page<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, per_page<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;获取所有记录&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>BASE_URL<span style="color:#e6db74">}</span><span style="color:#e6db74">?page=</span><span style="color:#e6db74">{</span>page<span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;perPage=</span><span style="color:#e6db74">{</span>per_page<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> requests<span style="color:#f92672">.</span>get(url, headers<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>headers)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_one</span>(self, record_id):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;获取单条记录&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>BASE_URL<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>record_id<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> requests<span style="color:#f92672">.</span>get(url, headers<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>headers)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create</span>(self, data):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;创建新记录&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> requests<span style="color:#f92672">.</span>post(self<span style="color:#f92672">.</span>BASE_URL, headers<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>headers, json<span style="color:#f92672">=</span>data)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update</span>(self, record_id, data):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;更新记录&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>BASE_URL<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>record_id<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> requests<span style="color:#f92672">.</span>patch(url, headers<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>headers, json<span style="color:#f92672">=</span>data)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">delete</span>(self, record_id):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;删除记录&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>BASE_URL<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>record_id<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            data <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>delete(url, headers<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>headers)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>            data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;id&#34;</span>: record_id}
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>identity <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;test@163.com&#34;</span>
</span></span><span style="display:flex;"><span>password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;12345678&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>api <span style="color:#f92672">=</span> PostAPI(identity, password)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 获取所有记录</span>
</span></span><span style="display:flex;"><span>records <span style="color:#f92672">=</span> api<span style="color:#f92672">.</span>get_all()
</span></span><span style="display:flex;"><span>print(records)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 获取单条记录</span>
</span></span><span style="display:flex;"><span>record <span style="color:#f92672">=</span> api<span style="color:#f92672">.</span>get_one(<span style="color:#e6db74">&#34;515v170sh79pt0h&#34;</span>)
</span></span><span style="display:flex;"><span>print(record)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建记录</span>
</span></span><span style="display:flex;"><span>new_data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;作者&#34;</span>}
</span></span><span style="display:flex;"><span>created_record <span style="color:#f92672">=</span> api<span style="color:#f92672">.</span>create(new_data)
</span></span><span style="display:flex;"><span>print(created_record)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 更新记录</span>
</span></span><span style="display:flex;"><span>update_data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;哈哈哈哈&#34;</span>}
</span></span><span style="display:flex;"><span>updated_record <span style="color:#f92672">=</span> api<span style="color:#f92672">.</span>update(<span style="color:#e6db74">&#34;515v170sh79pt0h&#34;</span>, update_data)
</span></span><span style="display:flex;"><span>print(updated_record)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 删除记录</span>
</span></span><span style="display:flex;"><span>deleted_record <span style="color:#f92672">=</span> api<span style="color:#f92672">.</span>delete(<span style="color:#e6db74">&#34;8q5k6618bkimfy5&#34;</span>)
</span></span><span style="display:flex;"><span>print(deleted_record)
</span></span></code></pre></div>
    </div>
  <a href="/post/pocketbase%E7%9A%84pythonsdk/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/zsh/" class="link blue hover-black">
            Tag: Zsh
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        二月 15, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/centos%E9%85%8D%E7%BD%AEzsh/" class="link black dim">
        centos配置zsh
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装zsh">安装zsh</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>yum -y install zsh git
</span></span></code></pre></div><h1 id="切换为zsh">切换为zsh</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo chsh -s /bin/zsh
</span></span></code></pre></div><h1 id="安装ohmyzsh">安装ohmyzsh</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sh -c <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><h1 id="使用插件">使用插件</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>git clone https://github.com/zsh-users/zsh-autosuggestions <span style="color:#e6db74">${</span>ZSH_CUSTOM<span style="color:#66d9ef">:-</span>$HOME/.oh-my-zsh/custom<span style="color:#e6db74">}</span>/plugins/zsh-autosuggestions
</span></span><span style="display:flex;"><span>git clone https://github.com/zsh-users/zsh-syntax-highlighting <span style="color:#e6db74">${</span>ZSH_CUSTOM<span style="color:#66d9ef">:-</span>~/.oh-my-zsh/custom<span style="color:#e6db74">}</span>/plugins/zsh-syntax-highlighting
</span></span><span style="display:flex;"><span>vim ~/.zshrc
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>plugins<span style="color:#f92672">=(</span>git web-search jsontools z vi-mode zsh-syntax-highlighting zsh-autosuggestions<span style="color:#f92672">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>source ~/.zshrc
</span></span></code></pre></div>
    </div>
  <a href="/post/centos%E9%85%8D%E7%BD%AEzsh/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/ssh/" class="link blue hover-black">
            Tag: Ssh
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        一月 21, 2025
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/mac&#43;clash&#43;gitssh%E4%BB%A3%E7%90%86/" class="link black dim">
        mac使用clash后解决gitSSH不能使用的问题
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="起因">起因</h1>
<p>有一天使用git ssh 拉取代码，发现网络卡住，密钥已经录入GitHub，所以只可能是网络不通畅的原因。</p>
<h1 id="解放方案">解放方案</h1>
<p><code>vim ~/.ssh/config</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Host github.com
</span></span><span style="display:flex;"><span>  HostName ssh.github.com
</span></span><span style="display:flex;"><span>  Port <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>  User git
</span></span></code></pre></div>
    </div>
  <a href="/post/mac&#43;clash&#43;gitssh%E4%BB%A3%E7%90%86/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E5%BD%A9%E7%A5%A8/" class="link blue hover-black">
            Tag: 彩票
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 12, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E9%9A%8F%E6%9C%BA%E7%94%9F%E6%88%90%E5%BD%A9%E7%A5%A8%E5%8F%B7%E7%A0%81/" class="link black dim">
        随机生成彩票号码
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="代码">代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_shuang_se_qiu</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    双色球每注投注号码由6个红色球号码和1个蓝色球号码组成。红色球号码从1〜33中选择；蓝色球号码从1〜16中选择。每注需要选择6个红色球号码以及1个蓝色球号码。
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> sorted(random<span style="color:#f92672">.</span>sample(range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">34</span>), <span style="color:#ae81ff">6</span>)), random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">17</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_da_le_tou</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    大乐透每期从35个前区号码中开出5个号码，从12个后区号码中开出2个号码作为中奖号码，大乐透玩法即是竞猜开奖号码的5个前区号码和2个后区号码，顺序不限。
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> sorted(random<span style="color:#f92672">.</span>sample(range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">36</span>), <span style="color:#ae81ff">5</span>)), sorted(random<span style="color:#f92672">.</span>sample(range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">13</span>), <span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    print(generate_shuang_se_qiu())
</span></span><span style="display:flex;"><span>    print(generate_da_le_tou())
</span></span></code></pre></div>
    </div>
  <a href="/post/%E9%9A%8F%E6%9C%BA%E7%94%9F%E6%88%90%E5%BD%A9%E7%A5%A8%E5%8F%B7%E7%A0%81/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 10, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E8%8E%B7%E5%8F%96%E5%8E%86%E5%8F%B2%E7%9A%84%E5%A4%A7%E4%B9%90%E9%80%8F%E5%92%8C%E5%8F%8C%E8%89%B2%E7%90%83%E6%95%B0%E6%8D%AE/" class="link black dim">
        获取历史的大乐透和双色球数据
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="代码">代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> script.utils <span style="color:#f92672">import</span> insert_db_by_api
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_da_le_tou_history_data_and_sava2db</span>():
</span></span><span style="display:flex;"><span>    pageNo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://webapi.sporttery.cn/gateway/lottery/getHistoryPageListV1.qry?gameNo=85&amp;provinceId=0&amp;pageSize=30&amp;isVerify=1&amp;pageNo=</span><span style="color:#e6db74">{</span>pageNo<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>    maxPageNO <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;value&#34;</span>][<span style="color:#e6db74">&#34;pages&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#34;value&#34;</span>][<span style="color:#e6db74">&#34;list&#34;</span>]:
</span></span><span style="display:flex;"><span>        print(i[<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>], i[<span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>], i[<span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>])
</span></span><span style="display:flex;"><span>        insert_db_by_api(<span style="color:#e6db74">&#34;daletous&#34;</span>,
</span></span><span style="display:flex;"><span>                         {<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>: i[<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>], <span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>: i[<span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>],
</span></span><span style="display:flex;"><span>                          <span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>: i[<span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>]})
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>, maxPageNO <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://webapi.sporttery.cn/gateway/lottery/getHistoryPageListV1.qry?gameNo=85&amp;provinceId=0&amp;pageSize=30&amp;isVerify=1&amp;pageNo=</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#34;value&#34;</span>][<span style="color:#e6db74">&#34;list&#34;</span>]:
</span></span><span style="display:flex;"><span>            print(j[<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>], j[<span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>], j[<span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>])
</span></span><span style="display:flex;"><span>            insert_db_by_api(<span style="color:#e6db74">&#34;daletous&#34;</span>,
</span></span><span style="display:flex;"><span>                             {<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>: j[<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>], <span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>: j[<span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>],
</span></span><span style="display:flex;"><span>                              <span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>: j[<span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>]})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_shuang_se_qiu_history_data_and_sava2db</span>():
</span></span><span style="display:flex;"><span>    pageNo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://www.cwl.gov.cn/cwl_admin/front/cwlkj/search/kjxx/findDrawNotice?name=ssq&amp;pageNo=</span><span style="color:#e6db74">{</span>pageNo<span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;pageSize=30&amp;systemType=PC&#34;</span>
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>    maxPageNO <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;pageNum&#34;</span>]
</span></span><span style="display:flex;"><span>    print(maxPageNO)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#34;result&#34;</span>]:
</span></span><span style="display:flex;"><span>        print(i[<span style="color:#e6db74">&#34;red&#34;</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#f92672">+</span> i[<span style="color:#e6db74">&#34;blue&#34;</span>], i[<span style="color:#e6db74">&#34;date&#34;</span>], i[<span style="color:#e6db74">&#34;code&#34;</span>])
</span></span><span style="display:flex;"><span>        insert_db_by_api(<span style="color:#e6db74">&#34;shuangseqius&#34;</span>,
</span></span><span style="display:flex;"><span>                         {<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>: i[<span style="color:#e6db74">&#34;red&#34;</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#f92672">+</span> i[<span style="color:#e6db74">&#34;blue&#34;</span>], <span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>: i[<span style="color:#e6db74">&#34;date&#34;</span>],
</span></span><span style="display:flex;"><span>                          <span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>: i[<span style="color:#e6db74">&#34;code&#34;</span>]})
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>, maxPageNO <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://www.cwl.gov.cn/cwl_admin/front/cwlkj/search/kjxx/findDrawNotice?name=ssq&amp;pageNo=</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;pageSize=30&amp;systemType=PC&#34;</span>
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#34;result&#34;</span>]:
</span></span><span style="display:flex;"><span>            print(j[<span style="color:#e6db74">&#34;red&#34;</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#f92672">+</span> j[<span style="color:#e6db74">&#34;blue&#34;</span>], j[<span style="color:#e6db74">&#34;date&#34;</span>], j[<span style="color:#e6db74">&#34;code&#34;</span>])
</span></span><span style="display:flex;"><span>            insert_db_by_api(<span style="color:#e6db74">&#34;shuangseqius&#34;</span>,
</span></span><span style="display:flex;"><span>                             {<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>: j[<span style="color:#e6db74">&#34;red&#34;</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#f92672">+</span> j[<span style="color:#e6db74">&#34;blue&#34;</span>], <span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>: j[<span style="color:#e6db74">&#34;date&#34;</span>],
</span></span><span style="display:flex;"><span>                              <span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>: j[<span style="color:#e6db74">&#34;code&#34;</span>]})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>get_da_le_tou_history_data_and_sava2db()
</span></span><span style="display:flex;"><span>get_shuang_se_qiu_history_data_and_sava2db()
</span></span></code></pre></div>
    </div>
  <a href="/post/%E8%8E%B7%E5%8F%96%E5%8E%86%E5%8F%B2%E7%9A%84%E5%A4%A7%E4%B9%90%E9%80%8F%E5%92%8C%E5%8F%8C%E8%89%B2%E7%90%83%E6%95%B0%E6%8D%AE/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E8%B0%B7%E6%AD%8C%E6%90%9C%E7%B4%A2/" class="link blue hover-black">
            Tag: 谷歌搜索
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 11, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E8%B0%B7%E6%AD%8C%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/" class="link black dim">
        谷歌搜索技巧
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p><a href="https://www.google.com.hk/advanced_search">https://www.google.com.hk/advanced_search</a><br>
<a href="https://www.google.com.hk/advanced_image_search">https://www.google.com.hk/advanced_image_search</a></p>
</blockquote>
<h1 id="模糊搜索分词">模糊搜索（分词）</h1>
<p><img src="/images/img_8.png" alt=""></p>
<p>最原始的搜索，本质上是分词后搜索，和模糊搜索比较像</p>
<h1 id="精准搜索">精准搜索</h1>
<p><img src="/images/img_9.png" alt=""></p>
<p>&ldquo;历史知识&rdquo;</p>
<h1 id="排除搜索">排除搜索</h1>
<p><img src="/images/img_10.png" alt="">
&ldquo;历史知识&rdquo; -百度百科</p>
<p><strong>从搜索结果中排除掉包含指定内容</strong></p>
<h1 id="包含指定网站">包含指定网站</h1>
<p><img src="/images/img_11.png" alt="">
&ldquo;历史知识&rdquo; site:books.google.com</p>
<p>PS:可以使用这种格式：site:.gov</p>
<p><strong>从搜索结果中只选择指定网站的结果</strong></p>
<h1 id="指定文件类型">指定文件类型</h1>
<p><img src="/images/img_12.png" alt="">
&ldquo;历史知识&rdquo; filetype:pdf</p>
<p><strong>从搜索结果中只选择指定文件类型的结果</strong></p>
<h1 id="任意内容">任意内容</h1>
<p><img src="/images/img_13.png" alt="">
&ldquo;历史*知识&rdquo;</p>
<p><strong>星号代表匹配任意内容，空也为任意内容</strong></p>
<h1 id="数字范围">数字范围</h1>
<p><img src="/images/img_14.png" alt="">
历史 2013..2016</p>
<p><strong>从搜索结果中只选择数字范围的内容</strong></p>
<h1 id="标题包含">标题包含</h1>
<p><img src="/images/img_15.png" alt="">
intitle: &ldquo;遮天&rdquo; filetype:txt</p>
<p>ps:同理inurl使用方法</p>
<p><strong>只从网页标题中进行数据处理</strong></p>
    </div>
  <a href="/post/%E8%B0%B7%E6%AD%8C%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E7%88%AC%E8%99%AB/" class="link blue hover-black">
            Tag: 爬虫
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 10, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E8%8E%B7%E5%8F%96%E5%8E%86%E5%8F%B2%E7%9A%84%E5%A4%A7%E4%B9%90%E9%80%8F%E5%92%8C%E5%8F%8C%E8%89%B2%E7%90%83%E6%95%B0%E6%8D%AE/" class="link black dim">
        获取历史的大乐透和双色球数据
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="代码">代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> script.utils <span style="color:#f92672">import</span> insert_db_by_api
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_da_le_tou_history_data_and_sava2db</span>():
</span></span><span style="display:flex;"><span>    pageNo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://webapi.sporttery.cn/gateway/lottery/getHistoryPageListV1.qry?gameNo=85&amp;provinceId=0&amp;pageSize=30&amp;isVerify=1&amp;pageNo=</span><span style="color:#e6db74">{</span>pageNo<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>    maxPageNO <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;value&#34;</span>][<span style="color:#e6db74">&#34;pages&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#34;value&#34;</span>][<span style="color:#e6db74">&#34;list&#34;</span>]:
</span></span><span style="display:flex;"><span>        print(i[<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>], i[<span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>], i[<span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>])
</span></span><span style="display:flex;"><span>        insert_db_by_api(<span style="color:#e6db74">&#34;daletous&#34;</span>,
</span></span><span style="display:flex;"><span>                         {<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>: i[<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>], <span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>: i[<span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>],
</span></span><span style="display:flex;"><span>                          <span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>: i[<span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>]})
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>, maxPageNO <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://webapi.sporttery.cn/gateway/lottery/getHistoryPageListV1.qry?gameNo=85&amp;provinceId=0&amp;pageSize=30&amp;isVerify=1&amp;pageNo=</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#34;value&#34;</span>][<span style="color:#e6db74">&#34;list&#34;</span>]:
</span></span><span style="display:flex;"><span>            print(j[<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>], j[<span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>], j[<span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>])
</span></span><span style="display:flex;"><span>            insert_db_by_api(<span style="color:#e6db74">&#34;daletous&#34;</span>,
</span></span><span style="display:flex;"><span>                             {<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>: j[<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>], <span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>: j[<span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>],
</span></span><span style="display:flex;"><span>                              <span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>: j[<span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>]})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_shuang_se_qiu_history_data_and_sava2db</span>():
</span></span><span style="display:flex;"><span>    pageNo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://www.cwl.gov.cn/cwl_admin/front/cwlkj/search/kjxx/findDrawNotice?name=ssq&amp;pageNo=</span><span style="color:#e6db74">{</span>pageNo<span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;pageSize=30&amp;systemType=PC&#34;</span>
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>    maxPageNO <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;pageNum&#34;</span>]
</span></span><span style="display:flex;"><span>    print(maxPageNO)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#34;result&#34;</span>]:
</span></span><span style="display:flex;"><span>        print(i[<span style="color:#e6db74">&#34;red&#34;</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#f92672">+</span> i[<span style="color:#e6db74">&#34;blue&#34;</span>], i[<span style="color:#e6db74">&#34;date&#34;</span>], i[<span style="color:#e6db74">&#34;code&#34;</span>])
</span></span><span style="display:flex;"><span>        insert_db_by_api(<span style="color:#e6db74">&#34;shuangseqius&#34;</span>,
</span></span><span style="display:flex;"><span>                         {<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>: i[<span style="color:#e6db74">&#34;red&#34;</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#f92672">+</span> i[<span style="color:#e6db74">&#34;blue&#34;</span>], <span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>: i[<span style="color:#e6db74">&#34;date&#34;</span>],
</span></span><span style="display:flex;"><span>                          <span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>: i[<span style="color:#e6db74">&#34;code&#34;</span>]})
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>, maxPageNO <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://www.cwl.gov.cn/cwl_admin/front/cwlkj/search/kjxx/findDrawNotice?name=ssq&amp;pageNo=</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;pageSize=30&amp;systemType=PC&#34;</span>
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url)<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> data[<span style="color:#e6db74">&#34;result&#34;</span>]:
</span></span><span style="display:flex;"><span>            print(j[<span style="color:#e6db74">&#34;red&#34;</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#f92672">+</span> j[<span style="color:#e6db74">&#34;blue&#34;</span>], j[<span style="color:#e6db74">&#34;date&#34;</span>], j[<span style="color:#e6db74">&#34;code&#34;</span>])
</span></span><span style="display:flex;"><span>            insert_db_by_api(<span style="color:#e6db74">&#34;shuangseqius&#34;</span>,
</span></span><span style="display:flex;"><span>                             {<span style="color:#e6db74">&#34;lotteryDrawResult&#34;</span>: j[<span style="color:#e6db74">&#34;red&#34;</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#f92672">+</span> j[<span style="color:#e6db74">&#34;blue&#34;</span>], <span style="color:#e6db74">&#34;lotteryDrawTime&#34;</span>: j[<span style="color:#e6db74">&#34;date&#34;</span>],
</span></span><span style="display:flex;"><span>                              <span style="color:#e6db74">&#34;lotteryDrawNum&#34;</span>: j[<span style="color:#e6db74">&#34;code&#34;</span>]})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>get_da_le_tou_history_data_and_sava2db()
</span></span><span style="display:flex;"><span>get_shuang_se_qiu_history_data_and_sava2db()
</span></span></code></pre></div>
    </div>
  <a href="/post/%E8%8E%B7%E5%8F%96%E5%8E%86%E5%8F%B2%E7%9A%84%E5%A4%A7%E4%B9%90%E9%80%8F%E5%92%8C%E5%8F%8C%E8%89%B2%E7%90%83%E6%95%B0%E6%8D%AE/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95/" class="link blue hover-black">
            Tag: 接口测试
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 8, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95/" class="link black dim">
        接口测试
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>接口测试主要测以下5个方面：</p>
<ul>
<li>功能测试</li>
</ul>
<p>输入数据，检查输出数据是否符合预期，以及输入格式和输出格式</p>
<ul>
<li>逻辑测试</li>
</ul>
<p>一些业务逻辑，比如登录后才能进入主页</p>
<ul>
<li>异常测试</li>
</ul>
<p>输入一些不符合预期的数据，比如输入非法字符，输入超长字符，输入空字符等，来检查系统是否能正确处理</p>
<ul>
<li>性能测试</li>
</ul>
<p>响应时间 吞吐量 并发量 资源占用（cpu、内存等）</p>
<ul>
<li>安全性测试</li>
</ul>
<p>敏感信息是否加密 恶意注入 越权访问等</p>
    </div>
  <a href="/post/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/pypi/" class="link blue hover-black">
            Tag: PyPI
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 7, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E5%88%86%E4%BA%AB%E8%87%AA%E5%B7%B1py%E4%BB%A3%E7%A0%81%E5%88%B0pypi/" class="link black dim">
        分享自己py代码到PyPI
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h3 id="准备条件">准备条件</h3>
<p>PyPI的账号</p>
<h3 id="代码格式">代码格式</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>filtered_flask/
</span></span><span style="display:flex;"><span>|-- filtered_flask/
</span></span><span style="display:flex;"><span>|   |-- __init__.py
</span></span><span style="display:flex;"><span>|   |-- app.py
</span></span><span style="display:flex;"><span>|-- tests/
</span></span><span style="display:flex;"><span>|-- setup.py
</span></span><span style="display:flex;"><span>|-- README.md
</span></span><span style="display:flex;"><span>|-- MANIFEST.in
</span></span></code></pre></div><ul>
<li>filtered_flask/app.py</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Flask, Response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> Flask(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 装饰器用于全局信息过滤</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.after_request</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">global_filter</span>(response):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 检查响应内容是否包含 &#34;test&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;test&#39;</span> <span style="color:#f92672">in</span> response<span style="color:#f92672">.</span>data:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 如果包含 &#34;test&#34;，可以采取过滤、修改或其他操作</span>
</span></span><span style="display:flex;"><span>        filtered_content <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;test&#39;</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;filtered&#39;</span>)
</span></span><span style="display:flex;"><span>        response<span style="color:#f92672">.</span>set_data(filtered_content)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 一个简单的路由返回包含 &#34;test&#34; 的内容</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">home</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;This is a test message.&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run(debug<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div><ul>
<li>filtered_flask/<strong>init</strong>.py</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> .app <span style="color:#f92672">import</span> app
</span></span></code></pre></div><ul>
<li>setup.py</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> setuptools <span style="color:#f92672">import</span> setup, find_packages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>setup(
</span></span><span style="display:flex;"><span>name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;filtered_flask&#39;</span>,
</span></span><span style="display:flex;"><span>version<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;0.1.0&#39;</span>,
</span></span><span style="display:flex;"><span>packages<span style="color:#f92672">=</span>find_packages(),
</span></span><span style="display:flex;"><span>install_requires<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;Flask&#39;</span>,
</span></span><span style="display:flex;"><span>],
</span></span><span style="display:flex;"><span>classifiers<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;Programming Language :: Python :: 3&#39;</span>,
</span></span><span style="display:flex;"><span>],
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><ul>
<li>MANIFEST.in</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>include README<span style="color:#f92672">.</span>md
</span></span><span style="display:flex;"><span>recursive<span style="color:#f92672">-</span>include filtered_flask<span style="color:#f92672">/</span>templates <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>recursive<span style="color:#f92672">-</span>include filtered_flask<span style="color:#f92672">/</span>static <span style="color:#f92672">*</span>
</span></span></code></pre></div><ul>
<li>
<p>README.md</p>
    </div>
  <a href="/post/%E5%88%86%E4%BA%AB%E8%87%AA%E5%B7%B1py%E4%BB%A3%E7%A0%81%E5%88%B0pypi/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/flv/" class="link blue hover-black">
            Tag: Flv
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 6, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BD%BF%E7%94%A8srs_flv_js_obs-studio%E5%AE%9E%E7%8E%B0%E7%9B%B4%E6%92%AD/" class="link black dim">
        使用srs_flv_js_obs-studio实现直播
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="srs服务部署">srs服务部署</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker run --rm -it -p 1935:1935 -p 1985:1985 -p 8080:8080 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        -p 8000:8000/udp -p 10080:10080/udp ossrs/srs:5
</span></span></code></pre></div><h1 id="obs-studio推流">obs-studio推流</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>rtmp://qianfuxin.com/live
</span></span><span style="display:flex;"><span>livestream
</span></span></code></pre></div><p><img src="/images/img_6.png" alt=""></p>
<h1 id="flvjs获取流">flv.js获取流</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;FLV Stream Player&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">video</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;videoElement&#34;</span> <span style="color:#a6e22e">controls</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width: 100%; height: auto;&#34;</span>&gt;&lt;/<span style="color:#f92672">video</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/flv.js@1.5.0/dist/flv.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">flvjs</span>.<span style="color:#a6e22e">isSupported</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">videoElement</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;videoElement&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">flvPlayer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">flvjs</span>.<span style="color:#a6e22e">createPlayer</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;flv&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;http://qianfuxin.com:8080/live/livestream.flv &#39;</span>
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">flvPlayer</span>.<span style="color:#a6e22e">attachMediaElement</span>(<span style="color:#a6e22e">videoElement</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">flvPlayer</span>.<span style="color:#a6e22e">load</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">flvPlayer</span>.<span style="color:#a6e22e">play</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div>
    </div>
  <a href="/post/%E4%BD%BF%E7%94%A8srs_flv_js_obs-studio%E5%AE%9E%E7%8E%B0%E7%9B%B4%E6%92%AD/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/obs-studio/" class="link blue hover-black">
            Tag: Obs-Studio
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 6, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BD%BF%E7%94%A8srs_flv_js_obs-studio%E5%AE%9E%E7%8E%B0%E7%9B%B4%E6%92%AD/" class="link black dim">
        使用srs_flv_js_obs-studio实现直播
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="srs服务部署">srs服务部署</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker run --rm -it -p 1935:1935 -p 1985:1985 -p 8080:8080 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        -p 8000:8000/udp -p 10080:10080/udp ossrs/srs:5
</span></span></code></pre></div><h1 id="obs-studio推流">obs-studio推流</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>rtmp://qianfuxin.com/live
</span></span><span style="display:flex;"><span>livestream
</span></span></code></pre></div><p><img src="/images/img_6.png" alt=""></p>
<h1 id="flvjs获取流">flv.js获取流</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;FLV Stream Player&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">video</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;videoElement&#34;</span> <span style="color:#a6e22e">controls</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width: 100%; height: auto;&#34;</span>&gt;&lt;/<span style="color:#f92672">video</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/flv.js@1.5.0/dist/flv.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">flvjs</span>.<span style="color:#a6e22e">isSupported</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">videoElement</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;videoElement&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">flvPlayer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">flvjs</span>.<span style="color:#a6e22e">createPlayer</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;flv&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;http://qianfuxin.com:8080/live/livestream.flv &#39;</span>
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">flvPlayer</span>.<span style="color:#a6e22e">attachMediaElement</span>(<span style="color:#a6e22e">videoElement</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">flvPlayer</span>.<span style="color:#a6e22e">load</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">flvPlayer</span>.<span style="color:#a6e22e">play</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div>
    </div>
  <a href="/post/%E4%BD%BF%E7%94%A8srs_flv_js_obs-studio%E5%AE%9E%E7%8E%B0%E7%9B%B4%E6%92%AD/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/srs/" class="link blue hover-black">
            Tag: Srs
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 6, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BD%BF%E7%94%A8srs_flv_js_obs-studio%E5%AE%9E%E7%8E%B0%E7%9B%B4%E6%92%AD/" class="link black dim">
        使用srs_flv_js_obs-studio实现直播
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="srs服务部署">srs服务部署</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker run --rm -it -p 1935:1935 -p 1985:1985 -p 8080:8080 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        -p 8000:8000/udp -p 10080:10080/udp ossrs/srs:5
</span></span></code></pre></div><h1 id="obs-studio推流">obs-studio推流</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>rtmp://qianfuxin.com/live
</span></span><span style="display:flex;"><span>livestream
</span></span></code></pre></div><p><img src="/images/img_6.png" alt=""></p>
<h1 id="flvjs获取流">flv.js获取流</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;FLV Stream Player&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">video</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;videoElement&#34;</span> <span style="color:#a6e22e">controls</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width: 100%; height: auto;&#34;</span>&gt;&lt;/<span style="color:#f92672">video</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/flv.js@1.5.0/dist/flv.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">flvjs</span>.<span style="color:#a6e22e">isSupported</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">videoElement</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;videoElement&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">flvPlayer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">flvjs</span>.<span style="color:#a6e22e">createPlayer</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;flv&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;http://qianfuxin.com:8080/live/livestream.flv &#39;</span>
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">flvPlayer</span>.<span style="color:#a6e22e">attachMediaElement</span>(<span style="color:#a6e22e">videoElement</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">flvPlayer</span>.<span style="color:#a6e22e">load</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">flvPlayer</span>.<span style="color:#a6e22e">play</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div>
    </div>
  <a href="/post/%E4%BD%BF%E7%94%A8srs_flv_js_obs-studio%E5%AE%9E%E7%8E%B0%E7%9B%B4%E6%92%AD/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/quill_js/" class="link blue hover-black">
            Tag: Quill_js
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 5, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BD%BF%E7%94%A8quill_js%E5%AE%9E%E7%8E%B0%E6%9C%AC%E5%9C%B0%E8%AE%B0%E4%BA%8B%E6%9C%AC/" class="link black dim">
        使用quill_js实现本地记事本
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="代码">代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;铅笔&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">html</span><span style="color:#f92672">,</span> <span style="color:#f92672">body</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">flex</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">flex-direction</span>: <span style="color:#66d9ef">column</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        #editor-container {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">flex</span>: <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 工具栏容器 --&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;toolbar-container&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-header&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1&#34;</span>&gt;&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2&#34;</span>&gt;&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">selected</span>&gt;&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-font&#34;</span>&gt;&lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-bold&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-italic&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-underline&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-strike&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-color&#34;</span>&gt;&lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-background&#34;</span>&gt;&lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-script&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sub&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-script&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;super&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-blockquote&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-code-block&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-list&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ordered&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-list&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bullet&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-indent&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-1&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-indent&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;+1&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-direction&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rtl&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-align&#34;</span>&gt;&lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-link&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-image&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-video&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formula&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-clean&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-save&#34;</span>&gt;save&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 编辑器容器 --&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;editor-container&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 引入Quill的库 --&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css&#34;</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css&#34;</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 初始化Quill编辑器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">quill</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Quill</span>(<span style="color:#e6db74">&#39;#editor-container&#39;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">theme</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;snow&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">modules</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">syntax</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">toolbar</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#toolbar-container&#39;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;输入点什么...&#39;</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 加载保存的内容（如果有）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    window.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">savedContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">getItem</span>(<span style="color:#e6db74">&#39;quillContent&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">savedContent</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">quill</span>.<span style="color:#a6e22e">setContents</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">savedContent</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 保存内容到localStorage的函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">saveContent</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">quill</span>.<span style="color:#a6e22e">getContents</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">setItem</span>(<span style="color:#e6db74">&#39;quillContent&#39;</span>, <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">content</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Content saved!&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 添加保存按钮的点击事件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;.ql-save&#39;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;click&#39;</span>, <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">saveContent</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;Content saved!&#39;</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 每十五秒自动保存一次
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">setInterval</span>(<span style="color:#a6e22e">saveContent</span>, <span style="color:#ae81ff">15000</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p><img src="/images/img_5.png" alt=""></p>
    </div>
  <a href="/post/%E4%BD%BF%E7%94%A8quill_js%E5%AE%9E%E7%8E%B0%E6%9C%AC%E5%9C%B0%E8%AE%B0%E4%BA%8B%E6%9C%AC/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E8%AE%B0%E4%BA%8B%E6%9C%AC/" class="link blue hover-black">
            Tag: 记事本
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 5, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BD%BF%E7%94%A8quill_js%E5%AE%9E%E7%8E%B0%E6%9C%AC%E5%9C%B0%E8%AE%B0%E4%BA%8B%E6%9C%AC/" class="link black dim">
        使用quill_js实现本地记事本
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="代码">代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;铅笔&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">html</span><span style="color:#f92672">,</span> <span style="color:#f92672">body</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">flex</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">flex-direction</span>: <span style="color:#66d9ef">column</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        #editor-container {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">flex</span>: <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 工具栏容器 --&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;toolbar-container&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-header&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1&#34;</span>&gt;&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2&#34;</span>&gt;&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">selected</span>&gt;&lt;/<span style="color:#f92672">option</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-font&#34;</span>&gt;&lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-bold&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-italic&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-underline&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-strike&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-color&#34;</span>&gt;&lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-background&#34;</span>&gt;&lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-script&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sub&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-script&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;super&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-blockquote&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-code-block&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-list&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ordered&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-list&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bullet&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-indent&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-1&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-indent&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;+1&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-direction&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rtl&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-align&#34;</span>&gt;&lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-link&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-image&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-video&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formula&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-clean&#34;</span>&gt;&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-formats&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ql-save&#34;</span>&gt;save&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 编辑器容器 --&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;editor-container&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 引入Quill的库 --&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css&#34;</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css&#34;</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 初始化Quill编辑器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">quill</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Quill</span>(<span style="color:#e6db74">&#39;#editor-container&#39;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">theme</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;snow&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">modules</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">syntax</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">toolbar</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#toolbar-container&#39;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;输入点什么...&#39;</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 加载保存的内容（如果有）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    window.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">savedContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">getItem</span>(<span style="color:#e6db74">&#39;quillContent&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">savedContent</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">quill</span>.<span style="color:#a6e22e">setContents</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">savedContent</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 保存内容到localStorage的函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">saveContent</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">quill</span>.<span style="color:#a6e22e">getContents</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">setItem</span>(<span style="color:#e6db74">&#39;quillContent&#39;</span>, <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">content</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Content saved!&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 添加保存按钮的点击事件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;.ql-save&#39;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;click&#39;</span>, <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">saveContent</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;Content saved!&#39;</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 每十五秒自动保存一次
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">setInterval</span>(<span style="color:#a6e22e">saveContent</span>, <span style="color:#ae81ff">15000</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p><img src="/images/img_5.png" alt=""></p>
    </div>
  <a href="/post/%E4%BD%BF%E7%94%A8quill_js%E5%AE%9E%E7%8E%B0%E6%9C%AC%E5%9C%B0%E8%AE%B0%E4%BA%8B%E6%9C%AC/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/electron/" class="link blue hover-black">
            Tag: Electron
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 4, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BD%BF%E7%94%A8electron%E5%BC%80%E5%8F%91%E7%AA%97%E4%BD%93%E5%B9%B6%E6%89%93%E5%8C%85/" class="link black dim">
        使用electron开发窗体并打包
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 id="环境准备">环境准备</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#设置代理</span>
</span></span><span style="display:flex;"><span>set ELECTRON_GET_USE_PROXY<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>set GLOBAL_AGENT_HTTP_PROXY<span style="color:#f92672">=</span>http://proxy.example.com:7890
</span></span><span style="display:flex;"><span>set GLOBAL_AGENT_HTTPS_PROXY<span style="color:#f92672">=</span>https://proxy.example.com:7890
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Clone this repository</span>
</span></span><span style="display:flex;"><span>git clone https://github.com/electron/electron-quick-start
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Go into the repository</span>
</span></span><span style="display:flex;"><span>cd electron-quick-start
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install dependencies</span>
</span></span><span style="display:flex;"><span>npm install
</span></span></code></pre></div><h1 id="可能会卡住探究一下为什么">可能会卡住（探究一下为什么）</h1>
<pre><code>`npm install --save-dev @electron-forge/cli`
</code></pre>
<h2 id="运行">运行</h2>
<pre><code>`npm start`
</code></pre>
<h2 id="打包">打包</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>npx electron-forge import
</span></span><span style="display:flex;"><span>npm run make
</span></span></code></pre></div>
    </div>
  <a href="/post/%E4%BD%BF%E7%94%A8electron%E5%BC%80%E5%8F%91%E7%AA%97%E4%BD%93%E5%B9%B6%E6%89%93%E5%8C%85/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E5%AE%9A%E6%97%B6/" class="link blue hover-black">
            Tag: 定时
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 3, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E4%BD%BF%E7%94%A8airflow%E5%AE%9A%E4%B9%89%E4%BB%BB%E5%8A%A1/" class="link black dim">
        使用airflow定义任务
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装">安装</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 默认值</span>
</span></span><span style="display:flex;"><span>export AIRFLOW_HOME<span style="color:#f92672">=</span>~/airflow
</span></span><span style="display:flex;"><span>AIRFLOW_VERSION<span style="color:#f92672">=</span>2.9.3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Extract the version of Python you have installed. If you&#39;re currently using a Python version that is not supported by Airflow, you may want to set this manually.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># See above for supported versions.</span>
</span></span><span style="display:flex;"><span>PYTHON_VERSION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>python -c <span style="color:#e6db74">&#39;import sys; print(f&#34;{sys.version_info.major}.{sys.version_info.minor}&#34;)&#39;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CONSTRAINT_URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://raw.githubusercontent.com/apache/airflow/constraints-</span><span style="color:#e6db74">${</span>AIRFLOW_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">/constraints-</span><span style="color:#e6db74">${</span>PYTHON_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">.txt&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># For example this would install 2.9.3 with python 3.8: https://raw.githubusercontent.com/apache/airflow/constraints-2.9.3/constraints-3.8.txt</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pip install <span style="color:#e6db74">&#34;apache-airflow==</span><span style="color:#e6db74">${</span>AIRFLOW_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> --constraint <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CONSTRAINT_URL<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 开启</span>
</span></span><span style="display:flex;"><span>airflow standalone
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 初始账户为admin 密码为standalone_admin_password.txt</span>
</span></span></code></pre></div><h1 id="创建任务">创建任务</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir dags
</span></span><span style="display:flex;"><span>cd dags
</span></span><span style="display:flex;"><span>vim my_task.py
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> textwrap
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The DAG object; we&#39;ll need this to instantiate a DAG</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> airflow.models.dag <span style="color:#f92672">import</span> DAG
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Operators; we need this to operate!</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> airflow.operators.bash <span style="color:#f92672">import</span> BashOperator
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> DAG(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;tutorial&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># These args will get passed on to each operator</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># You can override them on a per-task basis during operator initialization</span>
</span></span><span style="display:flex;"><span>    default_args<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;depends_on_past&#34;</span>: <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;email&#34;</span>: [<span style="color:#e6db74">&#34;airflow@example.com&#34;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;email_on_failure&#34;</span>: <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;email_on_retry&#34;</span>: <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;retries&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;retry_delay&#34;</span>: timedelta(minutes<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;queue&#39;: &#39;bash_queue&#39;,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;pool&#39;: &#39;backfill&#39;,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;priority_weight&#39;: 10,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;end_date&#39;: datetime(2016, 1, 1),</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;wait_for_downstream&#39;: False,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;sla&#39;: timedelta(hours=2),</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;execution_timeout&#39;: timedelta(seconds=300),</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;on_failure_callback&#39;: some_function, # or list of functions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;on_success_callback&#39;: some_other_function, # or list of functions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;on_retry_callback&#39;: another_function, # or list of functions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;sla_miss_callback&#39;: yet_another_function, # or list of functions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;on_skipped_callback&#39;: another_function, #or list of functions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># &#39;trigger_rule&#39;: &#39;all_success&#39;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;A simple tutorial DAG&#34;</span>,
</span></span><span style="display:flex;"><span>    schedule<span style="color:#f92672">=</span>timedelta(days<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    start_date<span style="color:#f92672">=</span>datetime(<span style="color:#ae81ff">2021</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    catchup<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    tags<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;example&#34;</span>],
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">as</span> dag:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># t1, t2 and t3 are examples of tasks created by instantiating operators</span>
</span></span><span style="display:flex;"><span>    t1 <span style="color:#f92672">=</span> BashOperator(
</span></span><span style="display:flex;"><span>        task_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;print_date&#34;</span>,
</span></span><span style="display:flex;"><span>        bash_command<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;date&#34;</span>,
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    t2 <span style="color:#f92672">=</span> BashOperator(
</span></span><span style="display:flex;"><span>        task_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sleep&#34;</span>,
</span></span><span style="display:flex;"><span>        depends_on_past<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        bash_command<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sleep 5&#34;</span>,
</span></span><span style="display:flex;"><span>        retries<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    t1<span style="color:#f92672">.</span>doc_md <span style="color:#f92672">=</span> textwrap<span style="color:#f92672">.</span>dedent(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">    #### Task Documentation
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    You can document your task using the attributes `doc_md` (markdown),
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    `doc` (plain text), `doc_rst`, `doc_json`, `doc_yaml` which gets
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    rendered in the UI&#39;s Task Instance Details page.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ![img](https://imgs.xkcd.com/comics/fixing_problems.png)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    **Image Credit:** Randall Munroe, [XKCD](https://xkcd.com/license.html)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dag<span style="color:#f92672">.</span>doc_md <span style="color:#f92672">=</span> __doc__  <span style="color:#75715e"># providing that you have a docstring at the beginning of the DAG; OR</span>
</span></span><span style="display:flex;"><span>    dag<span style="color:#f92672">.</span>doc_md <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    This is a documentation placed anywhere
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>  <span style="color:#75715e"># otherwise, type it like this</span>
</span></span><span style="display:flex;"><span>    templated_command <span style="color:#f92672">=</span> textwrap<span style="color:#f92672">.</span>dedent(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {</span><span style="color:#e6db74">% f</span><span style="color:#e6db74">or i in range(5) %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo &#34;{{ ds }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo &#34;{{ macros.ds_add(ds, 7)}}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {</span><span style="color:#e6db74">% e</span><span style="color:#e6db74">ndfor %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    t3 <span style="color:#f92672">=</span> BashOperator(
</span></span><span style="display:flex;"><span>        task_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;templated&#34;</span>,
</span></span><span style="display:flex;"><span>        depends_on_past<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        bash_command<span style="color:#f92672">=</span>templated_command,
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    t1 <span style="color:#f92672">&gt;&gt;</span> [t2, t3]
</span></span></code></pre></div>
    </div>
  <a href="/post/%E4%BD%BF%E7%94%A8airflow%E5%AE%9A%E4%B9%89%E4%BB%BB%E5%8A%A1/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/go/" class="link blue hover-black">
            Tag: Go
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 2, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/windows%E9%85%8D%E7%BD%AEgo/" class="link black dim">
        windows配置go
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装">安装</h1>
<p><a href="https://go.dev/dl/">官网</a></p>
<h1 id="环境变量">环境变量</h1>
<p>已默认配置好</p>
<ul>
<li>
<p>默认的gopath是用户账户下的go文件夹</p>
</li>
<li>
<p>默认的goroot是安装的位置</p>
</li>
</ul>
<h1 id="goland开启demo">goland开启demo</h1>
<ul>
<li>
<p>新建go项目</p>
</li>
<li>
<p>安装包</p>
<p><code>go get -u github.com/gin-gonic/gin</code></p>
</li>
<li>
<p>新建main.go</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">r</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/ping&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">JSON</span>(<span style="color:#ae81ff">200</span>, <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">H</span>{
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;hello world&#34;</span>,
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Run</span>() <span style="color:#75715e">//listen and serve on 0.0.0.0:8080</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>运行</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#运行</span>
</span></span><span style="display:flex;"><span>go run main.go
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打包（在gopath的bin目录中，比如C:\Users\username\go\bin）</span>
</span></span><span style="display:flex;"><span>go install
</span></span></code></pre></div>
    </div>
  <a href="/post/windows%E9%85%8D%E7%BD%AEgo/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/windows/" class="link blue hover-black">
            Tag: Windows
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 2, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/windows%E9%85%8D%E7%BD%AEgo/" class="link black dim">
        windows配置go
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装">安装</h1>
<p><a href="https://go.dev/dl/">官网</a></p>
<h1 id="环境变量">环境变量</h1>
<p>已默认配置好</p>
<ul>
<li>
<p>默认的gopath是用户账户下的go文件夹</p>
</li>
<li>
<p>默认的goroot是安装的位置</p>
</li>
</ul>
<h1 id="goland开启demo">goland开启demo</h1>
<ul>
<li>
<p>新建go项目</p>
</li>
<li>
<p>安装包</p>
<p><code>go get -u github.com/gin-gonic/gin</code></p>
</li>
<li>
<p>新建main.go</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">r</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/ping&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">JSON</span>(<span style="color:#ae81ff">200</span>, <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">H</span>{
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;hello world&#34;</span>,
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Run</span>() <span style="color:#75715e">//listen and serve on 0.0.0.0:8080</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>运行</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#运行</span>
</span></span><span style="display:flex;"><span>go run main.go
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打包（在gopath的bin目录中，比如C:\Users\username\go\bin）</span>
</span></span><span style="display:flex;"><span>go install
</span></span></code></pre></div>
    </div>
  <a href="/post/windows%E9%85%8D%E7%BD%AEgo/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/exe/" class="link blue hover-black">
            Tag: Exe
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 1, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/web%E5%90%AF%E5%8A%A8%E6%9C%AC%E5%9C%B0exe/" class="link black dim">
        web启动本地exe
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="生成注册表文件shellbat">生成注册表文件（shell.bat）</h1>
<p><strong>注意：exe文件需要和shell.bat在同一目录下，且不要轻易更换exe的路径和名称。</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmd" data-lang="cmd"><span style="display:flex;"><span>@<span style="color:#66d9ef">echo</span> off
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">setlocal</span> enabledelayedexpansion
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:<span style="color:#75715e">: 获取当前路径</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#e6db74">&#34;current_path=</span>%~dp0<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:<span style="color:#75715e">: 设置文件名</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#e6db74">&#34;exe_name=exe_name.exe&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#e6db74">&#34;exe_path=</span>%current_path%%exe_name%<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:<span style="color:#75715e">: 确保路径中不含特殊字符，并处理反斜杠</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#e6db74">&#34;escaped_path=</span>%exe_path:\=\\%<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:<span style="color:#75715e">: 创建注册表文件内容</span>
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> Windows Registry Editor Version 5.00
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;audioRecord&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;URL Protocol&#34;</span>=<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx\DefaultIcon]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;</span>!escaped_path!<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx\shell]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx\shell\open]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx\shell\open\command]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;\&#34;</span>!escaped_path!\<span style="color:#e6db74">&#34; \&#34;</span><span style="color:#ae81ff">%%</span>1\<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>) &gt; register.reg
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;OK!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">pause</span>
</span></span></code></pre></div><h1 id="使用">使用</h1>
<p><strong>双击shell.bat生成register.reg，双击register.reg即可完成注册</strong> 。</p>
<p><strong>使用下列代码即可 <em>唤醒本地</em> exe</strong>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;qfx:&#34;</span>&gt;打开程序&lt;/<span style="color:#f92672">a</span>&gt;
</span></span></code></pre></div>
    </div>
  <a href="/post/web%E5%90%AF%E5%8A%A8%E6%9C%AC%E5%9C%B0exe/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/web/" class="link blue hover-black">
            Tag: Web
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 1, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/web%E5%90%AF%E5%8A%A8%E6%9C%AC%E5%9C%B0exe/" class="link black dim">
        web启动本地exe
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="生成注册表文件shellbat">生成注册表文件（shell.bat）</h1>
<p><strong>注意：exe文件需要和shell.bat在同一目录下，且不要轻易更换exe的路径和名称。</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmd" data-lang="cmd"><span style="display:flex;"><span>@<span style="color:#66d9ef">echo</span> off
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">setlocal</span> enabledelayedexpansion
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:<span style="color:#75715e">: 获取当前路径</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#e6db74">&#34;current_path=</span>%~dp0<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:<span style="color:#75715e">: 设置文件名</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#e6db74">&#34;exe_name=exe_name.exe&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#e6db74">&#34;exe_path=</span>%current_path%%exe_name%<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:<span style="color:#75715e">: 确保路径中不含特殊字符，并处理反斜杠</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#e6db74">&#34;escaped_path=</span>%exe_path:\=\\%<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:<span style="color:#75715e">: 创建注册表文件内容</span>
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> Windows Registry Editor Version 5.00
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;audioRecord&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;URL Protocol&#34;</span>=<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx\DefaultIcon]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;</span>!escaped_path!<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx\shell]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx\shell\open]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx\shell\open\command]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;\&#34;</span>!escaped_path!\<span style="color:#e6db74">&#34; \&#34;</span><span style="color:#ae81ff">%%</span>1\<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>) &gt; register.reg
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;OK!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">pause</span>
</span></span></code></pre></div><h1 id="使用">使用</h1>
<p><strong>双击shell.bat生成register.reg，双击register.reg即可完成注册</strong> 。</p>
<p><strong>使用下列代码即可 <em>唤醒本地</em> exe</strong>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;qfx:&#34;</span>&gt;打开程序&lt;/<span style="color:#f92672">a</span>&gt;
</span></span></code></pre></div>
    </div>
  <a href="/post/web%E5%90%AF%E5%8A%A8%E6%9C%AC%E5%9C%B0exe/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E6%B3%A8%E5%86%8C%E8%A1%A8/" class="link blue hover-black">
            Tag: 注册表
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        十月 1, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/web%E5%90%AF%E5%8A%A8%E6%9C%AC%E5%9C%B0exe/" class="link black dim">
        web启动本地exe
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="生成注册表文件shellbat">生成注册表文件（shell.bat）</h1>
<p><strong>注意：exe文件需要和shell.bat在同一目录下，且不要轻易更换exe的路径和名称。</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmd" data-lang="cmd"><span style="display:flex;"><span>@<span style="color:#66d9ef">echo</span> off
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">setlocal</span> enabledelayedexpansion
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:<span style="color:#75715e">: 获取当前路径</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#e6db74">&#34;current_path=</span>%~dp0<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:<span style="color:#75715e">: 设置文件名</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#e6db74">&#34;exe_name=exe_name.exe&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#e6db74">&#34;exe_path=</span>%current_path%%exe_name%<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:<span style="color:#75715e">: 确保路径中不含特殊字符，并处理反斜杠</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">set</span> <span style="color:#e6db74">&#34;escaped_path=</span>%exe_path:\=\\%<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:<span style="color:#75715e">: 创建注册表文件内容</span>
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> Windows Registry Editor Version 5.00
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;audioRecord&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;URL Protocol&#34;</span>=<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx\DefaultIcon]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;</span>!escaped_path!<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx\shell]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx\shell\open]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> [HKEY_CLASSES_ROOT\qfx\shell\open\command]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> @=<span style="color:#e6db74">&#34;\&#34;</span>!escaped_path!\<span style="color:#e6db74">&#34; \&#34;</span><span style="color:#ae81ff">%%</span>1\<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>) &gt; register.reg
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;OK!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">pause</span>
</span></span></code></pre></div><h1 id="使用">使用</h1>
<p><strong>双击shell.bat生成register.reg，双击register.reg即可完成注册</strong> 。</p>
<p><strong>使用下列代码即可 <em>唤醒本地</em> exe</strong>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;qfx:&#34;</span>&gt;打开程序&lt;/<span style="color:#f92672">a</span>&gt;
</span></span></code></pre></div>
    </div>
  <a href="/post/web%E5%90%AF%E5%8A%A8%E6%9C%AC%E5%9C%B0exe/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/nvidia/" class="link blue hover-black">
            Tag: NVIDIA
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 29, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/ubuntu%E9%85%8D%E7%BD%AEdocker%E5%92%8Cnvidia_%E5%AE%9E%E7%8E%B0%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E6%98%BE%E5%8D%A1%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="link black dim">
        Ubuntu配置docker和NVIDIA_实现容器使用显卡深度学习
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p>Ubuntu 20.04.6 LTS</p>
</blockquote>
<ul>
<li>
<p>安装英伟达驱动
<img src="/images/img_3.png" alt=""></p>
</li>
<li>
<p>安装docker</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 安装前准备</span>
</span></span><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install vim git g++ ssh curl -y
</span></span><span style="display:flex;"><span>sudo apt remove docker docker-engine docker.io containerd runc -y
</span></span><span style="display:flex;"><span>sudo apt install <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>apt-transport-https <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>ca-certificates <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>gnupg <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>lsb-release -y
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加GPG密钥</span>
</span></span><span style="display:flex;"><span>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
</span></span><span style="display:flex;"><span>sudo add-apt-repository <span style="color:#e6db74">&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span style="color:#66d9ef">$(</span>lsb_release -cs<span style="color:#66d9ef">)</span><span style="color:#e6db74"> stable&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装</span>
</span></span><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install docker-ce docker-ce-cli containerd.io -y
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加配置</span>
</span></span><span style="display:flex;"><span>sudo mkdir -p /etc/docker
</span></span><span style="display:flex;"><span>sudo mkdir -p /home/docker
</span></span><span style="display:flex;"><span>sudo tee /etc/docker/daemon.json <span style="color:#e6db74">&lt;&lt;-&#39;EOF&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;registry-mirrors&#34;: [&#34;https://gjuibr2v.mirror.aliyuncs.com&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装NVIDIA容器包，支持GPU训练</span>
</span></span><span style="display:flex;"><span>curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>sudo apt-key add -
</span></span><span style="display:flex;"><span>distribution<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>. /etc/os-release;echo $ID$VERSION_ID<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>sudo tee /etc/apt/sources.list.d/nvidia-docker.list
</span></span><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>sudo apt install -y nvidia-container-toolkit
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启动docker</span>
</span></span><span style="display:flex;"><span>sudo systemctl restart docker
</span></span><span style="display:flex;"><span>sudo systemctl daemon-reload
</span></span><span style="display:flex;"><span>sudo systemctl enable --now docker
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 测试docker是否安装成功</span>
</span></span><span style="display:flex;"><span>docker run hello-world <span style="color:#75715e"># 成功则输出&#34;hello-world&#34;</span>
</span></span></code></pre></div><ul>
<li>安装cuda</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda_11.8.0_520.61.05_linux.run
</span></span><span style="display:flex;"><span>sudo sh cuda_11.8.0_520.61.05_linux.run
</span></span></code></pre></div><p><img src="/images/img_4.png" alt=""></p>
    </div>
  <a href="/post/ubuntu%E9%85%8D%E7%BD%AEdocker%E5%92%8Cnvidia_%E5%AE%9E%E7%8E%B0%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E6%98%BE%E5%8D%A1%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/ubuntu/" class="link blue hover-black">
            Tag: Ubuntu
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 29, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/ubuntu%E9%85%8D%E7%BD%AEdocker%E5%92%8Cnvidia_%E5%AE%9E%E7%8E%B0%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E6%98%BE%E5%8D%A1%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="link black dim">
        Ubuntu配置docker和NVIDIA_实现容器使用显卡深度学习
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p>Ubuntu 20.04.6 LTS</p>
</blockquote>
<ul>
<li>
<p>安装英伟达驱动
<img src="/images/img_3.png" alt=""></p>
</li>
<li>
<p>安装docker</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 安装前准备</span>
</span></span><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install vim git g++ ssh curl -y
</span></span><span style="display:flex;"><span>sudo apt remove docker docker-engine docker.io containerd runc -y
</span></span><span style="display:flex;"><span>sudo apt install <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>apt-transport-https <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>ca-certificates <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>gnupg <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>lsb-release -y
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加GPG密钥</span>
</span></span><span style="display:flex;"><span>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
</span></span><span style="display:flex;"><span>sudo add-apt-repository <span style="color:#e6db74">&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span style="color:#66d9ef">$(</span>lsb_release -cs<span style="color:#66d9ef">)</span><span style="color:#e6db74"> stable&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装</span>
</span></span><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install docker-ce docker-ce-cli containerd.io -y
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加配置</span>
</span></span><span style="display:flex;"><span>sudo mkdir -p /etc/docker
</span></span><span style="display:flex;"><span>sudo mkdir -p /home/docker
</span></span><span style="display:flex;"><span>sudo tee /etc/docker/daemon.json <span style="color:#e6db74">&lt;&lt;-&#39;EOF&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;registry-mirrors&#34;: [&#34;https://gjuibr2v.mirror.aliyuncs.com&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装NVIDIA容器包，支持GPU训练</span>
</span></span><span style="display:flex;"><span>curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>sudo apt-key add -
</span></span><span style="display:flex;"><span>distribution<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>. /etc/os-release;echo $ID$VERSION_ID<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>sudo tee /etc/apt/sources.list.d/nvidia-docker.list
</span></span><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>sudo apt install -y nvidia-container-toolkit
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启动docker</span>
</span></span><span style="display:flex;"><span>sudo systemctl restart docker
</span></span><span style="display:flex;"><span>sudo systemctl daemon-reload
</span></span><span style="display:flex;"><span>sudo systemctl enable --now docker
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 测试docker是否安装成功</span>
</span></span><span style="display:flex;"><span>docker run hello-world <span style="color:#75715e"># 成功则输出&#34;hello-world&#34;</span>
</span></span></code></pre></div><ul>
<li>安装cuda</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda_11.8.0_520.61.05_linux.run
</span></span><span style="display:flex;"><span>sudo sh cuda_11.8.0_520.61.05_linux.run
</span></span></code></pre></div><p><img src="/images/img_4.png" alt=""></p>
    </div>
  <a href="/post/ubuntu%E9%85%8D%E7%BD%AEdocker%E5%92%8Cnvidia_%E5%AE%9E%E7%8E%B0%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E6%98%BE%E5%8D%A1%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="link blue hover-black">
            Tag: 深度学习
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 29, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/ubuntu%E9%85%8D%E7%BD%AEdocker%E5%92%8Cnvidia_%E5%AE%9E%E7%8E%B0%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E6%98%BE%E5%8D%A1%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="link black dim">
        Ubuntu配置docker和NVIDIA_实现容器使用显卡深度学习
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <blockquote>
<p>Ubuntu 20.04.6 LTS</p>
</blockquote>
<ul>
<li>
<p>安装英伟达驱动
<img src="/images/img_3.png" alt=""></p>
</li>
<li>
<p>安装docker</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 安装前准备</span>
</span></span><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install vim git g++ ssh curl -y
</span></span><span style="display:flex;"><span>sudo apt remove docker docker-engine docker.io containerd runc -y
</span></span><span style="display:flex;"><span>sudo apt install <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>apt-transport-https <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>ca-certificates <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>gnupg <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>lsb-release -y
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加GPG密钥</span>
</span></span><span style="display:flex;"><span>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
</span></span><span style="display:flex;"><span>sudo add-apt-repository <span style="color:#e6db74">&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span style="color:#66d9ef">$(</span>lsb_release -cs<span style="color:#66d9ef">)</span><span style="color:#e6db74"> stable&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装</span>
</span></span><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install docker-ce docker-ce-cli containerd.io -y
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加配置</span>
</span></span><span style="display:flex;"><span>sudo mkdir -p /etc/docker
</span></span><span style="display:flex;"><span>sudo mkdir -p /home/docker
</span></span><span style="display:flex;"><span>sudo tee /etc/docker/daemon.json <span style="color:#e6db74">&lt;&lt;-&#39;EOF&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;registry-mirrors&#34;: [&#34;https://gjuibr2v.mirror.aliyuncs.com&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装NVIDIA容器包，支持GPU训练</span>
</span></span><span style="display:flex;"><span>curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>sudo apt-key add -
</span></span><span style="display:flex;"><span>distribution<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>. /etc/os-release;echo $ID$VERSION_ID<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>sudo tee /etc/apt/sources.list.d/nvidia-docker.list
</span></span><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>sudo apt install -y nvidia-container-toolkit
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启动docker</span>
</span></span><span style="display:flex;"><span>sudo systemctl restart docker
</span></span><span style="display:flex;"><span>sudo systemctl daemon-reload
</span></span><span style="display:flex;"><span>sudo systemctl enable --now docker
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 测试docker是否安装成功</span>
</span></span><span style="display:flex;"><span>docker run hello-world <span style="color:#75715e"># 成功则输出&#34;hello-world&#34;</span>
</span></span></code></pre></div><ul>
<li>安装cuda</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda_11.8.0_520.61.05_linux.run
</span></span><span style="display:flex;"><span>sudo sh cuda_11.8.0_520.61.05_linux.run
</span></span></code></pre></div><p><img src="/images/img_4.png" alt=""></p>
    </div>
  <a href="/post/ubuntu%E9%85%8D%E7%BD%AEdocker%E5%92%8Cnvidia_%E5%AE%9E%E7%8E%B0%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E6%98%BE%E5%8D%A1%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/transformer/" class="link blue hover-black">
            Tag: Transformer
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 28, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/transformer%E5%BE%AE%E8%B0%83%E5%8F%8A%E5%90%8E%E7%BB%AD%E6%8E%A8%E7%90%86/" class="link black dim">
        transformer微调及后续推理
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="微调">微调</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> AutoModelForSequenceClassification
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>device <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>device(<span style="color:#e6db74">&#34;mps&#34;</span>)
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> AutoModelForSequenceClassification<span style="color:#f92672">.</span>from_pretrained(<span style="color:#e6db74">&#34;distilbert/distilbert-base-uncased&#34;</span>)<span style="color:#f92672">.</span>to(device)
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> TrainingArguments
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>training_args <span style="color:#f92672">=</span> TrainingArguments(
</span></span><span style="display:flex;"><span>    output_dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;path/to/save/folder/&#34;</span>,
</span></span><span style="display:flex;"><span>    learning_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">2e-5</span>,
</span></span><span style="display:flex;"><span>    per_device_train_batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>    per_device_eval_batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>    num_train_epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> AutoTokenizer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tokenizer <span style="color:#f92672">=</span> AutoTokenizer<span style="color:#f92672">.</span>from_pretrained(<span style="color:#e6db74">&#34;distilbert/distilbert-base-uncased&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datasets <span style="color:#f92672">import</span> load_dataset
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset <span style="color:#f92672">=</span> load_dataset(<span style="color:#e6db74">&#34;rotten_tomatoes&#34;</span>)  <span style="color:#75715e"># doctest: +IGNORE_RESULT</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tokenize_dataset</span>(dataset):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> tokenizer(dataset[<span style="color:#e6db74">&#34;text&#34;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dataset <span style="color:#f92672">=</span> dataset<span style="color:#f92672">.</span>map(tokenize_dataset, batched<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> DataCollatorWithPadding
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data_collator <span style="color:#f92672">=</span> DataCollatorWithPadding(tokenizer<span style="color:#f92672">=</span>tokenizer)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> Trainer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>trainer <span style="color:#f92672">=</span> Trainer(
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">=</span>model,
</span></span><span style="display:flex;"><span>    args<span style="color:#f92672">=</span>training_args,
</span></span><span style="display:flex;"><span>    train_dataset<span style="color:#f92672">=</span>dataset[<span style="color:#e6db74">&#34;train&#34;</span>]<span style="color:#f92672">.</span>with_format(<span style="color:#e6db74">&#34;torch&#34;</span>, device<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mps&#34;</span>),
</span></span><span style="display:flex;"><span>    eval_dataset<span style="color:#f92672">=</span>dataset[<span style="color:#e6db74">&#34;test&#34;</span>]<span style="color:#f92672">.</span>with_format(<span style="color:#e6db74">&#34;torch&#34;</span>, device<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mps&#34;</span>),
</span></span><span style="display:flex;"><span>    tokenizer<span style="color:#f92672">=</span>tokenizer,
</span></span><span style="display:flex;"><span>    data_collator<span style="color:#f92672">=</span>data_collator,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>trainer<span style="color:#f92672">.</span>train()
</span></span><span style="display:flex;"><span>trainer<span style="color:#f92672">.</span>save_model(<span style="color:#e6db74">&#34;path/to/save/folder&#34;</span>)
</span></span></code></pre></div><h1 id="使用微调模型推理">使用微调模型推理</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> pipeline
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>device <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>device(<span style="color:#e6db74">&#34;mps&#34;</span>) <span style="color:#66d9ef">if</span> torch<span style="color:#f92672">.</span>backends<span style="color:#f92672">.</span>mps<span style="color:#f92672">.</span>is_available() <span style="color:#66d9ef">else</span> torch<span style="color:#f92672">.</span>device(<span style="color:#e6db74">&#34;cpu&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pipe <span style="color:#f92672">=</span> pipeline(<span style="color:#e6db74">&#34;fill-mask&#34;</span>, model<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;path/to/save/folder&#34;</span>, device<span style="color:#f92672">=</span>device)
</span></span><span style="display:flex;"><span>print(pipe(<span style="color:#e6db74">&#34;The goal of life is [MASK].&#34;</span>))
</span></span></code></pre></div>
    </div>
  <a href="/post/transformer%E5%BE%AE%E8%B0%83%E5%8F%8A%E5%90%8E%E7%BB%AD%E6%8E%A8%E7%90%86/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/sqlalchemy/" class="link blue hover-black">
            Tag: Sqlalchemy
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 27, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/str-api%E5%B8%B8%E7%94%A8%E6%8E%A5%E5%8F%A3/" class="link black dim">
        str-api常用接口
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="文件操作可以和其他表集成">文件操作（可以和其他表集成）</h1>
<p><img src="/images/img_2.png" alt=""></p>
<p><img src="/images/img_1.png" alt=""></p>
<h1 id="登录注册">登录注册</h1>
<p><img src="/images/img.png" alt=""></p>
    </div>
  <a href="/post/str-api%E5%B8%B8%E7%94%A8%E6%8E%A5%E5%8F%A3/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 26, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/sqlalchemy%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/" class="link black dim">
        sqlalchemy操作数据库
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="代码">代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sqlalchemy <span style="color:#f92672">import</span> create_engine, text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DB_URI <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mysql+pymysql://</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">@</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(
</span></span><span style="display:flex;"><span>    USERNAME, PASSWORD, HOSTNAME, POST, DATABASE
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># SQLAlchemy 2.0.23</span>
</span></span><span style="display:flex;"><span>    db_engine <span style="color:#f92672">=</span> create_engine(DB_URI)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> db_engine<span style="color:#f92672">.</span>connect() <span style="color:#66d9ef">as</span> conn:
</span></span><span style="display:flex;"><span>        sql_query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT * FROM some_table WHERE id=:id&#34;</span>
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> conn<span style="color:#f92672">.</span>execute(text(sql_query), {<span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#ae81ff">1</span>})
</span></span><span style="display:flex;"><span>        print(result<span style="color:#f92672">.</span>all())
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;完成&#34;</span>, result<span style="color:#f92672">.</span>rowcount, <span style="color:#e6db74">&#34;行被更新。&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 如果是更新等语句要提交</span>
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>commit()
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">5</span>)
</span></span></code></pre></div>
    </div>
  <a href="/post/sqlalchemy%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/strapi/" class="link blue hover-black">
            Tag: StrApi
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 27, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/str-api%E5%B8%B8%E7%94%A8%E6%8E%A5%E5%8F%A3/" class="link black dim">
        str-api常用接口
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="文件操作可以和其他表集成">文件操作（可以和其他表集成）</h1>
<p><img src="/images/img_2.png" alt=""></p>
<p><img src="/images/img_1.png" alt=""></p>
<h1 id="登录注册">登录注册</h1>
<p><img src="/images/img.png" alt=""></p>
    </div>
  <a href="/post/str-api%E5%B8%B8%E7%94%A8%E6%8E%A5%E5%8F%A3/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/rabbitmq/" class="link blue hover-black">
            Tag: RabbitMQ
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 25, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/rabbitmq%E7%9A%84%E9%85%8D%E7%BD%AE%E5%8F%8Apython%E8%B0%83%E7%94%A8/" class="link black dim">
        rabbitMQ的配置及python调用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="配置rabbitmq">配置rabbitMQ</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>version: <span style="color:#e6db74">&#39;3.8&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>services:
</span></span><span style="display:flex;"><span>  rabbitmq:
</span></span><span style="display:flex;"><span>    image: rabbitmq:3-management
</span></span><span style="display:flex;"><span>    container_name: rabbitmq
</span></span><span style="display:flex;"><span>    ports:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;5672:5672&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;15672:15672&#34;</span>
</span></span><span style="display:flex;"><span>    environment:
</span></span><span style="display:flex;"><span>      RABBITMQ_DEFAULT_USER: user
</span></span><span style="display:flex;"><span>      RABBITMQ_DEFAULT_PASS: password
</span></span><span style="display:flex;"><span>    volumes:
</span></span><span style="display:flex;"><span>      - /dc/rabbitmq:/var/lib/rabbitmq
</span></span></code></pre></div><h1 id="生产者">生产者</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pika
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>connection <span style="color:#f92672">=</span> pika<span style="color:#f92672">.</span>BlockingConnection(
</span></span><span style="display:flex;"><span>    pika<span style="color:#f92672">.</span>ConnectionParameters(<span style="color:#e6db74">&#39;localhost&#39;</span>, <span style="color:#ae81ff">5672</span>, <span style="color:#e6db74">&#39;/&#39;</span>, pika<span style="color:#f92672">.</span>PlainCredentials(<span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#e6db74">&#39;password&#39;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>channel <span style="color:#f92672">=</span> connection<span style="color:#f92672">.</span>channel()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>channel<span style="color:#f92672">.</span>queue_declare(queue<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;log_queue&#39;</span>, durable<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>    message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello World1&#34;</span>
</span></span><span style="display:flex;"><span>    channel<span style="color:#f92672">.</span>basic_publish(
</span></span><span style="display:flex;"><span>        exchange<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>        routing_key<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;log_queue&#39;</span>,
</span></span><span style="display:flex;"><span>        body<span style="color:#f92672">=</span>message,
</span></span><span style="display:flex;"><span>        properties<span style="color:#f92672">=</span>pika<span style="color:#f92672">.</span>BasicProperties(
</span></span><span style="display:flex;"><span>            delivery_mode<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>,  <span style="color:#75715e"># make message persistent</span>
</span></span><span style="display:flex;"><span>        ))
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34; [x] Sent </span><span style="color:#e6db74">%r</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> message)
</span></span><span style="display:flex;"><span>connection<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><h1 id="消费者">消费者</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pika
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>connection <span style="color:#f92672">=</span> pika<span style="color:#f92672">.</span>BlockingConnection(
</span></span><span style="display:flex;"><span>    pika<span style="color:#f92672">.</span>ConnectionParameters(<span style="color:#e6db74">&#39;localhost&#39;</span>, <span style="color:#ae81ff">5672</span>, <span style="color:#e6db74">&#39;/&#39;</span>, pika<span style="color:#f92672">.</span>PlainCredentials(<span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#e6db74">&#39;password&#39;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>channel <span style="color:#f92672">=</span> connection<span style="color:#f92672">.</span>channel()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>channel<span style="color:#f92672">.</span>queue_declare(queue<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;log_queue&#39;</span>, durable<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">callback</span>(ch, method, properties, body):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34; [x] Received </span><span style="color:#e6db74">%r</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> body)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>channel<span style="color:#f92672">.</span>basic_consume(queue<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;log_queue&#39;</span>,
</span></span><span style="display:flex;"><span>                      on_message_callback<span style="color:#f92672">=</span>callback,
</span></span><span style="display:flex;"><span>                      auto_ack<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39; [*] Waiting for messages. To exit press CTRL+C&#39;</span>)
</span></span><span style="display:flex;"><span>channel<span style="color:#f92672">.</span>start_consuming()
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div>
    </div>
  <a href="/post/rabbitmq%E7%9A%84%E9%85%8D%E7%BD%AE%E5%8F%8Apython%E8%B0%83%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E5%BD%95%E9%9F%B3/" class="link blue hover-black">
            Tag: 录音
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 25, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/python%E5%BD%95%E9%9F%B3/" class="link black dim">
        用python进行录音
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="代码">代码</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> pyaudio
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> wave
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> threading
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AudioRecorder</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>p <span style="color:#f92672">=</span> pyaudio<span style="color:#f92672">.</span>PyAudio()
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>stream <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>device_index <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>is_recording <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>recording_thread <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">list_input_devices</span>(self):
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;&#34;&#34;列出所有可用的录音设备&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            device_list <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(self<span style="color:#f92672">.</span>p<span style="color:#f92672">.</span>get_device_count()):
</span></span><span style="display:flex;"><span>                device_info <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>p<span style="color:#f92672">.</span>get_device_info_by_index(i)
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 筛选出录音设备</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> device_info[<span style="color:#e6db74">&#34;maxInputChannels&#34;</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                    device_list<span style="color:#f92672">.</span>append((i, device_info[<span style="color:#e6db74">&#34;name&#34;</span>]))
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Index: </span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">, Name: </span><span style="color:#e6db74">{</span>device_info[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> device_list
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">start_recording</span>(self, device_index, filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;output.wav&#34;</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;&#34;&#34;使用指定设备开始录音&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>device_index <span style="color:#f92672">=</span> device_index
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>is_recording <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 启动录音流</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>stream <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>p<span style="color:#f92672">.</span>open(format<span style="color:#f92672">=</span>pyaudio<span style="color:#f92672">.</span>paInt16,
</span></span><span style="display:flex;"><span>                                      channels<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                                      rate<span style="color:#f92672">=</span><span style="color:#ae81ff">44100</span>,
</span></span><span style="display:flex;"><span>                                      input<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                                      input_device_index<span style="color:#f92672">=</span>device_index,
</span></span><span style="display:flex;"><span>                                      frames_per_buffer<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;Recording started. Call `stop_recording` to end manually.&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 启动录音线程</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>recording_thread <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>record, args<span style="color:#f92672">=</span>(filename,))
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>recording_thread<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">record</span>(self, filename):
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;&#34;&#34;录音线程函数，用于捕获音频数据&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">while</span> self<span style="color:#f92672">.</span>is_recording:
</span></span><span style="display:flex;"><span>                    data <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>stream<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">1024</span>, exception_on_overflow<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>frames<span style="color:#f92672">.</span>append(data)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error during recording: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">stop_recording</span>(self, filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;output.wav&#34;</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;&#34;&#34;停止录音并保存文件&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>is_recording:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#34;Stopping recording...&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 停止录音循环</span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>is_recording <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 等待录音线程结束</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>recording_thread:
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>recording_thread<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 停止并关闭音频流</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>stream:
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>stream<span style="color:#f92672">.</span>stop_stream()
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>stream<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>stream <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#34;Recording stopped.&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 保存录音文件</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">with</span> wave<span style="color:#f92672">.</span>open(filename, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> wf:
</span></span><span style="display:flex;"><span>                    wf<span style="color:#f92672">.</span>setnchannels(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>                    wf<span style="color:#f92672">.</span>setsampwidth(self<span style="color:#f92672">.</span>p<span style="color:#f92672">.</span>get_sample_size(pyaudio<span style="color:#f92672">.</span>paInt16))
</span></span><span style="display:flex;"><span>                    wf<span style="color:#f92672">.</span>setframerate(<span style="color:#ae81ff">44100</span>)
</span></span><span style="display:flex;"><span>                    wf<span style="color:#f92672">.</span>writeframes(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(self<span style="color:#f92672">.</span>frames))
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Recording saved as </span><span style="color:#e6db74">{</span>filename<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">close</span>(self):
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;&#34;&#34;关闭 PyAudio 实例&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>p<span style="color:#f92672">.</span>terminate()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 使用示例</span>
</span></span><span style="display:flex;"><span>    recorder <span style="color:#f92672">=</span> AudioRecorder()
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    1. 列出所有录音设备
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    输出示例
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Index: 0, Name: “钱甫新的iPhone”的麦克风
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Index: 1, Name: MacBook Air麦克风
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    recorder<span style="color:#f92672">.</span>list_input_devices()
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    2. 选择一个设备进行录音（此处以设备索引0为例，具体要使用哪个录音设备，请参考具体的【列出所有录音设备】输出结果）
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    recorder<span style="color:#f92672">.</span>start_recording(device_index<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;test_recording.wav&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 模拟一些操作或等待录音，用户可以在适当的时候手动停止录音</span>
</span></span><span style="display:flex;"><span>    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    3. 手动接入停止录音
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    recorder<span style="color:#f92672">.</span>stop_recording(filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;test_recording.wav&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 最后关闭 PyAudio 实例</span>
</span></span><span style="display:flex;"><span>    recorder<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><h1 id="环境">环境</h1>
<pre><code>python3.10

PyAudio==0.2.14
</code></pre>
    </div>
  <a href="/post/python%E5%BD%95%E9%9F%B3/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/whisper/" class="link blue hover-black">
            Tag: Whisper
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 24, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/pythongui%E5%AE%9E%E7%8E%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%B5%81%E5%BC%8F%E5%AF%B9%E8%AF%9D_whisper_ollama/" class="link black dim">
        pythonGUI实现大模型流式对话_whisper_ollama
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="服务部署">服务部署</h1>
<h2 id="部署whisper-api服务">部署whisper api服务</h2>
<pre><code>version: '3.8'

services:
  whisper-asr:
    image: onerahmet/openai-whisper-asr-webservice:latest
    container_name: whisper-asr-service
    ports:
      - &quot;9099:9000&quot;
    volumes:
      - /Users/qianfuxin/dc/whisper:/root/.cache/whisper
    environment:
      - ASR_MODEL=base
      - ASR_ENGINE=openai_whisper
    restart: unless-stopped
</code></pre>
<h2 id="部署ollama">部署ollama</h2>
<p>见官网</p>
<h1 id="代码">代码</h1>
<pre><code>import mimetypes
import os
import sys
from datetime import datetime
import socksio
import requests
from PyQt5.QtWidgets import QApplication, QWidget, QVBoxLayout, QPushButton, QLabel, QTextEdit
import pyaudio
import wave
import threading
from langchain_core.messages import HumanMessage, SystemMessage
from langchain_core.output_parsers import StrOutputParser
from langchain_openai import ChatOpenAI


def transcribe_audio(file_path):
    &quot;&quot;&quot;
    Function to transcribe audio using the ASR service.

    :param file_path: The full path to the audio file to be transcribed.
    :return: The response text from the ASR service.
    &quot;&quot;&quot;
    # Ensure the file exists
    if not os.path.isfile(file_path):
        raise FileNotFoundError(f&quot;Audio file not found at: {file_path}&quot;)

    # Determine MIME type
    mime_type, _ = mimetypes.guess_type(file_path)
    if mime_type is None:
        raise ValueError(f&quot;Unable to determine MIME type for file: {file_path}&quot;)

    # Extract file name
    file_name = os.path.basename(file_path)

    url = &quot;http://localhost:9099/asr&quot;
    params = {
        &quot;encode&quot;: &quot;true&quot;,
        &quot;task&quot;: &quot;transcribe&quot;,
        &quot;language&quot;: &quot;zh&quot;,
        &quot;initial_prompt&quot;: &quot;这是一段简体中文&quot;,
        &quot;word_timestamps&quot;: &quot;false&quot;,
        &quot;output&quot;: &quot;txt&quot;
    }
    headers = {
        &quot;accept&quot;: &quot;application/json&quot;,
    }

    # Open the audio file
    with open(file_path, &quot;rb&quot;) as audio_file:
        files = {
            &quot;audio_file&quot;: (file_name, audio_file, mime_type)
        }

        # Send the POST request
        response = requests.post(url, headers=headers, params=params, files=files)
    return response.text


def get_model(base_url=&quot;http://127.0.0.1:11434/v1&quot;):
    &quot;&quot;&quot;Get the AI model instance.&quot;&quot;&quot;
    model = ChatOpenAI(
        api_key=&quot;ollama&quot;,
        model=&quot;qwen2&quot;,
        base_url=base_url
    )
    return model


class AudioRecorder:
    def __init__(self):
        self.p = pyaudio.PyAudio()
        self.stream = None
        self.frames = []
        self.device_index = None
        self.is_recording = False
        self.recording_thread = None

    def list_input_devices(self):
        &quot;&quot;&quot;List available input devices.&quot;&quot;&quot;
        device_list = []
        for i in range(self.p.get_device_count()):
            device_info = self.p.get_device_info_by_index(i)
            if device_info[&quot;maxInputChannels&quot;] &gt; 0:
                device_list.append((i, device_info[&quot;name&quot;]))
        return device_list

    def start_recording(self, device_index):
        &quot;&quot;&quot;Start recording with the specified device.&quot;&quot;&quot;
        self.device_index = device_index
        self.frames = []
        self.is_recording = True

        self.stream = self.p.open(format=pyaudio.paInt16,
                                  channels=1,
                                  rate=44100,
                                  input=True,
                                  input_device_index=device_index,
                                  frames_per_buffer=1024)

        self.recording_thread = threading.Thread(target=self.record)
        self.recording_thread.start()

    def record(self):
        &quot;&quot;&quot;Record audio in a separate thread.&quot;&quot;&quot;
        try:
            while self.is_recording:
                data = self.stream.read(1024, exception_on_overflow=False)
                self.frames.append(data)
        except IOError as e:
            print(f&quot;Buffer overflow occurred: {e}&quot;)

    def stop_recording(self, filename):
        &quot;&quot;&quot;Stop recording and save the file.&quot;&quot;&quot;
        if self.is_recording:
            self.is_recording = False
            if self.recording_thread and self.recording_thread.is_alive():
                self.recording_thread.join()

            if self.stream:
                self.stream.stop_stream()
                self.stream.close()
                self.stream = None

            with wave.open(filename, 'wb') as wf:
                wf.setnchannels(1)
                wf.setsampwidth(self.p.get_sample_size(pyaudio.paInt16))
                wf.setframerate(44100)
                wf.writeframes(b''.join(self.frames))

    def close(self):
        &quot;&quot;&quot;Close the PyAudio instance.&quot;&quot;&quot;
        self.p.terminate()


class RecorderApp(QWidget):
    def __init__(self):
        super().__init__()

        self.recorder = AudioRecorder()
        self.filename = None
        self.model = get_model()
        self.init_ui()

    def init_ui(self):
        self.setWindowTitle(&quot;实时语音识别与问答&quot;)
        self.setGeometry(100, 100, 500, 400)

        layout = QVBoxLayout()

        # 开启录音按钮
        self.start_button = QPushButton(&quot;开启录音&quot;)
        self.start_button.clicked.connect(self.start_recording)
        layout.addWidget(self.start_button)

        # 结束录音按钮
        self.stop_button = QPushButton(&quot;结束录音&quot;)
        self.stop_button.clicked.connect(self.stop_recording)
        self.stop_button.setEnabled(False)
        layout.addWidget(self.stop_button)

        # 状态显示标签
        self.status_label = QLabel(&quot;用户问题: &quot;, self)
        layout.addWidget(self.status_label)

        # 输出结果框
        self.output_box = QTextEdit(self)
        self.output_box.setReadOnly(True)
        layout.addWidget(self.output_box)

        self.setLayout(layout)

    def start_recording(self):
        device_index = 0  # For simplicity, we assume default device.
        start_time = datetime.now().strftime(&quot;%Y%m%d_%H%M%S&quot;)
        self.filename = f&quot;{start_time}.wav&quot;

        self.recorder.start_recording(device_index)
        self.start_button.setEnabled(False)
        self.stop_button.setEnabled(True)

    def stop_recording(self):
        self.recorder.stop_recording(self.filename)
        self.start_button.setEnabled(True)
        self.stop_button.setEnabled(False)

        # 转录音频并生成回答
        transcription = transcribe_audio(self.filename)
        self.status_label.setText(f&quot;用户问题: {transcription}&quot;)
        self.generate_answer(transcription)

    def generate_answer(self, transcription):
        &quot;&quot;&quot;
        Send the transcription to the large model and display the streamed response.
        &quot;&quot;&quot;
        QApplication.processEvents()

        messages = [
            SystemMessage(&quot;你是一个智能助手。&quot;),
            HumanMessage(content=transcription)
        ]
        parser = StrOutputParser()
        chain = self.model | parser

        response = &quot;&quot;
        for token in chain.stream(messages):
            response += token
            self.output_box.setText(response)
            QApplication.processEvents()


if __name__ == &quot;__main__&quot;:
    app = QApplication(sys.argv)
    window = RecorderApp()
    window.show()
    sys.exit(app.exec_())
</code></pre>
<h3 id="仅仅实现asr">仅仅实现ASR</h3>
<pre><code>import mimetypes
import os
import sys
from datetime import datetime

import requests
from PyQt5.QtGui import QIcon
from PyQt5.QtWidgets import QApplication, QWidget, QVBoxLayout, QPushButton, QLabel, QLineEdit, QComboBox, QMessageBox, \
    QSystemTrayIcon, QMenu, QAction
import pyaudio
import wave
import threading


def transcribe_audio(file_path):
    &quot;&quot;&quot;
    Function to transcribe audio using the ASR service.

    :param file_path: The full path to the audio file to be transcribed.
    :return: The response text from the ASR service.
    &quot;&quot;&quot;
    # Ensure the file exists
    if not os.path.isfile(file_path):
        raise FileNotFoundError(f&quot;Audio file not found at: {file_path}&quot;)

    # Determine MIME type
    mime_type, _ = mimetypes.guess_type(file_path)
    if mime_type is None:
        raise ValueError(f&quot;Unable to determine MIME type for file: {file_path}&quot;)

    # Extract file name
    file_name = os.path.basename(file_path)

    url = &quot;http://localhost:9099/asr&quot;
    params = {
        &quot;encode&quot;: &quot;true&quot;,
        &quot;task&quot;: &quot;transcribe&quot;,
        &quot;language&quot;: &quot;zh&quot;,
        &quot;initial_prompt&quot;: &quot;这是一段简体中文&quot;,
        &quot;word_timestamps&quot;: &quot;false&quot;,
        &quot;output&quot;: &quot;txt&quot;
    }
    headers = {
        &quot;accept&quot;: &quot;application/json&quot;,
    }

    # Open the audio file
    with open(file_path, &quot;rb&quot;) as audio_file:
        files = {
            &quot;audio_file&quot;: (file_name, audio_file, mime_type)
        }

        # Send the POST request
        response = requests.post(url, headers=headers, params=params, files=files)

    return response.text


class AudioRecorder:
    def __init__(self):
        self.p = pyaudio.PyAudio()
        self.stream = None
        self.frames = []
        self.device_index = None
        self.is_recording = False
        self.recording_thread = None

    def list_input_devices(self):
        &quot;&quot;&quot;列出所有可用的录音设备&quot;&quot;&quot;
        device_list = []
        for i in range(self.p.get_device_count()):
            device_info = self.p.get_device_info_by_index(i)
            # 筛选出录音设备
            if device_info[&quot;maxInputChannels&quot;] &gt; 0:
                device_list.append((i, device_info[&quot;name&quot;]))
        return device_list

    def start_recording(self, device_index):
        &quot;&quot;&quot;使用指定设备开始录音&quot;&quot;&quot;
        self.device_index = device_index
        self.frames = []
        self.is_recording = True

        self.stream = self.p.open(format=pyaudio.paInt16,
                                  channels=1,
                                  rate=44100,
                                  input=True,
                                  input_device_index=device_index,
                                  frames_per_buffer=1024)

        # 启动录音线程
        self.recording_thread = threading.Thread(target=self.record)
        self.recording_thread.start()

    def record(self):
        &quot;&quot;&quot;录音线程函数，用于捕获音频数据&quot;&quot;&quot;
        try:
            while self.is_recording:
                data = self.stream.read(1024, exception_on_overflow=False)
                self.frames.append(data)
        except IOError as e:
            print(f&quot;Buffer overflow occurred: {e}&quot;)

    def stop_recording(self, filename):
        &quot;&quot;&quot;停止录音并保存文件&quot;&quot;&quot;
        if self.is_recording:
            self.is_recording = False
            if self.recording_thread and self.recording_thread.is_alive():
                self.recording_thread.join()

            if self.stream:
                self.stream.stop_stream()
                self.stream.close()
                self.stream = None

            with wave.open(filename, 'wb') as wf:
                wf.setnchannels(1)
                wf.setsampwidth(self.p.get_sample_size(pyaudio.paInt16))
                wf.setframerate(44100)
                wf.writeframes(b''.join(self.frames))

    def close(self):
        &quot;&quot;&quot;关闭 PyAudio 实例&quot;&quot;&quot;
        self.p.terminate()


def resource_path(relative_path):
    &quot;&quot;&quot;获取资源文件的绝对路径&quot;&quot;&quot;
    if hasattr(sys, '_MEIPASS'):
        return os.path.join(sys._MEIPASS, relative_path)
    return os.path.join(os.path.abspath(&quot;.&quot;), relative_path)


class RecorderApp(QWidget):
    def __init__(self):
        super().__init__()

        self.recorder = AudioRecorder()
        self.filename = None

        self.init_ui()

    def init_ui(self):
        self.setWindowTitle(&quot;录音器&quot;)
        self.setGeometry(100, 100, 400, 300)

        # 创建系统托盘图标
        self.tray_icon = QSystemTrayIcon(self)
        self.tray_icon.setIcon(QIcon(resource_path(&quot;icon.png&quot;)))

        # 创建托盘菜单
        tray_menu = QMenu()

        # 添加显示窗口的选项
        show_action = QAction(&quot;显示窗口&quot;, self)
        show_action.triggered.connect(self.show)
        tray_menu.addAction(show_action)

        # 添加退出的选项
        exit_action = QAction(&quot;退出&quot;, self)
        exit_action.triggered.connect(QApplication.instance().quit)
        tray_menu.addAction(exit_action)

        # 将菜单添加到托盘图标
        self.tray_icon.setContextMenu(tray_menu)

        # 设置点击双击托盘图标的动作
        self.tray_icon.activated.connect(self.on_tray_icon_activated)

        # 显示托盘图标
        self.tray_icon.show()

        layout = QVBoxLayout()

        # 开启录音按钮
        self.start_button = QPushButton(&quot;开启录音&quot;)
        self.start_button.clicked.connect(self.start_recording)
        layout.addWidget(self.start_button)

        # 结束录音按钮
        self.stop_button = QPushButton(&quot;结束录音&quot;)
        self.stop_button.clicked.connect(self.stop_recording)
        self.stop_button.setEnabled(False)
        layout.addWidget(self.stop_button)

        # 设备选择下拉菜单
        self.device_selector = QComboBox(self)
        devices = self.recorder.list_input_devices()
        if devices:
            for index, name in devices:
                self.device_selector.addItem(name, index)
        else:
            QMessageBox.warning(self, &quot;错误&quot;, &quot;未检测到录音设备&quot;)
            self.start_button.setEnabled(False)
        layout.addWidget(self.device_selector)

        # 状态显示标签
        self.status_label = QLabel(&quot;状态: 未录音&quot;, self)
        layout.addWidget(self.status_label)

        self.setLayout(layout)

    def closeEvent(self, event):
        &quot;&quot;&quot;窗口关闭事件&quot;&quot;&quot;
        if self.isVisible():  # 如果窗口可见，则最小化到托盘
            event.ignore()
            self.hide()
            self.tray_icon.showMessage(
                &quot;应用最小化&quot;, &quot;程序已最小化到托盘&quot;,
                QSystemTrayIcon.Information, 2000
            )
        else:  # 关闭应用时清理资源
            self.recorder.close()
            event.accept()

    def on_tray_icon_activated(self, reason):
        &quot;&quot;&quot;托盘图标激活事件&quot;&quot;&quot;
        if reason == QSystemTrayIcon.DoubleClick:
            self.show()

    def start_recording(self):
        device_index = self.device_selector.currentData()
        start_time = datetime.now().strftime(&quot;%Y%m%d_%H%M%S&quot;)
        self.filename = f&quot;{start_time}.wav&quot;

        self.recorder.start_recording(device_index)
        self.status_label.setText(&quot;状态: 录音中...&quot;)
        self.start_button.setEnabled(False)
        self.stop_button.setEnabled(True)

    def stop_recording(self):
        end_time = datetime.now().strftime(&quot;%Y%m%d_%H%M%S&quot;)
        self.filename = f&quot;{self.filename[:-4]}-{end_time}.wav&quot;  # 更新文件名
        self.recorder.stop_recording(self.filename)
        self.status_label.setText(f&quot;状态: 录音已保存为 {self.filename}&quot;)
        self.start_button.setEnabled(True)
        self.stop_button.setEnabled(False)
        self.status_label.setText(f&quot;状态: 录音已保存为 {self.filename}\n录音内容：{transcribe_audio(self.filename)}&quot;)


# 主程序入口
if __name__ == &quot;__main__&quot;:
    app = QApplication(sys.argv)
    window = RecorderApp()
    window.show()
    sys.exit(app.exec_())
    &quot;&quot;&quot;
    pyinstaller --onefile --windowed --noconfirm --add-data &quot;icon.png;.&quot; app.py
    &quot;&quot;&quot;
</code></pre>
    </div>
  <a href="/post/pythongui%E5%AE%9E%E7%8E%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%B5%81%E5%BC%8F%E5%AF%B9%E8%AF%9D_whisper_ollama/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/memcached/" class="link blue hover-black">
            Tag: Memcached
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 23, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/memcached%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8Epython%E8%B0%83%E7%94%A8/" class="link black dim">
        memcached的部署与python调用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="部署">部署</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>version: <span style="color:#e6db74">&#39;3.8&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>services:  
</span></span><span style="display:flex;"><span>memcached:  
</span></span><span style="display:flex;"><span>image: memcached  
</span></span><span style="display:flex;"><span>container_name: memcached  
</span></span><span style="display:flex;"><span>ports:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#e6db74">&#34;11211:11211&#34;</span>
</span></span></code></pre></div><h1 id="python调用">python调用</h1>
<pre><code>from pymemcache.client import base

# 连接到 Memcached 服务
client = base.Client(('localhost', 11211))

# 设置一个键值对
client.set('my_key', 'Hello, Memcached!')

# 获取存储的值
value = client.get('my_key')
print(f'Value for my_key: {value.decode(&quot;utf-8&quot;)}')

# 删除键值对
client.delete('my_key')

# 关闭连接
client.close()
</code></pre>
<h1 id="总结">总结</h1>
<p>memcached是一个很单纯的缓存服务（减少数据库压力），数据存放在内存，所以没必要本地映射，
而且不支持身份验证，所以需要在容器互联时使用，不应该让外部访问。</p>
    </div>
  <a href="/post/memcached%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8Epython%E8%B0%83%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/%E7%BC%93%E5%AD%98/" class="link blue hover-black">
            Tag: 缓存
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 23, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/memcached%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8Epython%E8%B0%83%E7%94%A8/" class="link black dim">
        memcached的部署与python调用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="部署">部署</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>version: <span style="color:#e6db74">&#39;3.8&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>services:  
</span></span><span style="display:flex;"><span>memcached:  
</span></span><span style="display:flex;"><span>image: memcached  
</span></span><span style="display:flex;"><span>container_name: memcached  
</span></span><span style="display:flex;"><span>ports:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#e6db74">&#34;11211:11211&#34;</span>
</span></span></code></pre></div><h1 id="python调用">python调用</h1>
<pre><code>from pymemcache.client import base

# 连接到 Memcached 服务
client = base.Client(('localhost', 11211))

# 设置一个键值对
client.set('my_key', 'Hello, Memcached!')

# 获取存储的值
value = client.get('my_key')
print(f'Value for my_key: {value.decode(&quot;utf-8&quot;)}')

# 删除键值对
client.delete('my_key')

# 关闭连接
client.close()
</code></pre>
<h1 id="总结">总结</h1>
<p>memcached是一个很单纯的缓存服务（减少数据库压力），数据存放在内存，所以没必要本地映射，
而且不支持身份验证，所以需要在容器互联时使用，不应该让外部访问。</p>
    </div>
  <a href="/post/memcached%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8Epython%E8%B0%83%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/ocr/" class="link blue hover-black">
            Tag: Ocr
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 22, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/mac%E4%BD%BF%E7%94%A8tesseract%E8%AF%86%E5%88%AB%E4%B8%AD%E6%96%87/" class="link black dim">
        mac使用tesseract识别中文
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装">安装</h1>
<p>brew install tesseract</p>
<h1 id="添加中文支持">添加中文支持</h1>
<p>下载包</p>
<p><a href="https://github.com/tesseract-ocr/tessdata/blob/main/chi_sim.traineddata">https://github.com/tesseract-ocr/tessdata/blob/main/chi_sim.traineddata</a></p>
<p><img src="/images/mac%E4%BD%BF%E7%94%A8tesseract%E8%AF%86%E5%88%AB%E4%B8%AD%E6%96%87_1.png" alt=""></p>
<h1 id="使用">使用</h1>
<p><img src="/images/mac%E4%BD%BF%E7%94%A8tesseract%E8%AF%86%E5%88%AB%E4%B8%AD%E6%96%87_2.png" alt=""></p>
<pre><code>tesseract picture_path out -l chi_sim
</code></pre>
    </div>
  <a href="/post/mac%E4%BD%BF%E7%94%A8tesseract%E8%AF%86%E5%88%AB%E4%B8%AD%E6%96%87/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/tesseract/" class="link blue hover-black">
            Tag: Tesseract
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 22, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/mac%E4%BD%BF%E7%94%A8tesseract%E8%AF%86%E5%88%AB%E4%B8%AD%E6%96%87/" class="link black dim">
        mac使用tesseract识别中文
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装">安装</h1>
<p>brew install tesseract</p>
<h1 id="添加中文支持">添加中文支持</h1>
<p>下载包</p>
<p><a href="https://github.com/tesseract-ocr/tessdata/blob/main/chi_sim.traineddata">https://github.com/tesseract-ocr/tessdata/blob/main/chi_sim.traineddata</a></p>
<p><img src="/images/mac%E4%BD%BF%E7%94%A8tesseract%E8%AF%86%E5%88%AB%E4%B8%AD%E6%96%87_1.png" alt=""></p>
<h1 id="使用">使用</h1>
<p><img src="/images/mac%E4%BD%BF%E7%94%A8tesseract%E8%AF%86%E5%88%AB%E4%B8%AD%E6%96%87_2.png" alt=""></p>
<pre><code>tesseract picture_path out -l chi_sim
</code></pre>
    </div>
  <a href="/post/mac%E4%BD%BF%E7%94%A8tesseract%E8%AF%86%E5%88%AB%E4%B8%AD%E6%96%87/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/fishspeech/" class="link blue hover-black">
            Tag: FishSpeech
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 21, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/mac%E4%BD%BF%E7%94%A8fishspeech%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%AE%9A%E9%9F%B3%E8%89%B2tts/" class="link black dim">
        mac使用FishSpeech实现指定音色tts
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><strong>下述推理代码都使用cpu进行处理（使用mps走不通</strong> ）</p>
<blockquote>
<p>参考</p>
<p><a href="https://speech.fish.audio/zh/inference/">https://speech.fish.audio/zh/inference/</a></p>
</blockquote>
<h1 id="环境与模型">环境与模型</h1>
<pre><code>git clone https://github.com/fishaudio/fish-speech.git
cd fish-speech
# 环境
conda create -n fish-speech python=3.10
conda activate fish-speech
# 依赖包
pip install torch==2.4.1 torchvision==0.19.1 torchaudio==2.4.1
pip install -e &quot;.[stable]&quot;
# 下载模型
HF_ENDPOINT=https://hf-mirror.com huggingface-cli download fishaudio/fish-speech-1.5 --local-dir checkpoints/fish-speech-1.5
</code></pre>
<h1 id="基本流程">基本流程</h1>
<h2 id="提取音色">提取音色</h2>
<p>下面的paimon.wav也可以是mp3文件，最终会生成一个<code>fake.npy</code></p>
<pre><code>python tools/vqgan/inference.py --device cpu \
    -i &quot;paimon.wav&quot; \
    --checkpoint-path &quot;checkpoints/fish-speech-1.5/firefly-gan-vq-fsq-8x1024-21hz-generator.pth&quot;
</code></pre>
<h2 id="生成语音">生成语音</h2>
<pre><code>python tools/llama/generate.py --device cpu \
    --text &quot;你要生成的文本&quot; \
    --prompt-text &quot;你提供语音中的文本&quot; \
    --prompt-tokens &quot;fake.npy&quot; \
    --checkpoint-path &quot;checkpoints/fish-speech-1.5&quot; \
    --num-samples 1 \
</code></pre>
<p>会生成一个codes_0.npy，下面将codes_0.npy转换为音频文件</p>
    </div>
  <a href="/post/mac%E4%BD%BF%E7%94%A8fishspeech%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%AE%9A%E9%9F%B3%E8%89%B2tts/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/huggingface/" class="link blue hover-black">
            Tag: HuggingFace
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 21, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/huggingface%E9%95%9C%E5%83%8F%E5%8F%8A%E6%8C%87%E5%AE%9A%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE/" class="link black dim">
        下载HuggingFace镜像及指定存储位置
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="设置镜像">设置镜像</h1>
<p><code>HF_ENDPOINT=https://hf-mirror.com</code></p>
<h1 id="下载模型">下载模型</h1>
<p><code>huggingface-cli download Qwen/Qwen2.5-1.5B-Instruct </code></p>
<p>or</p>
<p><code>huggingface-cli download Qwen/Qwen2.5-1.5B-Instruct --local-dir checkpoints/fish-speech-1.5</code></p>
<h1 id="设置模型根目录存储位置">设置模型根目录存储位置</h1>
<p><code>HF_HOME=&quot;xxx&quot;</code></p>
    </div>
  <a href="/post/huggingface%E9%95%9C%E5%83%8F%E5%8F%8A%E6%8C%87%E5%AE%9A%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/tts/" class="link blue hover-black">
            Tag: Tts
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 21, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/mac%E4%BD%BF%E7%94%A8fishspeech%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%AE%9A%E9%9F%B3%E8%89%B2tts/" class="link black dim">
        mac使用FishSpeech实现指定音色tts
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><strong>下述推理代码都使用cpu进行处理（使用mps走不通</strong> ）</p>
<blockquote>
<p>参考</p>
<p><a href="https://speech.fish.audio/zh/inference/">https://speech.fish.audio/zh/inference/</a></p>
</blockquote>
<h1 id="环境与模型">环境与模型</h1>
<pre><code>git clone https://github.com/fishaudio/fish-speech.git
cd fish-speech
# 环境
conda create -n fish-speech python=3.10
conda activate fish-speech
# 依赖包
pip install torch==2.4.1 torchvision==0.19.1 torchaudio==2.4.1
pip install -e &quot;.[stable]&quot;
# 下载模型
HF_ENDPOINT=https://hf-mirror.com huggingface-cli download fishaudio/fish-speech-1.5 --local-dir checkpoints/fish-speech-1.5
</code></pre>
<h1 id="基本流程">基本流程</h1>
<h2 id="提取音色">提取音色</h2>
<p>下面的paimon.wav也可以是mp3文件，最终会生成一个<code>fake.npy</code></p>
<pre><code>python tools/vqgan/inference.py --device cpu \
    -i &quot;paimon.wav&quot; \
    --checkpoint-path &quot;checkpoints/fish-speech-1.5/firefly-gan-vq-fsq-8x1024-21hz-generator.pth&quot;
</code></pre>
<h2 id="生成语音">生成语音</h2>
<pre><code>python tools/llama/generate.py --device cpu \
    --text &quot;你要生成的文本&quot; \
    --prompt-text &quot;你提供语音中的文本&quot; \
    --prompt-tokens &quot;fake.npy&quot; \
    --checkpoint-path &quot;checkpoints/fish-speech-1.5&quot; \
    --num-samples 1 \
</code></pre>
<p>会生成一个codes_0.npy，下面将codes_0.npy转换为音频文件</p>
    </div>
  <a href="/post/mac%E4%BD%BF%E7%94%A8fishspeech%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%AE%9A%E9%9F%B3%E8%89%B2tts/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/elasticsearch/" class="link blue hover-black">
            Tag: Elasticsearch
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 9, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/elasticsearch%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8Epython%E8%B0%83%E7%94%A8/" class="link black dim">
        elasticsearch的部署与python调用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="部署">部署</h1>
<pre><code>version: '3'
services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.9.0
    container_name: elasticsearch
    environment:
      - discovery.type=single-node
      - ES_JAVA_OPTS=-Xms1g -Xmx1g  # 设置 JVM 堆内存为 1GB
      - xpack.security.enabled=true  # 启用安全功能
      - ELASTIC_PASSWORD=password  # 设置默认超级用户 elastic（用户名） 的密码 
      - xpack.security.authc.api_key.enabled=true  # 启用 API 密钥认证
    ports:
      - &quot;9200:9200&quot;
      - &quot;9300:9300&quot;
    volumes:
      - /dc/es_data:/usr/share/elasticsearch/data
</code></pre>
<h1 id="python调用">python调用</h1>
<pre><code>from elasticsearch import Elasticsearch

# 使用用户名和密码连接到 Elasticsearch
es = Elasticsearch(
    &quot;http://localhost:9200&quot;,
    basic_auth=(&quot;elastic&quot;, &quot;password&quot;)  # 替换为你的用户名和密码
)

# 创建索引
index_name = &quot;my_index&quot;
if not es.indices.exists(index=index_name):
    es.indices.create(index=index_name)

# 添加文档
doc = {
    &quot;title&quot;: &quot;Hello World&quot;,
    &quot;content&quot;: &quot;This is a test document in Elasticsearch&quot;,
    &quot;timestamp&quot;: &quot;2024-08-06&quot;
}
es.index(index=index_name, id=1, body=doc)

# 查询文档
res = es.get(index=index_name, id=1)
print(res['_source'])

# 搜索文档
search_query = {
    &quot;query&quot;: {
        &quot;match&quot;: {
            &quot;content&quot;: &quot;test&quot;
        }
    }
}
search_results = es.search(index=index_name, body=search_query)
print(search_results['hits']['hits'])
</code></pre>
<h1 id="总结">总结</h1>
<p>最初看到es的文档，下意识想到了mongodb，然后查了一下，既然都是存储文档，那么为啥要用es，结论是mongo旨在数据更新，es旨在数据查询。其中es的索引类似sql中的表概念，文档类似行概念</p>
    </div>
  <a href="/post/elasticsearch%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8Epython%E8%B0%83%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/fzf/" class="link blue hover-black">
            Tag: Fzf&#34;
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 9, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/fzf%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/" class="link black dim">
        fzf的安装及使用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装">安装</h1>
<pre><code>git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf
~/.fzf/install
</code></pre>
<h1 id="使用">使用</h1>
<ul>
<li>查找历史命令 ctr+R</li>
<li>查找当前下的文件 ctr+T</li>
</ul>
<h1 id="匹配">匹配</h1>
<p>默认模糊匹配，使用’可以精确匹配</p>
<p>使用^和%匹配开头结尾</p>
<p>使用!匹配对立面</p>
    </div>
  <a href="/post/fzf%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/github/" class="link blue hover-black">
            Tag: GitHub
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 9, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/githubaction%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E5%B9%B6%E4%B8%8A%E4%BC%A0dockerhub%E8%B4%A6%E5%8F%B7/" class="link black dim">
        GitHubAction自动构建镜像并上传dockerHub账号
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="action文件">action文件</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>name: Docker Image CI
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>on:
</span></span><span style="display:flex;"><span>push.sh:
</span></span><span style="display:flex;"><span>branches: <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;main&#34;</span> <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>pull_request:
</span></span><span style="display:flex;"><span>branches: <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;main&#34;</span> <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jobs:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>build:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>runs-on: ubuntu-latest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>steps:
</span></span><span style="display:flex;"><span>- uses: actions/checkout@v3
</span></span><span style="display:flex;"><span>- name: Build the Docker image
</span></span><span style="display:flex;"><span>  run: docker build -t <span style="color:#e6db74">${</span>{ secrets.IMAGE_NAME <span style="color:#e6db74">}</span><span style="color:#f92672">}</span> .
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>- name: docker login
</span></span><span style="display:flex;"><span>  run: docker login -u qianfuxin -p <span style="color:#e6db74">&#39;${{ secrets.DOCKER_TOKEN }}&#39;</span>
</span></span><span style="display:flex;"><span>- name: change tag
</span></span><span style="display:flex;"><span>  run: docker tag <span style="color:#e6db74">${</span>{ secrets.IMAGE_NAME <span style="color:#e6db74">}</span><span style="color:#f92672">}</span>:latest qianfuxin/<span style="color:#e6db74">${</span>{ secrets.IMAGE_NAME <span style="color:#e6db74">}</span><span style="color:#f92672">}</span>:latest
</span></span><span style="display:flex;"><span>- name: push.sh image
</span></span><span style="display:flex;"><span>  run: docker push.sh qianfuxin/<span style="color:#e6db74">${</span>{ secrets.IMAGE_NAME <span style="color:#e6db74">}</span><span style="color:#f92672">}</span>:latest
</span></span></code></pre></div><h1 id="配置页面">配置页面</h1>
<p><img src="/images/GitHubAction%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E5%B9%B6%E4%B8%8A%E4%BC%A0dockerHub%E8%B4%A6%E5%8F%B7.png" alt=""></p>
    </div>
  <a href="/post/githubaction%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E5%B9%B6%E4%B8%8A%E4%BC%A0dockerhub%E8%B4%A6%E5%8F%B7/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/jupyte/" class="link blue hover-black">
            Tag: Jupyte
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 9, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/jupyter%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" class="link black dim">
        docker快速使用jupyter
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="安装">安装</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>version: <span style="color:#e6db74">&#39;3&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>services:
</span></span><span style="display:flex;"><span>  jupyter-notebook:
</span></span><span style="display:flex;"><span>    image: jupyter/minimal-notebook
</span></span><span style="display:flex;"><span>    ports:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;8888:8888&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    volumes:
</span></span><span style="display:flex;"><span>      - /Users/qianfuxin/dc/jupyter1:/home/jovyan/work
</span></span></code></pre></div><h1 id="汉化">汉化</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>!pip install jupyterlab-language-pack-zh-CN
</span></span></code></pre></div><p>刷新页面</p>
<p><img src="/images/jupyter%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8_1.png" alt="jupyter简单使用_1.png"></p>
<h1 id="代码提示">代码提示</h1>
<p><img src="/images/jupyter%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8_2.png" alt="jupyter简单使用_2.png"></p>
<h1 id="本机安装">本机安装</h1>
<h2 id="1-安装-jupyterlab">1. 安装 JupyterLab</h2>
<h3 id="使用-pip-安装">使用 pip 安装</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install jupyterlab
</span></span></code></pre></div><h3 id="使用-conda-安装">使用 conda 安装</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>conda install -c conda-forge jupyterlab notebook
</span></span></code></pre></div><hr>
<h2 id="2-生成配置文件">2. 生成配置文件</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>jupyter notebook --generate-config
</span></span></code></pre></div><p>配置文件默认生成在：</p>
<pre tabindex="0"><code>~/.jupyter/jupyter_notebook_config.py
</code></pre><hr>
<h2 id="3-设置密码">3. 设置密码</h2>
<h3 id="进入-python-环境">进入 Python 环境</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> jupyter_server.auth <span style="color:#f92672">import</span> passwd
</span></span><span style="display:flex;"><span>passwd()
</span></span></code></pre></div><p>系统会提示输入密码，并返回一串加密后的字符串，例如：</p>
<pre tabindex="0"><code>&#39;sha1:abcd1234...&#39;
</code></pre><hr>
<h2 id="4-修改配置文件">4. 修改配置文件</h2>
<p>编辑配置文件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vim ~/.jupyter/jupyter_notebook_config.py
</span></span></code></pre></div><p>添加或修改以下内容：</p>
    </div>
  <a href="/post/jupyter%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/peotry/" class="link blue hover-black">
            Tag: Peotry
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        九月 9, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/peotry%E4%BD%BF%E7%94%A8/" class="link black dim">
        peotry简单使用
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h1 id="python-包管理与发布工具笔记">Python 包管理与发布工具笔记</h1>
<h2 id="一poetry-基础操作">一、Poetry 基础操作</h2>
<h3 id="1-创建项目">1. 创建项目</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>poetry new hello-poetry
</span></span><span style="display:flex;"><span>cd hello-poetry
</span></span></code></pre></div><h3 id="2-添加逻辑示例">2. 添加逻辑（示例）</h3>
<p>在 <code>hello_poetry/__init__.py</code> 中写入：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">say_hello</span>(name: str) <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Hello, </span><span style="color:#e6db74">{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">!&#34;</span>
</span></span></code></pre></div><h3 id="3-打包">3. 打包</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>poetry build
</span></span></code></pre></div><h3 id="4-发布到-pypi">4. 发布到 PyPI</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>poetry publish --build -u token -p pypi-xxx
</span></span></code></pre></div><hr>
<h2 id="二poetry-的定位">二、Poetry 的定位</h2>
<ul>
<li><strong>一体化工具</strong>：依赖管理 + 打包发布。</li>
<li>类比前端的 <strong>npm/yarn</strong>：
<ul>
<li>从 <strong>创建项目 → 管理依赖 → 打包 → 发布</strong> 一条龙。</li>
</ul>
</li>
<li><strong>目标</strong>：替代 <code>pip + setuptools + virtualenv + twine</code> 的组合。</li>
</ul>
<hr>
<h2 id="三uv-的定位">三、uv 的定位</h2>
<ul>
<li><strong>开发者</strong>：Astral。</li>
<li><strong>特点</strong>：
<ul>
<li>超快（Rust 实现，比 pip/poetry/pip-tools 快几十倍）。</li>
<li>关注 <strong>依赖解析、安装、虚拟环境</strong>。</li>
</ul>
</li>
<li><strong>不负责</strong>：打包与发布。</li>
<li><strong>类比</strong>：pip/pipenv 的高速替代品。</li>
</ul>
<hr>
<h2 id="四对比总结">四、对比总结</h2>
<table>
  <thead>
      <tr>
          <th>工具</th>
          <th>核心定位</th>
          <th>覆盖范围</th>
          <th>类比</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Poetry</strong></td>
          <td>依赖管理 + 打包发布</td>
          <td>项目创建 → 依赖管理 → 构建 → 发布</td>
          <td>npm / yarn</td>
      </tr>
      <tr>
          <td><strong>uv</strong></td>
          <td>超高速依赖安装 + 虚拟环境</td>
          <td>依赖解析、安装、环境管理</td>
          <td>pip 极速版</td>
      </tr>
  </tbody>
</table>
    </div>
  <a href="/post/peotry%E4%BD%BF%E7%94%A8/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
        <h2 class="f1">
          <a href="/tags/openai/" class="link blue hover-black">
            Tag: Openai
          </a>
        </h2>
        
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        三月 15, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/post/%E8%AF%B7%E6%B1%82openai%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%8E%A5%E5%8F%A3/" class="link black dim">
        请求openai格式的接口
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p><a href="https://gist.github.com/QianFuXin/be1d6ae54ba87f299734771cddb3dde2">源码</a></p>
    </div>
  <a href="/post/%E8%AF%B7%E6%B1%82openai%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%8E%A5%E5%8F%A3/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">继续阅读</a>
  </div>

        
      
    </section>
  </div>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://qianfuxin.gitHub.io/" >
    &copy;  Y&F 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
